<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>PricePick</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ·ï¸</text></svg>">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--primary:#3B82F6;--primary-light:#EFF6FF;--primary-dark:#2563EB;--bg:#F5F6FA;--card:#fff;--text:#1F2937;--text-sub:#9CA3AF;--text-light:#D1D5DB;--border:#F3F4F6;--red:#EF4444;--green:#10B981;--orange:#F59E0B;--tab-h:60px;--header-h:52px;--safe-top:env(safe-area-inset-top,0px);--safe-bottom:env(safe-area-inset-bottom,0px)}
html,body{height:100vh;height:100dvh;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);overflow:hidden}
body{display:flex;flex-direction:column}

/* Header */
.header{min-height:calc(var(--header-h) + var(--safe-top));padding-top:var(--safe-top);background:var(--card);display:flex;align-items:center;justify-content:space-between;padding-left:20px;padding-right:16px;z-index:100;flex-shrink:0}
.header h1{font-size:18px;font-weight:800}
.header-icons{display:flex;gap:12px;align-items:center}
.header-icons span{font-size:18px;cursor:pointer}
.header-right{display:flex;align-items:center;gap:8px}
.header-right .avatar{width:28px;height:28px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}

/* Content */
.content{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding-bottom:calc(var(--tab-h) + var(--safe-bottom) + 10px)}

/* Pages */
.page{display:none}
.page.active{display:block}
.page-pad{padding:16px}

/* Tab bar - Pollcent style */
.tabbar{position:fixed;bottom:0;left:0;right:0;height:calc(var(--tab-h) + var(--safe-bottom));padding-bottom:var(--safe-bottom);background:var(--card);display:flex;align-items:flex-end;box-shadow:0 -1px 10px rgba(0,0,0,.06);z-index:100}
.tab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;height:var(--tab-h);gap:2px;font-size:10px;color:var(--text-sub);text-decoration:none;transition:.2s;cursor:pointer;position:relative}
.tab.active{color:var(--primary)}
.tab svg{width:22px;height:22px;stroke-width:1.8}
.tab-center{position:relative}
.tab-center-btn{width:48px;height:48px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:300;border:none;cursor:pointer;position:absolute;top:-14px;left:50%;transform:translateX(-50%);box-shadow:0 4px 14px rgba(59,130,246,.35);transition:.2s}
.tab-center-btn:active{transform:translateX(-50%) scale(.92)}

/* Cards */
.card{background:var(--card);border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,.04)}

/* Chips / Badges */
.chip{display:inline-flex;align-items:center;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:600;cursor:pointer;transition:.2s;border:1.5px solid var(--border)}
.chip.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* Product grid - Pollcent style */
.product-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:0 16px 16px}
.product-card{background:var(--card);border-radius:14px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.05);cursor:pointer;transition:transform .2s}
.product-card:active{transform:scale(.97)}
.product-img{width:100%;aspect-ratio:1;background:#f8f9fa;overflow:hidden;position:relative}
.img-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:44px;background:linear-gradient(135deg,#f8f9fa,#e9ecef)}
.product-badge{position:absolute;top:8px;left:8px;font-size:10px;font-weight:700;padding:3px 7px;border-radius:4px;color:#fff}
.badge-rocket{background:var(--primary)}
.badge-hot{background:var(--red)}
.badge-lowest{background:var(--red)}
.product-info{padding:10px 10px 12px}
.product-name{font-size:12px;line-height:1.35;height:33px;overflow:hidden;color:var(--text);margin-bottom:6px}
.product-price-row{display:flex;align-items:baseline;gap:4px}
.product-price{font-size:16px;font-weight:800;color:var(--text)}
.product-change{font-size:11px;font-weight:600}
.product-change.down{color:var(--red)}
.product-change.up{color:var(--green)}

/* Section headers */
.section-header{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 10px;font-size:16px;font-weight:800}
.section-header .more{font-size:13px;color:var(--text-sub);font-weight:500}
.section-sub{font-size:12px;color:var(--text-sub);padding:0 16px 12px}

/* Horizontal scroll */
.h-scroll{display:flex;gap:10px;overflow-x:auto;padding:0 16px 12px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.h-scroll::-webkit-scrollbar{display:none}
.h-card{flex-shrink:0;width:120px;cursor:pointer}
.h-card-img{width:120px;height:120px;border-radius:12px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;font-size:36px;margin-bottom:6px;position:relative;overflow:hidden}
.h-card-name{font-size:11px;line-height:1.3;height:29px;overflow:hidden;color:var(--text)}
.h-card-price{font-size:13px;font-weight:700;margin-top:2px}
.h-card-discount{font-size:11px;color:var(--red);font-weight:600}

/* Banner */
.banner{margin:0 16px 12px;border-radius:14px;padding:18px 16px;color:#fff;position:relative;overflow:hidden}
.banner.b1{background:linear-gradient(135deg,#6366F1,#818CF8)}
.banner.b2{background:linear-gradient(135deg,#F59E0B,#FBBF24)}
.banner h3{font-size:16px;font-weight:700;margin-bottom:2px}
.banner p{font-size:12px;opacity:.85}

/* Goldbox countdown */
.goldbox{margin:0 16px 12px;background:var(--card);border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.goldbox-header{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.goldbox-header h3{font-size:15px;font-weight:800;flex:1}
.countdown{display:flex;align-items:center;gap:2px;font-size:13px;font-weight:700;color:var(--red)}
.countdown svg{width:16px;height:16px}

/* Circular category icons - Pollcent style */
.category-row{display:flex;gap:16px;padding:12px 16px;overflow-x:auto;scrollbar-width:none}
.category-row::-webkit-scrollbar{display:none}
.cat-item{display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0;cursor:pointer}
.cat-icon{width:52px;height:52px;border-radius:50%;background:var(--card);border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.cat-label{font-size:10px;color:var(--text-sub);white-space:nowrap}

/* Track items - Pollcent ê´€ì‹¬ìƒí’ˆ style */
.track-card{display:flex;gap:12px;padding:14px 16px;background:var(--card);margin-bottom:1px;cursor:pointer}
.track-thumb{width:80px;height:80px;border-radius:10px;background:#f8f9fa;overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:32px}
.track-body{flex:1;min-width:0;display:flex;flex-direction:column;justify-content:center}
.track-name{font-size:13px;line-height:1.3;margin-bottom:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.track-price-row{display:flex;align-items:baseline;gap:6px}
.track-current{font-size:16px;font-weight:800}
.track-change{font-size:12px;font-weight:600}

/* Detail overlay - Pollcent price graph style */
.detail-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:150;display:none;flex-direction:column}
.detail-overlay.show{display:flex}
.detail-top{display:flex;align-items:center;padding:10px 12px;padding-top:calc(10px + var(--safe-top));background:var(--card);gap:8px;flex-shrink:0}
.detail-top button{width:36px;height:36px;border-radius:50%;border:none;background:transparent;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.detail-top .share{margin-left:auto}
.detail-scroll{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}
.detail-bottom{flex-shrink:0;display:flex;align-items:center;padding:10px 16px;background:var(--card);box-shadow:0 -1px 6px rgba(0,0,0,.06);gap:10px;padding-bottom:calc(10px + var(--safe-bottom))}
.detail-bottom .add-btn{display:flex;align-items:center;gap:4px;padding:10px 14px;border-radius:10px;border:1.5px solid var(--border);font-size:13px;font-weight:600;cursor:pointer;background:#fff;white-space:nowrap}
.detail-bottom .avg-info{flex:1;text-align:center;font-size:12px;color:var(--text-sub)}
.detail-bottom .avg-info b{display:block;font-size:14px;color:var(--primary);font-weight:800}
.detail-bottom .buy-btn{padding:10px 20px;border-radius:10px;background:var(--primary);color:#fff;font-size:14px;font-weight:700;border:none;cursor:pointer;white-space:nowrap}
.detail-bottom .buy-btn:active{opacity:.85}

/* Price graph card */
.graph-card{margin:0 16px 12px;background:var(--card);border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.graph-title{font-size:14px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.price-stats{display:flex;flex-direction:column;gap:8px;margin-top:12px}
.price-stat{display:flex;align-items:center;justify-content:space-between;font-size:13px}
.price-stat .label{display:flex;align-items:center;gap:6px;color:var(--text-sub)}
.price-stat .label .dot{width:8px;height:8px;border-radius:50%}
.price-stat .value{font-weight:700}

/* Alert setting card */
.alert-card{margin:0 16px 12px;background:var(--card);border-radius:14px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.alert-header{padding:14px 16px;font-size:14px;font-weight:700;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
.alert-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
.alert-row:last-child{border-bottom:none}
.alert-row .left{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text)}
.alert-row .right{font-size:13px;color:var(--text-sub);display:flex;align-items:center;gap:4px}
.alert-info{padding:12px 16px;font-size:12px;color:var(--text-sub);background:#f9fafb;border-bottom:1px solid var(--border)}

/* Toggle switch */
.toggle{width:44px;height:24px;border-radius:12px;background:var(--text-light);position:relative;cursor:pointer;transition:.3s;flex-shrink:0}
.toggle.on{background:var(--primary)}
.toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:#fff;transition:.3s;box-shadow:0 1px 3px rgba(0,0,0,.15)}
.toggle.on::after{left:22px}

/* í˜œíƒ page - Pollcent style */
.benefit-tabs{display:flex;padding:12px 16px;gap:8px}
.benefit-tab{flex:1;text-align:center;padding:10px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;background:var(--border);color:var(--text-sub);transition:.2s}
.benefit-tab.active{background:var(--primary);color:#fff}
.ticket-box{margin:0 16px 12px;background:var(--card);border-radius:16px;padding:20px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.ticket-box-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.ticket-box-title h3{font-size:15px;font-weight:700}
.ticket-box-title .tip{font-size:11px;color:var(--primary);font-weight:600;background:var(--primary-light);padding:3px 8px;border-radius:8px}
.ticket-stats{display:flex;gap:16px;margin-bottom:16px}
.ticket-stat{flex:1}
.ticket-stat .label{font-size:12px;color:var(--text-sub);margin-bottom:4px}
.ticket-stat .val{font-size:28px;font-weight:800;color:var(--primary);display:flex;align-items:center;gap:4px}
.ticket-stat .val .icon{font-size:20px}
.ticket-actions{display:flex;gap:8px}
.ticket-actions button{flex:1;padding:10px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;border:1.5px solid var(--border);background:var(--card);transition:.2s}
.ticket-actions button:active{background:var(--border)}
.ticket-actions button.primary{background:var(--primary);color:#fff;border-color:var(--primary)}

/* Event card */
.event-card{margin:0 16px 8px;background:var(--card);border-radius:14px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.event-row{display:flex;align-items:center;padding:14px 16px;gap:12px}
.event-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.event-info{flex:1}
.event-info h4{font-size:14px;font-weight:600;margin-bottom:1px}
.event-info p{font-size:12px;color:var(--text-sub)}
.event-status{font-size:12px;font-weight:600;padding:4px 10px;border-radius:20px;white-space:nowrap}
.event-status.live{background:#DCFCE7;color:#16A34A}
.event-status.end{background:var(--border);color:var(--text-sub)}

/* Raffle */
.raffle-section{margin:0 16px 12px;background:linear-gradient(135deg,#6366F1,#818CF8);border-radius:16px;padding:24px;text-align:center;color:#fff}
.raffle-section h3{font-size:18px;font-weight:800;margin-bottom:4px}
.raffle-section p{font-size:12px;opacity:.8;margin-bottom:16px}
.raffle-ball{width:72px;height:72px;border-radius:50%;background:#fff;color:var(--primary);font-size:28px;font-weight:800;display:flex;align-items:center;justify-content:center;margin:0 auto 14px;box-shadow:0 4px 16px rgba(0,0,0,.2);transition:.3s}
.raffle-ball.spinning{animation:spin .1s linear infinite}
@keyframes spin{0%{transform:rotate(0) scale(1)}50%{transform:rotate(180deg) scale(1.1)}100%{transform:rotate(360deg) scale(1)}}
.raffle-info{display:flex;align-items:center;justify-content:center;gap:6px;font-size:13px;margin-bottom:14px;opacity:.9}
.raffle-btn{padding:10px 32px;border-radius:12px;background:#fff;color:#6366F1;font-size:14px;font-weight:700;border:none;cursor:pointer}
.raffle-btn:active{opacity:.85}
.raffle-prizes{margin:0 16px 12px}
.raffle-prize-card{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card);border-radius:14px;margin-bottom:8px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.raffle-medal{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:800;color:#fff;flex-shrink:0}
.raffle-medal.r1{background:linear-gradient(135deg,#F59E0B,#D97706)}
.raffle-medal.r2{background:linear-gradient(135deg,#9CA3AF,#6B7280)}
.raffle-medal.r3{background:linear-gradient(135deg,#D97706,#92400E)}
.raffle-prize-info{flex:1}
.raffle-prize-info h4{font-size:14px;font-weight:600}
.raffle-prize-info p{font-size:12px;color:var(--text-sub)}

/* MyPage */
.mypage-profile{padding:24px 16px;background:var(--card);text-align:center;margin-bottom:8px}
.mypage-avatar{width:56px;height:56px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;margin:0 auto 8px}
.mypage-name{font-size:17px;font-weight:700;margin-bottom:2px}
.mypage-email{font-size:13px;color:var(--text-sub)}
.mypage-badge{display:inline-block;margin-top:6px;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600}

.mypage-section{background:var(--card);margin-bottom:8px}
.mypage-section-title{padding:14px 16px 6px;font-size:13px;font-weight:700;color:var(--text-sub)}
.mypage-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer}
.mypage-row:active{background:var(--border)}
.mypage-row .left{display:flex;align-items:center;gap:10px;font-size:14px}
.mypage-row .left .icon{font-size:18px;width:24px;text-align:center}
.mypage-row .right{display:flex;align-items:center;gap:4px;font-size:13px;color:var(--text-sub)}
.mypage-row .arrow{font-size:14px;color:var(--text-light)}
.mypage-divider{height:1px;background:var(--border);margin:0 16px}

/* Stats row */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:0;padding:12px 0;margin:0 16px;border-top:1px solid var(--border)}
.stat-box{text-align:center}
.stat-box .val{font-size:18px;font-weight:800;color:var(--primary)}
.stat-box .lbl{font-size:10px;color:var(--text-sub);margin-top:2px}

/* Modal */
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.45);z-index:200;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:var(--card);border-radius:20px;padding:28px 24px;max-width:320px;width:100%;text-align:center;animation:modalIn .25s}
@keyframes modalIn{from{transform:scale(.92);opacity:0}to{transform:scale(1);opacity:1}}
.modal .icon{font-size:48px;margin-bottom:10px}
.modal h3{font-size:17px;font-weight:700;margin-bottom:6px}
.modal p{font-size:13px;color:var(--text-sub);margin-bottom:16px;line-height:1.5}
.modal-btn{width:100%;padding:12px;border-radius:12px;background:var(--primary);color:#fff;font-size:14px;font-weight:700;border:none;cursor:pointer}

/* Input */
.input-field{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;font-size:15px;outline:none;transition:.2s;background:var(--card)}
.input-field:focus{border-color:var(--primary)}
.input-label{display:block;font-size:12px;font-weight:600;color:var(--text-sub);margin-bottom:4px}

/* Onboarding AI chat */
.onboard{display:flex;flex-direction:column;height:100%}
.onboard-header{text-align:center;padding:20px 16px 10px;padding-top:calc(20px + var(--safe-top))}
.onboard-logo{font-size:28px;font-weight:800;color:var(--primary);letter-spacing:-0.5px}
.onboard-sub{font-size:12px;color:var(--text-sub);margin-top:2px}
.chat-area{flex:1;overflow-y:auto;padding:8px 16px;display:flex;flex-direction:column;gap:6px}
.chat-row{display:flex;gap:8px;align-items:flex-end;animation:chatIn .3s ease}
.chat-row.user{flex-direction:row-reverse}
@keyframes chatIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.chat-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;background:var(--primary-light)}
.chat-bubble{max-width:75%;padding:10px 14px;border-radius:16px;font-size:13px;line-height:1.5;word-break:break-word}
.chat-row:not(.user) .chat-bubble{background:var(--card);border-bottom-left-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.chat-row.user .chat-bubble{background:var(--primary);color:#fff;border-bottom-right-radius:4px}
.chat-typing{display:flex;gap:4px;padding:10px 14px;background:var(--card);border-radius:16px;border-bottom-left-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.06);width:fit-content}
.chat-typing span{width:6px;height:6px;border-radius:50%;background:var(--text-light);animation:typing 1.2s infinite}
.chat-typing span:nth-child(2){animation-delay:.2s}
.chat-typing span:nth-child(3){animation-delay:.4s}
@keyframes typing{0%,60%,100%{opacity:.3;transform:translateY(0)}30%{opacity:1;transform:translateY(-4px)}}
.chat-input-area{padding:10px 16px;padding-bottom:calc(10px + var(--safe-bottom));background:var(--card);box-shadow:0 -1px 6px rgba(0,0,0,.04);display:none;gap:8px;align-items:center}
.chat-input-area.show{display:flex}
.chat-input-area input{flex:1;padding:10px 14px;border:1.5px solid var(--border);border-radius:24px;font-size:14px;outline:none}
.chat-input-area input:focus{border-color:var(--primary)}
.chat-input-area button{width:36px;height:36px;border-radius:50%;background:var(--primary);color:#fff;border:none;font-size:16px;cursor:pointer;flex-shrink:0}
.chat-options{display:flex;flex-wrap:wrap;gap:6px;padding:4px 0}
.chat-opt{padding:8px 16px;border-radius:20px;border:1.5px solid var(--primary);color:var(--primary);font-size:13px;font-weight:600;cursor:pointer;background:#fff;transition:.2s}
.chat-opt:active{background:var(--primary);color:#fff}

/* Empty */
.empty{text-align:center;padding:40px 20px;color:var(--text-light)}
.empty .icon{font-size:40px;margin-bottom:10px}
.empty p{font-size:13px;line-height:1.5}

/* Deeplink info */
.deeplink-info{margin:0 16px 12px;background:#FFFBEB;border:1.5px dashed #F59E0B;border-radius:12px;padding:12px;font-size:11px;color:#92400E}
.deeplink-info code{display:block;margin-top:6px;padding:6px;background:#FEF3C7;border-radius:6px;font-size:10px;word-break:break-all}

/* Sub-page overlay (ê³µì§€ì‚¬í•­ etc) */
.sub-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:160;display:none;flex-direction:column}
.sub-overlay.show{display:flex}
.sub-header{display:flex;align-items:center;padding:12px 16px;padding-top:calc(12px + var(--safe-top));background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,.04);flex-shrink:0}
.sub-header button{width:36px;height:36px;border:none;background:transparent;font-size:18px;cursor:pointer}
.sub-header h2{flex:1;text-align:center;font-size:15px;font-weight:700;margin-right:36px}
.sub-body{flex:1;overflow-y:auto;padding:16px}
</style>
</head>
<body>

<!-- Header -->
<div class="header" id="main-header">
  <h1 id="header-title">ê´€ì‹¬ìƒí’ˆ</h1>
  <div class="header-icons">
    <span id="header-bell">ğŸ””</span>
    <span id="header-setting">âš™ï¸</span>
  </div>
</div>

<!-- Content -->
<div class="content" id="content">

  <!-- Onboarding AI Chat -->
  <div class="page active" id="page-start">
    <div class="onboard">
      <div class="onboard-header">
        <div class="onboard-logo">PricePick</div>
        <div class="onboard-sub">AI ì‡¼í•‘ ì–´ì‹œìŠ¤í„´íŠ¸</div>
      </div>
      <div class="chat-area" id="chat-area"></div>
      <div class="chat-input-area" id="chat-input-area">
        <input type="text" id="chat-input" placeholder="ì…ë ¥í•´ì£¼ì„¸ìš”..." onkeydown="if(event.key==='Enter')sendChatInput()">
        <button onclick="sendChatInput()">â†’</button>
      </div>
    </div>
  </div>

  <!-- ê´€ì‹¬ìƒí’ˆ -->
  <div class="page" id="page-wish">
    <div style="padding:10px 16px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
        <span class="chip active" id="wish-count">ì „ì²´ 0</span>
        <span class="chip" onclick="switchTab('search')" style="font-size:14px;padding:6px 12px">+ ì¶”ê°€</span>
      </div>
    </div>
    <div class="category-row">
      <div class="cat-item"><div class="cat-icon">ğŸ›’</div><div class="cat-label">êµ¬ë§¤íƒ€ì´ë°</div></div>
      <div class="cat-item"><div class="cat-icon">ğŸ“‰</div><div class="cat-label">ì—­ëŒ€ìµœì €ê°€</div></div>
      <div class="cat-item"><div class="cat-icon">ğŸ”„</div><div class="cat-label">ìì£¼ ì‚° ìƒí’ˆ</div></div>
      <div class="cat-item"><div class="cat-icon">ğŸ”¥</div><div class="cat-label">ìµœê·¼ í• ì¸</div></div>
      <div class="cat-item"><div class="cat-icon">â­</div><div class="cat-label">ì¸ê¸°ìƒí’ˆ</div></div>
    </div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 16px">
      <span style="font-size:12px;color:var(--text-sub)">ìµœì‹ ìˆœ</span>
      <div style="display:flex;gap:12px">
        <span style="font-size:12px;color:var(--text-sub);cursor:pointer">í•„í„°</span>
        <span style="font-size:12px;color:var(--text-sub);cursor:pointer">í¸ì§‘</span>
      </div>
    </div>
    <div id="wish-list"></div>
  </div>

  <!-- í•«ë”œ -->
  <div class="page" id="page-hot">
    <div class="banner b1" style="margin-top:12px">
      <h3>ì´ë²ˆ ì£¼ íŠ¹ê°€ ëª¨ìŒ</h3>
      <p>ë†“ì¹˜ë©´ í›„íšŒí•  í•«ë”œì„ ëª¨ì•˜ì–´ìš”</p>
    </div>
    <div class="section-header">ì‹¤ì‹œê°„ ì¸ê¸° ìƒí’ˆ <span class="more">ë”ë³´ê¸° â€º</span></div>
    <div class="section-sub">ìµœê·¼ 2ì‹œê°„ ë™ì•ˆ ë§ì´ êµ¬ë§¤í•œ ìƒí’ˆì´ì—ìš”.</div>
    <div class="h-scroll" id="hot-scroll"></div>
    <div class="goldbox">
      <div class="goldbox-header">
        <span style="font-size:18px">ğŸ†</span>
        <h3>ê³¨ë“œë°•ìŠ¤ íŠ¹ê°€</h3>
        <div class="countdown"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> <span id="countdown-timer">--:--:--</span></div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px" id="goldbox-grid"></div>
    </div>
    <div class="section-header">ì¶”ì²œ ìƒí’ˆ</div>
    <div class="product-grid" id="product-grid"></div>
  </div>

  <!-- í˜œíƒ -->
  <div class="page" id="page-benefit">
    <div style="padding:12px 16px 0"><div style="font-size:11px;color:var(--text-sub);background:var(--primary-light);padding:8px 12px;border-radius:10px;text-align:center">ğŸ« êµ¬ë§¤ ì‹œ ì´ë²¤íŠ¸ í‹°ì¼“ì´ ëœë¤ ì§€ê¸‰ë©ë‹ˆë‹¤. ê¸ˆì•¡ì´ í´ìˆ˜ë¡ ë” ì¢‹ì€ í‹°ì¼“!</div></div>

    <div id="benefit-ticket">
      <div class="ticket-box">
        <div class="ticket-box-title">
          <h3>ë‚´ ì´ë²¤íŠ¸ í‹°ì¼“</h3>
          <span class="tip">ê¸ˆì•¡ì´ í´ìˆ˜ë¡ ì¢‹ì€ í‹°ì¼“!</span>
        </div>
        <div class="ticket-stats">
          <div class="ticket-stat"><div class="label">ì ë¦½ì˜ˆì •</div><div class="val"><span class="icon">ğŸ«</span> <span id="ticket-pending">0</span></div></div>
          <div class="ticket-stat"><div class="label">ì‚¬ìš©ê°€ëŠ¥</div><div class="val"><span class="icon">ğŸ«</span> <span id="ticket-available">0</span></div></div>
        </div>
        <div class="ticket-actions">
          <button onclick="showModal('ğŸ«','ì´ë²¤íŠ¸ í‹°ì¼“ ì•ˆë‚´','êµ¬ë§¤ ì‹œ ì´ë²¤íŠ¸ í‹°ì¼“ì´ ìë™ ì§€ê¸‰ë©ë‹ˆë‹¤.<br>ê¸ˆì•¡ì´ í´ìˆ˜ë¡ ë” ì¢‹ì€ í‹°ì¼“ì´ ë‚˜ì˜¬ ìˆ˜ ìˆì–´ìš”!<br><br>í‹°ì¼“ìœ¼ë¡œ ì¶”ì²¨ì— ì‘ëª¨í•˜ê³  ê²½í’ˆì„ ë°›ì•„ë³´ì„¸ìš”.')">ë‚´ ê¸°í”„í‹°ì½˜</button>
          <button class="primary" onclick="switchTab('benefit');scrollToRaffle()">í‹°ì¼“ ì‚¬ìš©í•˜ê¸°</button>
        </div>
      </div>

      <div class="section-header" style="padding-top:8px">PricePick ì‡¼í•‘ ì´ë²¤íŠ¸</div>
      <div class="event-card">
        <div class="event-row">
          <div class="event-icon" style="background:#EFF6FF">ğŸ›ï¸</div>
          <div class="event-info"><h4>ì¿ íŒ¡ ì‡¼í•‘ ì ë¦½</h4><p>êµ¬ë§¤ ì‹œ ëœë¤ í‹°ì¼“ ì§€ê¸‰</p></div>
          <span class="event-status live">ì§„í–‰ì¤‘</span>
        </div>
      </div>
      <div class="event-card">
        <div class="event-row">
          <div class="event-icon" style="background:#FEF3C7">ğŸ°</div>
          <div class="event-info"><h4>ì´ë²¤íŠ¸ í‹°ì¼“ ì¶”ì²¨</h4><p>í‹°ì¼“ìœ¼ë¡œ ê²½í’ˆ ì‘ëª¨!</p></div>
          <span class="event-status live">ì§„í–‰ì¤‘</span>
        </div>
      </div>

      <div class="section-header" id="raffle-anchor">ì´ë‹¬ì˜ ì¶”ì²¨</div>
      <div class="raffle-section">
        <h3>ê²½í’ˆ ì¶”ì²¨</h3>
        <p>ì´ë²¤íŠ¸ í‹°ì¼“ìœ¼ë¡œ ì‘ëª¨í•˜ì„¸ìš”</p>
        <div class="raffle-ball" id="raffle-ball">?</div>
        <div class="raffle-info">ë‚´ í‹°ì¼“: <b id="raffle-tickets">0</b>ì¥</div>
        <button class="raffle-btn" onclick="doRaffle()">ì¶”ì²¨í•˜ê¸°</button>
      </div>
      <div class="section-header">ê²½í’ˆ ì•ˆë‚´</div>
      <div class="raffle-prizes" id="raffle-prizes"></div>
    </div>

  </div>

  <!-- ê²€ìƒ‰ -->
  <div class="page" id="page-search">
    <div style="padding:12px 16px">
      <div style="display:flex;gap:8px;align-items:center">
        <input type="text" class="input-field" id="search-input" placeholder="ì°¾ëŠ” ìƒí’ˆì´ ìˆë‚˜ìš”?" oninput="doSearch()" style="flex:1">
      </div>
    </div>
    <div style="padding:0 16px 8px">
      <div style="font-size:13px;font-weight:700;margin-bottom:8px">ì¶”ì²œ ê²€ìƒ‰ì–´</div>
      <div style="display:flex;flex-wrap:wrap;gap:6px" id="search-tags"></div>
    </div>
    <div id="search-results" style="padding:0 16px"></div>
  </div>

  <!-- ë§ˆì´í˜ì´ì§€ -->
  <div class="page" id="page-my">
    <div class="mypage-profile">
      <div class="mypage-avatar" id="my-avatar">P</div>
      <div class="mypage-name" id="my-name">-</div>
      <div class="mypage-email" id="my-email">-</div>
      <div id="my-badge-area"></div>
    </div>
    <div class="mypage-section">
      <div class="stats-grid">
        <div class="stat-box"><div class="val" id="my-tickets">0</div><div class="lbl">í‹°ì¼“</div></div>
        <div class="stat-box"><div class="val" id="my-purchases">0</div><div class="lbl">êµ¬ë§¤</div></div>
        <div class="stat-box"><div class="val" id="my-wishcnt">0</div><div class="lbl">ê´€ì‹¬ìƒí’ˆ</div></div>
        <div class="stat-box"><div class="val" id="my-raffles">0</div><div class="lbl">ì¶”ì²¨</div></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ë©¤ë²„ì‹­</div>
      <div class="mypage-row" onclick="toggleWow()">
        <div class="left"><span class="icon">ğŸš€</span> ì¿ íŒ¡ ì™€ìš° ë©¤ë²„ì‹­</div>
        <div class="right"><div class="toggle" id="toggle-wow"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleMarketing()">
        <div class="left"><span class="icon">ğŸ“¢</span> ë§ˆì¼€íŒ… ìˆ˜ì‹  ë™ì˜</div>
        <div class="right"><div class="toggle" id="toggle-marketing"></div></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ê³„ì • ì—°ë™</div>
      <div class="mypage-row" id="kakao-row" onclick="linkKakao()">
        <div class="left"><span class="icon">ğŸ’¬</span> ì¹´ì¹´ì˜¤ ì—°ë™</div>
        <div class="right" id="kakao-status"><span style="color:var(--primary);font-size:13px">ì—°ë™í•˜ê¸°</span> <span class="arrow">â€º</span></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ì•Œë¦¼ ì„¤ì •</div>
      <div class="mypage-row" onclick="toggleNoti('price')">
        <div class="left"><span class="icon">ğŸ“‰</span> ê°€ê²© í•˜ë½ ì•Œë¦¼</div>
        <div class="right"><div class="toggle on" id="toggle-price"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleNoti('restock')">
        <div class="left"><span class="icon">ğŸ“¦</span> ì¬ì…ê³  ì•Œë¦¼</div>
        <div class="right"><div class="toggle" id="toggle-restock"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleNoti('event')">
        <div class="left"><span class="icon">ğŸ‰</span> ì´ë²¤íŠ¸ ì•Œë¦¼</div>
        <div class="right"><div class="toggle on" id="toggle-event"></div></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ê³ ê°ì„¼í„°</div>
      <div class="mypage-row" onclick="openSub('notice')">
        <div class="left"><span class="icon">ğŸ“‹</span> ê³µì§€ì‚¬í•­</div>
        <div class="right"><span class="arrow">â€º</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="openSub('inquiry')">
        <div class="left"><span class="icon">ğŸ’¬</span> 1:1 ë¬¸ì˜í•˜ê¸°</div>
        <div class="right"><span class="arrow">â€º</span></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ì•½ê´€ ë° ì •ì±…</div>
      <div class="mypage-row" onclick="openSub('terms')">
        <div class="left"><span class="icon">ğŸ“„</span> ì´ìš©ì•½ê´€</div>
        <div class="right"><span class="arrow">â€º</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="openSub('privacy')">
        <div class="left"><span class="icon">ğŸ”’</span> ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</div>
        <div class="right"><span class="arrow">â€º</span></div>
      </div>
    </div>
    <div class="mypage-section" style="margin-bottom:20px">
      <div class="mypage-row" onclick="doLogout()">
        <div class="left" style="color:var(--text-sub)"><span class="icon">ğŸšª</span> ë¡œê·¸ì•„ì›ƒ</div>
        <div class="right"><span class="arrow">â€º</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="doDeleteAccount()">
        <div class="left" style="color:var(--red)"><span class="icon">âš ï¸</span> ê³„ì •íƒˆí‡´</div>
        <div class="right"><span class="arrow">â€º</span></div>
      </div>
    </div>
  </div>
</div>

<!-- Tab bar -->
<div class="tabbar" id="tabbar" style="display:none">
  <div class="tab active" data-tab="wish" onclick="switchTab('wish')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
    ê´€ì‹¬ìƒí’ˆ
  </div>
  <div class="tab" data-tab="hot" onclick="switchTab('hot')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.22.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
    í•«ë”œ
  </div>
  <div class="tab tab-center" data-tab="search" onclick="switchTab('search')">
    <button class="tab-center-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" width="22" height="22"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    </button>
    <span style="margin-top:30px;font-size:10px;color:var(--text-sub)">ê²€ìƒ‰</span>
  </div>
  <div class="tab" data-tab="benefit" onclick="switchTab('benefit')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="2" y="6" width="20" height="14" rx="2"/><path d="M2 10h20"/><path d="M12 6v14"/></svg>
    í˜œíƒ
  </div>
  <div class="tab" data-tab="my" onclick="switchTab('my')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    ë§ˆì´
  </div>
</div>

<!-- Product Detail Overlay -->
<div class="detail-overlay" id="detail-overlay">
  <div class="detail-top">
    <button onclick="closeDetail()">â†</button>
    <button>ğŸ”—</button>
    <button class="share">ğŸ“¤</button>
  </div>
  <div class="detail-scroll" id="detail-scroll"></div>
  <div class="detail-bottom" id="detail-bottom"></div>
</div>

<!-- Sub-page Overlay -->
<div class="sub-overlay" id="sub-overlay">
  <div class="sub-header">
    <button onclick="closeSub()">â†</button>
    <h2 id="sub-title">-</h2>
  </div>
  <div class="sub-body" id="sub-body"></div>
</div>

<!-- Add Product Modal -->
<div class="modal-overlay" id="add-modal" onclick="if(event.target===this)closeAddModal()">
  <div class="modal" style="max-width:340px;padding:20px 16px;text-align:left">
    <h3 style="text-align:center;margin-bottom:12px">ê´€ì‹¬ìƒí’ˆ ì¶”ê°€</h3>
    <div style="margin-bottom:10px"><span class="input-label">ìƒí’ˆ ì„ íƒ</span></div>
    <div id="add-product-list" style="max-height:300px;overflow-y:auto"></div>
    <button class="modal-btn" style="margin-top:12px" onclick="closeAddModal()">ë‹«ê¸°</button>
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal" id="modal-content"></div>
</div>

<script>
// ===== DATA =====
var PRODUCTS=[
  {id:1,name:'LG ìŠ¤íƒ ë°”ì´ë¯¸ 27ì¸ì¹˜ í¬í„°ë¸” ëª¨ë‹ˆí„°',emoji:'ğŸ–¥ï¸',originalPrice:1190000,currentPrice:899000,discount:24,url:'https://www.coupang.com/vp/products/7335498014',badge:'rocket',ai:'ì´ë™ì‹ í„°ì¹˜ ëª¨ë‹ˆí„°. ë„·í”Œë¦­ìŠ¤Â·ìœ íŠœë¸Œ ì–´ë””ì„œë“  ì‹œì²­ ê°€ëŠ¥. ë°°í„°ë¦¬ ë‚´ì¥ìœ¼ë¡œ ì¶©ì „ í›„ 3ì‹œê°„ ì‚¬ìš©.'},
  {id:2,name:'ì• í”Œ ì—ì–´íŒŸ í”„ë¡œ 2ì„¸ëŒ€ USB-C',emoji:'ğŸ§',originalPrice:359000,currentPrice:289000,discount:19,url:'https://www.coupang.com/vp/products/7601553541',badge:'rocket',ai:'ì•¡í‹°ë¸Œ ë…¸ì´ì¦ˆìº”ìŠ¬ë§ + ì ì‘í˜• ì˜¤ë””ì˜¤. USB-C ì¶©ì „ìœ¼ë¡œ í¸ë¦¬. ì•„ì´í° ìœ ì € í•„ìˆ˜í…œ.'},
  {id:3,name:'ë‹¤ì´ìŠ¨ V15 ë””í…íŠ¸ ë¬´ì„ ì²­ì†Œê¸°',emoji:'ğŸ§¹',originalPrice:1290000,currentPrice:899000,discount:30,url:'https://www.coupang.com/vp/products/6497498498',badge:'hot',ai:'ë ˆì´ì €ë¡œ ë¯¸ì„¸ë¨¼ì§€ê¹Œì§€ ì‹œê°í™”. ìë™ í¡ì…ë ¥ ì¡°ì ˆ. 60ë¶„ ì—°ì† ì‚¬ìš©. ë¨¼ì§€ ì•Œë ˆë¥´ê¸° ê°€ì • ì¶”ì²œ.'},
  {id:4,name:'ì‚¼ì„± ê°¤ëŸ­ì‹œ ë²„ì¦ˆ3 í”„ë¡œ',emoji:'ğŸµ',originalPrice:359900,currentPrice:279000,discount:22,url:'https://www.coupang.com/vp/products/8040177674',badge:'rocket',ai:'ê°¤ëŸ­ì‹œ ìœ ì € ìµœì í™” ì´ì–´í°. ANC + 360 ì˜¤ë””ì˜¤. í†µí™” í’ˆì§ˆ íƒì›”. ì•ˆë“œë¡œì´ë“œ ê¸°ë³¸ í˜¸í™˜.'},
  {id:5,name:'ë‚˜ì´í‚¤ ì—ì–´í¬ìŠ¤1 07 í™”ì´íŠ¸',emoji:'ğŸ‘Ÿ',originalPrice:139000,currentPrice:99900,discount:28,url:'https://www.coupang.com/vp/products/6023436854',badge:'lowest',ai:'30ë…„ ë„˜ëŠ” í´ë˜ì‹ ìŠ¤ë‹ˆì»¤ì¦ˆ. ì–´ë–¤ ì½”ë””ì—ë„ ë¬´ë‚œ. ê°€ì£½ ê°‘í”¼ë¡œ ë‚´êµ¬ì„± ìš°ìˆ˜.'},
  {id:6,name:'ìƒ¤ì˜¤ë¯¸ ë¡œë´‡ì²­ì†Œê¸° X20 Pro Plus',emoji:'ğŸ¤–',originalPrice:899000,currentPrice:599000,discount:33,url:'https://www.coupang.com/vp/products/7812345678',badge:'hot',ai:'ìë™ ë¬¼ê±¸ë ˆ+ë¨¼ì§€ ë¹„ì›€. ì¥ì• ë¬¼ íšŒí”¼ AI. ë„“ì€ ì§‘ë„ í•œ ë²ˆì— ì²­ì†Œ. ê°€ì„±ë¹„ ìµœê³ .'},
  {id:7,name:'í¬ì¹´ë¦¬ìŠ¤ì›¨íŠ¸ 1.5L 12ê°œ',emoji:'ğŸ’§',originalPrice:28000,currentPrice:25600,discount:9,url:'https://www.coupang.com/vp/products/1234567890',badge:'rocket',ai:'ìš´ë™ í›„ ìˆ˜ë¶„Â·ì „í•´ì§ˆ ë³´ì¶©ì— ìµœì . ëŒ€ìš©ëŸ‰ 12ê°œ ì„¸íŠ¸ë¡œ ë‹¨ê°€ ì ˆì•½.'},
  {id:8,name:'í”„ë¡œí• ìŠ¤í¬ì¸  WPI ì´ˆì½œë¦¿ 330ml x12',emoji:'ğŸ¥›',originalPrice:29000,currentPrice:24900,discount:14,url:'https://www.coupang.com/vp/products/2345678901',badge:'rocket',ai:'ë¶„ë¦¬ìœ ì²­ë‹¨ë°± WPI ê¸°ë°˜. ìš´ë™ ì§í›„ ë‹¨ë°±ì§ˆ ë³´ì¶©ì— ì¢‹ì•„ìš”. ì´ˆì½œë¦¿ë§›ìœ¼ë¡œ ë§›ë„ OK.'},
];

var RAFFLE_PRIZES=[
  {rank:1,prize:'ë„ë¯¸ë…¸í”¼ì ë¼ì§€ ì„¸íŠ¸',icon:'ğŸ•',desc:'í˜í¼ë¡œë‹ˆ + ì½œë¼ 1.25L'},
  {rank:2,prize:'ë§¥ë„ë‚ ë“œ ë¹…ë§¥ ì„¸íŠ¸',icon:'ğŸ”',desc:'ë¹…ë§¥ + ê°ìíŠ€ê¹€ + ì½œë¼'},
  {rank:3,prize:'ìŠ¤íƒ€ë²…ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸',icon:'â˜•',desc:'Tall ì‚¬ì´ì¦ˆ'},
];

// ===== STORAGE =====
function S(k,v){if(v===undefined){try{return JSON.parse(localStorage.getItem('pp_'+k))}catch(e){return null}}localStorage.setItem('pp_'+k,JSON.stringify(v))}
function getUser(){return S('user')}
function getTracks(){return S('tracks')||[]}
function setTracks(t){S('tracks',t)}
function getTickets(){return S('tickets')||{pending:0,available:0,history:[]}}
function setTickets(t){S('tickets',t)}
function getPurchases(){return S('purchases')||[]}
function getSettings(){return S('settings')||{wow:false,marketing:false}}
function setSettings(s){S('settings',s)}
function getRaffleCount(){return S('raffles')||0}
function setRaffleCount(n){S('raffles',n)}

// ===== ONBOARDING AI CHAT =====
var obStep=0;
var obData={nickname:'',wow:false,noti:true};
var chatArea,chatInput,chatInputArea;

function startOnboarding(){
  chatArea=document.getElementById('chat-area');
  chatInput=document.getElementById('chat-input');
  chatInputArea=document.getElementById('chat-input-area');
  obStep=0;
  chatArea.innerHTML='';
  setTimeout(function(){obNext()},500);
}

function obNext(){
  if(obStep===0){
    addBotMsg('ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹');
    setTimeout(function(){
      addBotMsg('ì €ëŠ” PricePick AI ì–´ì‹œìŠ¤í„´íŠ¸ì˜ˆìš”.\nì¿ íŒ¡ ìµœì €ê°€ë¥¼ ì¶”ì í•˜ê³ , ì‡¼í•‘í•  ë•Œ ë¦¬ì›Œë“œë¥¼ ë°›ì„ ìˆ˜ ìˆë„ë¡ ë„ì™€ë“œë ¤ìš”!');
      setTimeout(function(){
        addBotMsg('ë¨¼ì €, ì–´ë–¤ ì´ë¦„ìœ¼ë¡œ ë¶ˆëŸ¬ë“œë¦´ê¹Œìš”?');
        showInput('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
        obStep=1;
      },800);
    },600);
  } else if(obStep===2){
    addBotMsg(obData.nickname+'ë‹˜, ë°˜ê°€ì›Œìš”! ğŸ˜Š');
    setTimeout(function(){
      addBotMsg('í˜¹ì‹œ ì¿ íŒ¡ ì™€ìš° íšŒì›ì´ì‹ ê°€ìš”?\nì™€ìš° íšŒì›ì´ë©´ ë” ë¹ ë¥¸ ë¦¬ì›Œë“œ í˜œíƒì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆì–´ìš”!');
      showOptions(['ë„¤, ì™€ìš° íšŒì›ì´ì—ìš” ğŸš€','ì•„ë‹ˆìš”, ì¼ë°˜ íšŒì›ì´ì—ìš”']);
      obStep=3;
    },700);
  } else if(obStep===4){
    var wowMsg=obData.wow?'ì™€ìš° íšŒì›ì´ì‹œêµ°ìš”! ë¦¬ì›Œë“œ ì ë¦½ì´ ë” ë¹¨ë¼ì ¸ìš” ğŸ‰':'ë‚˜ì¤‘ì— ë§ˆì´í˜ì´ì§€ì—ì„œ ì–¸ì œë“  ì™€ìš° ë©¤ë²„ì‹­ì„ ì„¤ì •í•  ìˆ˜ ìˆì–´ìš”!';
    addBotMsg(wowMsg);
    setTimeout(function(){
      addBotMsg('ê°€ê²©ì´ ë‚´ë ¤ê°€ë©´ ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦´ê¹Œìš”?\nê´€ì‹¬ìƒí’ˆì˜ ê°€ê²© ë³€ë™ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•´ë“œë ¤ìš”!');
      showOptions(['ë„¤, ì•Œë¦¼ ë°›ì„ê²Œìš” ğŸ””','ì•„ë‹ˆìš”, ê´œì°®ì•„ìš”']);
      obStep=5;
    },700);
  } else if(obStep===6){
    var notiMsg=obData.noti?'ì¢‹ì•„ìš”! ìµœì €ê°€ë¥¼ ë†“ì¹˜ì§€ ì•Šë„ë¡ ì•Œë ¤ë“œë¦´ê²Œìš” ğŸ“Š':'ì•Œê² ì–´ìš”! ë‚˜ì¤‘ì— ë§ˆì´í˜ì´ì§€ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”.';
    addBotMsg(notiMsg);
    setTimeout(function(){
      addBotMsg('PricePickì€ ì´ë ‡ê²Œ ë„ì™€ë“œë ¤ìš”:');
      setTimeout(function(){
        addBotMsg('ğŸ“Š <b>ê°€ê²© ì¶”ì </b> â€” ê´€ì‹¬ìƒí’ˆì˜ ê°€ê²©ì„ ë§¤ì¼ ì¶”ì í•˜ê³  ì—­ëŒ€ ìµœì €ê°€ë¥¼ ì•Œë ¤ë“œë ¤ìš”');
        setTimeout(function(){
          addBotMsg('ğŸ« <b>ì‡¼í•‘ ë¦¬ì›Œë“œ</b> â€” êµ¬ë§¤í•˜ë©´ ì´ë²¤íŠ¸ í‹°ì¼“ì´ ì§€ê¸‰ë¼ìš”. ê¸ˆì•¡ì´ í´ìˆ˜ë¡ ë” ì¢‹ì€ í‹°ì¼“!');
          setTimeout(function(){
            addBotMsg('ğŸ• <b>ê²½í’ˆ ì¶”ì²¨</b> â€” í‹°ì¼“ìœ¼ë¡œ ë„ë¯¸ë…¸í”¼ì, ë§¥ë„ë‚ ë“œ, ìŠ¤íƒ€ë²…ìŠ¤ ë“± ê²½í’ˆì— ì‘ëª¨í•´ìš”');
            setTimeout(function(){
              addBotMsg('ê·¸ëŸ¼ ì‹œì‘í•´ë³¼ê¹Œìš”? ğŸ˜„');
              showOptions(['ì‹œì‘í•˜ê¸°! ğŸ‰']);
              obStep=7;
            },600);
          },600);
        },600);
      },500);
    },600);
  } else if(obStep===8){
    addBotMsg('ì¢‹ì•„ìš”! '+obData.nickname+'ë‹˜ì˜ ê³„ì •ì´ ìƒì„±ë˜ì—ˆì–´ìš”. âœ…\nì§€ê¸ˆë¶€í„° ìŠ¤ë§ˆíŠ¸í•œ ì‡¼í•‘ì„ ì‹œì‘í•´ë³´ì„¸ìš”!');
    setTimeout(function(){
      S('user',{nickname:obData.nickname,email:obData.nickname.toLowerCase()+'@pricepick.app',joined:new Date().toISOString().slice(0,10)});
      var settings=getSettings();
      settings.wow=obData.wow;
      settings.marketing=obData.noti;
      setSettings(settings);
      setTimeout(function(){initApp()},1000);
    },800);
  }
}

function addBotMsg(text){
  var row=document.createElement('div');row.className='chat-row';
  row.innerHTML='<div class="chat-avatar">ğŸ¤–</div><div class="chat-bubble">'+text+'</div>';
  chatArea.appendChild(row);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function addUserMsg(text){
  var row=document.createElement('div');row.className='chat-row user';
  row.innerHTML='<div class="chat-avatar" style="background:var(--primary);color:#fff;font-size:12px;font-weight:700">ë‚˜</div><div class="chat-bubble">'+text+'</div>';
  chatArea.appendChild(row);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function addTyping(){
  var row=document.createElement('div');row.className='chat-row';row.id='typing-row';
  row.innerHTML='<div class="chat-avatar">ğŸ¤–</div><div class="chat-typing"><span></span><span></span><span></span></div>';
  chatArea.appendChild(row);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function removeTyping(){var el=document.getElementById('typing-row');if(el)el.remove()}

function showInput(placeholder){
  chatInputArea.classList.add('show');
  chatInput.placeholder=placeholder||'ì…ë ¥í•´ì£¼ì„¸ìš”...';
  chatInput.value='';
  chatInput.focus();
}

function hideInput(){chatInputArea.classList.remove('show')}

function showOptions(opts){
  hideInput();
  var wrap=document.createElement('div');wrap.className='chat-row';wrap.id='options-row';
  var inner='<div style="width:32px;flex-shrink:0"></div><div class="chat-options">';
  opts.forEach(function(o,i){
    inner+='<div class="chat-opt" onclick="pickOption('+i+',this)">'+o+'</div>';
  });
  inner+='</div>';
  wrap.innerHTML=inner;
  chatArea.appendChild(wrap);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function removeOptions(){var el=document.getElementById('options-row');if(el)el.remove()}

function sendChatInput(){
  var val=chatInput.value.trim();
  if(!val)return;
  hideInput();
  addUserMsg(val);
  if(obStep===1){
    obData.nickname=val;
    obStep=2;
    addTyping();
    setTimeout(function(){removeTyping();obNext()},800);
  }
}

function pickOption(idx,el){
  var text=el.textContent;
  removeOptions();
  addUserMsg(text);
  if(obStep===3){
    obData.wow=idx===0;
    obStep=4;
  } else if(obStep===5){
    obData.noti=idx===0;
    obStep=6;
  } else if(obStep===7){
    obStep=8;
  }
  addTyping();
  setTimeout(function(){removeTyping();obNext()},800);
}

function doLogout(){if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){localStorage.clear();location.reload()}}
function doDeleteAccount(){if(confirm('ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')){localStorage.clear();location.reload()}}

// ===== TABS =====
var TITLES={wish:'ê´€ì‹¬ìƒí’ˆ',hot:'í•«ë”œ',search:'ê²€ìƒ‰',benefit:'í˜œíƒ',my:'ë§ˆì´í˜ì´ì§€'};
function switchTab(name){
  document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active')});
  document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('active')});
  var pg=document.getElementById('page-'+name);
  if(pg)pg.classList.add('active');
  var tb=document.querySelector('.tab[data-tab="'+name+'"]');
  if(tb)tb.classList.add('active');
  document.getElementById('header-title').textContent=TITLES[name]||'';
  if(name==='wish')renderWishlist();
  if(name==='hot')renderHotdeals();
  if(name==='search')renderSearch();
  if(name==='benefit')renderBenefit();
  if(name==='my')renderMypage();
  document.getElementById('content').scrollTop=0;
}

// ===== INIT =====
function initApp(){
  var u=getUser();
  if(!u){
    document.getElementById('page-start').classList.add('active');
    document.getElementById('tabbar').style.display='none';
    document.getElementById('main-header').style.display='none';
    startOnboarding();
    return;
  }
  document.getElementById('page-start').classList.remove('active');
  document.getElementById('main-header').style.display='flex';
  document.getElementById('tabbar').style.display='flex';
  processTickets();
  switchTab('wish');
  startCountdown();
}

// ===== WISHLIST (ê´€ì‹¬ìƒí’ˆ) =====
function renderWishlist(){
  var tracks=getTracks();
  document.getElementById('wish-count').textContent='ì „ì²´ '+tracks.length;
  var html='';
  if(tracks.length===0){
    html='<div class="empty"><div class="icon">ğŸ‘€</div><p>ê´€ì‹¬ìƒí’ˆì„ ë“±ë¡í•´ë³´ì„¸ìš”<br>í•«ë”œì´ë‚˜ ê²€ìƒ‰ì—ì„œ ìƒí’ˆì„ ì°¾ì•„<br>ê´€ì‹¬ìƒí’ˆìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”!</p></div>';
  }
  tracks.forEach(function(t,i){
    var change=Math.round((Math.random()*6-3)*10)/10;
    var changeClass=change<0?'down':'up';
    var arrow=change<0?'â–¼':'â–²';
    html+='<div class="track-card" onclick="openDetail('+t.productId+',true)">';
    html+='<div class="track-thumb">'+t.emoji+'</div>';
    html+='<div class="track-body"><div class="track-name">'+t.name+'</div>';
    html+='<div class="track-price-row"><span class="track-current">'+t.currentPrice.toLocaleString()+'ì›</span>';
    html+='<span class="track-change '+changeClass+'">'+arrow+' '+Math.abs(change)+'%</span></div></div></div>';
  });
  document.getElementById('wish-list').innerHTML=html;
}

// ===== HOTDEALS (í•«ë”œ) =====
function renderHotdeals(){
  // Horizontal popular
  var hhtml='';
  PRODUCTS.slice(0,5).forEach(function(p){
    hhtml+='<div class="h-card" onclick="openDetail('+p.id+')">';
    hhtml+='<div class="h-card-img">'+p.emoji+'';
    if(p.badge==='lowest')hhtml+='<div style="position:absolute;top:4px;left:4px;background:var(--red);color:#fff;font-size:9px;padding:2px 5px;border-radius:3px;font-weight:700">ì—­ëŒ€ìµœì €ê°€</div>';
    hhtml+='</div>';
    hhtml+='<div class="h-card-name">'+p.name+'</div>';
    hhtml+='<div class="h-card-price">'+p.currentPrice.toLocaleString()+'ì›</div>';
    hhtml+='<div class="h-card-discount">'+p.discount+'%</div></div>';
  });
  document.getElementById('hot-scroll').innerHTML=hhtml;
  // Goldbox
  var ghtml='';
  PRODUCTS.slice(2,5).forEach(function(p){
    ghtml+='<div style="text-align:center;cursor:pointer" onclick="openDetail('+p.id+')">';
    ghtml+='<div style="width:100%;aspect-ratio:1;background:#f8f9fa;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:4px">'+p.emoji+'</div>';
    ghtml+='<div style="font-size:11px;line-height:1.2;height:27px;overflow:hidden">'+p.name+'</div>';
    ghtml+='<div style="font-size:12px;font-weight:700;margin-top:2px">'+p.currentPrice.toLocaleString()+'ì›</div></div>';
  });
  document.getElementById('goldbox-grid').innerHTML=ghtml;
  // Grid
  var phtml='';
  PRODUCTS.forEach(function(p){
    var badgeClass=p.badge==='hot'?'badge-hot':p.badge==='lowest'?'badge-lowest':'badge-rocket';
    var badgeText=p.badge==='hot'?'í•«ë”œ':p.badge==='lowest'?'ì—­ëŒ€ìµœì €ê°€':'ë¡œì¼“ë°°ì†¡';
    phtml+='<div class="product-card" onclick="openDetail('+p.id+')">';
    phtml+='<div class="product-img"><div class="img-placeholder">'+p.emoji+'</div>';
    phtml+='<div class="product-badge '+badgeClass+'">'+badgeText+'</div></div>';
    phtml+='<div class="product-info"><p class="product-name">'+p.name+'</p>';
    phtml+='<div class="product-price-row"><span class="product-price">'+p.currentPrice.toLocaleString()+'ì›</span>';
    phtml+='<span class="product-change down">â–¼'+p.discount+'%</span></div></div></div>';
  });
  document.getElementById('product-grid').innerHTML=phtml;
}

// ===== COUNTDOWN =====
var countdownInterval;
function startCountdown(){
  if(countdownInterval)clearInterval(countdownInterval);
  var end=new Date();end.setHours(23,59,59,999);
  countdownInterval=setInterval(function(){
    var now=new Date();var diff=end-now;
    if(diff<=0){diff=0}
    var h=Math.floor(diff/3600000);var m=Math.floor((diff%3600000)/60000);var s=Math.floor((diff%60000)/1000);
    document.getElementById('countdown-timer').textContent=
      (h<10?'0':'')+h+':'+(m<10?'0':'')+m+':'+(s<10?'0':'')+s+' ë‚¨ìŒ';
  },1000);
}

// ===== PRODUCT DETAIL (Pollcent price graph style) =====
var currentDetailId=null;
var chartInstance=null;
function openDetail(id,fromWish){
  currentDetailId=id;
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var tracks=getTracks();
  var tracked=tracks.find(function(t){return t.productId===id});
  // Generate history
  var history=tracked?tracked.history:genHistory(p);
  var prices=history.map(function(h){return h.price});
  var maxP=Math.max.apply(null,prices),minP=Math.min.apply(null,prices),avgP=Math.round(prices.reduce(function(a,b){return a+b},0)/prices.length);
  var avgDiff=p.currentPrice-avgP;

  var html='';
  // AI summary
  if(p.ai){
    html+='<div style="margin:12px 16px;background:linear-gradient(135deg,#EFF6FF,#E0E7FF);border-radius:14px;padding:14px 16px;box-shadow:0 1px 4px rgba(0,0,0,.04)">';
    html+='<div style="font-size:12px;font-weight:700;color:var(--primary);margin-bottom:4px">ğŸ¤– AI í•œì¤„í‰</div>';
    html+='<div style="font-size:13px;line-height:1.5;color:var(--text)">'+p.ai+'</div></div>';
  }
  // Graph
  html+='<div class="graph-card"><div class="graph-title">PricePick ê°€ê²© ê·¸ë˜í”„ <span style="font-size:12px;color:var(--text-sub)">â“˜</span></div>';
  html+='<canvas id="detail-chart" height="180"></canvas>';
  html+='<div class="price-stats">';
  html+='<div class="price-stat"><span class="label"><span class="dot" style="background:var(--red)"></span> ì—­ëŒ€ìµœê³ ê°€</span><span class="value" style="color:var(--red)">'+maxP.toLocaleString()+'ì›</span></div>';
  html+='<div class="price-stat"><span class="label"><span class="dot" style="background:var(--text-sub)"></span> í‰ê· ê°€</span><span class="value">'+avgP.toLocaleString()+'ì›</span></div>';
  html+='<div class="price-stat"><span class="label"><span class="dot" style="background:var(--green)"></span> ì—­ëŒ€ìµœì €ê°€</span><span class="value" style="color:var(--green)">'+minP.toLocaleString()+'ì›</span></div>';
  html+='</div></div>';

  // Purchase info
  if(!tracked){
    html+='<div style="padding:12px 16px;font-size:13px;color:var(--text-sub);text-align:center;background:var(--card);margin:0 16px 12px;border-radius:12px">ì•„ì§ êµ¬ë§¤í•œ ì  ì—†ëŠ” ìƒí’ˆì´ì—ìš”. â“˜</div>';
  }

  // Alert settings
  html+='<div class="alert-card">';
  html+='<div class="alert-header">ì¶”ê°€ ì•Œë¦¼ ì„¤ì • <span style="font-size:14px;cursor:pointer">âˆ§</span></div>';
  if(!tracked){
    html+='<div class="alert-info">â“˜ ê´€ì‹¬ìƒí’ˆìœ¼ë¡œ ì¶”ê°€í•´ì•¼ ì„¤ì •í•  ìˆ˜ ìˆì–´ìš”.</div>';
  }
  html+='<div class="alert-row"><div class="left">ğŸ“Š ì›í•˜ëŠ” ê°€ê²© ì•Œë¦¼</div><div class="right">'+(tracked?'<span>'+tracked.targetPrice.toLocaleString()+'ì›</span>':'<span>ì„¤ì • ì•ˆë¨</span>')+' â€º</div></div>';
  html+='<div class="alert-row"><div class="left">ğŸ”” ì¬ì…ê³  ì•Œë¦¼</div><div class="right"><div class="toggle" onclick="this.classList.toggle(\'on\')"></div></div></div>';
  html+='</div>';

  // Target price setting
  html+='<div style="margin:0 16px 12px;background:var(--card);border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.04)">';
  html+='<div style="font-size:14px;font-weight:700;margin-bottom:10px">ì›í•˜ëŠ” ê°€ê²© ì„¤ì •</div>';
  html+='<div style="margin-bottom:8px"><span class="input-label">ëª©í‘œ ê°€ê²© (ì›)</span>';
  html+='<input type="number" class="input-field" id="detail-target" value="'+(tracked?tracked.targetPrice:Math.round(p.currentPrice*0.85))+'"></div></div>';

  // Deeplink example
  html+='<div class="deeplink-info">ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ë”¥ë§í¬ (ì˜ˆì‹œ)<code>https://link.coupang.com/re/AFFTDP?lptag=AF'+p.id+'&amp;subid=pricepick_'+Date.now()+'</code></div>';

  document.getElementById('detail-scroll').innerHTML=html;

  // Bottom bar
  var bottomHtml='<button class="add-btn" onclick="addToWishFromDetail('+p.id+')">+ ìƒí’ˆ ì¶”ê°€</button>';
  bottomHtml+='<div class="avg-info">í‰ê· ê°€ ëŒ€ë¹„<b style="color:'+(avgDiff<0?'var(--primary)':'var(--red)')+'">'+
    (avgDiff<0?'':'+')+(avgDiff).toLocaleString()+'ì›</b></div>';
  bottomHtml+='<button class="buy-btn" onclick="simulatePurchase('+p.id+')">êµ¬ë§¤í•˜ëŸ¬ ê°€ê¸°</button>';
  document.getElementById('detail-bottom').innerHTML=bottomHtml;

  document.getElementById('detail-overlay').classList.add('show');

  // Render chart after DOM
  setTimeout(function(){
    if(chartInstance)chartInstance.destroy();
    var ctx=document.getElementById('detail-chart');
    if(!ctx)return;
    chartInstance=new Chart(ctx.getContext('2d'),{
      type:'line',
      data:{
        labels:history.map(function(h){return h.date}),
        datasets:[
          {label:'ê°€ê²©',data:prices,borderColor:'#EF4444',backgroundColor:'rgba(239,68,68,.08)',fill:true,tension:.3,pointRadius:0,borderWidth:2},
          {label:'ì—­ëŒ€ìµœì €ê°€',data:prices.map(function(){return minP}),borderColor:'#10B981',borderDash:[4,4],pointRadius:0,fill:false,borderWidth:1},
        ]
      },
      options:{
        responsive:true,
        plugins:{legend:{display:false},tooltip:{callbacks:{label:function(c){return c.parsed.y.toLocaleString()+'ì›'}}}},
        scales:{x:{ticks:{font:{size:10},maxTicksLimit:6}},y:{ticks:{font:{size:10},callback:function(v){return(v/10000).toFixed(0)+'ë§Œ'}}}}
      }
    });
  },100);
}
function closeDetail(){document.getElementById('detail-overlay').classList.remove('show');currentDetailId=null}

function genHistory(p){
  var h=[];
  for(var i=50;i>=0;i--){
    var d=new Date();d.setDate(d.getDate()-i);
    var v=p.currentPrice+Math.round(p.currentPrice*(Math.random()*0.4-0.15));
    h.push({date:(d.getMonth()+1)+'/'+('0'+d.getDate()).slice(-2),price:v});
  }
  return h;
}

// ===== ADD TO WISHLIST =====
function addToWishFromDetail(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var tracks=getTracks();
  if(tracks.find(function(t){return t.productId===id}))return showModal('ğŸ“Œ','ì´ë¯¸ ë“±ë¡ë¨','ì´ ìƒí’ˆì€ ì´ë¯¸ ê´€ì‹¬ìƒí’ˆì— ë“±ë¡ë˜ì–´ ìˆì–´ìš”.');
  var target=parseInt(document.getElementById('detail-target').value,10)||Math.round(p.currentPrice*0.85);
  var history=genHistory(p);
  tracks.push({productId:id,name:p.name,emoji:p.emoji,currentPrice:p.currentPrice,targetPrice:target,history:history});
  setTracks(tracks);
  showModal('âœ…','ê´€ì‹¬ìƒí’ˆ ë“±ë¡!',p.name+'<br>ëª©í‘œê°€: '+target.toLocaleString()+'ì›');
}

function addProductFromModal(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var tracks=getTracks();
  if(tracks.find(function(t){return t.productId===id}))return showModal('ğŸ“Œ','ì´ë¯¸ ë“±ë¡ë¨','ì´ ìƒí’ˆì€ ì´ë¯¸ ê´€ì‹¬ìƒí’ˆì— ë“±ë¡ë˜ì–´ ìˆì–´ìš”.');
  var target=Math.round(p.currentPrice*0.85);
  tracks.push({productId:id,name:p.name,emoji:p.emoji,currentPrice:p.currentPrice,targetPrice:target,history:genHistory(p)});
  setTracks(tracks);
  closeAddModal();
  showModal('âœ…','ê´€ì‹¬ìƒí’ˆ ë“±ë¡!',p.name);
}

// ===== ADD MODAL =====
function openAddModal(){
  var tracks=getTracks();
  var ids=tracks.map(function(t){return t.productId});
  var html='';
  PRODUCTS.forEach(function(p){
    var added=ids.indexOf(p.id)>=0;
    html+='<div style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border)">';
    html+='<div style="width:40px;height:40px;border-radius:8px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">'+p.emoji+'</div>';
    html+='<div style="flex:1;min-width:0"><div style="font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p.name+'</div>';
    html+='<div style="font-size:12px;font-weight:700;color:var(--text)">'+p.currentPrice.toLocaleString()+'ì›</div></div>';
    if(added){
      html+='<span style="font-size:12px;color:var(--text-sub);padding:6px 10px;border-radius:8px;background:var(--border)">ë“±ë¡ë¨</span>';
    }else{
      html+='<button style="font-size:12px;color:#fff;padding:6px 10px;border-radius:8px;background:var(--primary);border:none;cursor:pointer;font-weight:600" onclick="addProductFromModal('+p.id+')">ì¶”ê°€</button>';
    }
    html+='</div>';
  });
  document.getElementById('add-product-list').innerHTML=html;
  document.getElementById('add-modal').classList.add('show');
}
function closeAddModal(){document.getElementById('add-modal').classList.remove('show')}

// ===== PURCHASE SIMULATION =====
function simulatePurchase(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  // Secret tier based on amount (user doesn't see this)
  var secretTier=p.currentPrice>=100000?'gold':p.currentPrice>=20000?'silver':'bronze';
  // Give event ticket (shown as generic)
  var tickets=getTickets();
  tickets.pending++;
  tickets.history.push({id:Date.now(),tier:secretTier,amount:p.currentPrice,date:new Date().toISOString(),status:'pending',product:p.name});
  setTickets(tickets);
  // Record purchase
  var purchases=getPurchases();
  purchases.unshift({name:p.name,price:p.currentPrice,date:new Date().toISOString().slice(0,10),emoji:p.emoji});
  S('purchases',purchases);
  closeDetail();
  showModal('ğŸ«','ì´ë²¤íŠ¸ í‹°ì¼“ ì§€ê¸‰!','<b>'+p.name+'</b> êµ¬ë§¤ ì™„ë£Œ!<br><br>ğŸ« ì´ë²¤íŠ¸ í‹°ì¼“ 1ì¥ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.<br><span style="font-size:12px;color:var(--text-sub)">ê¸ˆì•¡ì´ í´ìˆ˜ë¡ ë” ì¢‹ì€ í‹°ì¼“ì´ ë‚˜ì˜¬ ìˆ˜ ìˆì–´ìš”!</span>');
}

// ===== TICKET PROCESSING (secret tier upgrade over time) =====
function processTickets(){
  var tickets=getTickets();
  var now=Date.now();
  var changed=false;
  tickets.history.forEach(function(t){
    if(t.status==='pending'){
      var elapsed=(now-new Date(t.date).getTime())/1000;
      // For demo: 30 seconds = "time passed" (real would be days)
      if(elapsed>30){
        t.status='available';
        tickets.pending=Math.max(0,tickets.pending-1);
        tickets.available++;
        changed=true;
      }
    }
  });
  if(changed)setTickets(tickets);
}

// ===== SEARCH =====
var SEARCH_TAGS=['ì—ì–´íŒŸ','ì²­ì†Œê¸°','ëª¨ë‹ˆí„°','ìš´ë™','ìŠ¤ë‹ˆì»¤ì¦ˆ','ë¡œë´‡ì²­ì†Œê¸°','ë²„ì¦ˆ','ë‚˜ì´í‚¤'];
function renderSearch(){
  var html='';
  SEARCH_TAGS.forEach(function(tag){
    html+='<span class="chip" onclick="document.getElementById(\'search-input\').value=\''+tag+'\';doSearch()">'+tag+'</span>';
  });
  document.getElementById('search-tags').innerHTML=html;
  document.getElementById('search-results').innerHTML='<div class="empty"><div class="icon">ğŸ”</div><p>ìƒí’ˆëª…ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p></div>';
  document.getElementById('search-input').value='';
}
function doSearch(){
  var q=document.getElementById('search-input').value.trim().toLowerCase();
  if(!q){document.getElementById('search-results').innerHTML='<div class="empty"><div class="icon">ğŸ”</div><p>ìƒí’ˆëª…ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p></div>';return}
  var results=PRODUCTS.filter(function(p){return p.name.toLowerCase().indexOf(q)>=0});
  var html='';
  if(results.length===0){html='<div class="empty"><div class="icon">ğŸ˜¢</div><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”</p></div>'}
  results.forEach(function(p){
    html+='<div class="track-card" onclick="openDetail('+p.id+')" style="margin-bottom:1px">';
    html+='<div class="track-thumb">'+p.emoji+'</div>';
    html+='<div class="track-body"><div class="track-name">'+p.name+'</div>';
    if(p.ai) html+='<div style="font-size:11px;color:var(--primary);margin-bottom:3px">ğŸ¤– '+p.ai.slice(0,30)+'...</div>';
    html+='<div class="track-price-row"><span class="track-current">'+p.currentPrice.toLocaleString()+'ì›</span>';
    html+='<span class="product-change down" style="font-size:11px">â–¼'+p.discount+'%</span></div></div></div>';
  });
  document.getElementById('search-results').innerHTML=html;
}

// ===== BENEFIT =====
function renderBenefit(){
  processTickets();
  var tickets=getTickets();
  document.getElementById('ticket-pending').textContent=tickets.pending;
  document.getElementById('ticket-available').textContent=tickets.available;
  document.getElementById('raffle-tickets').textContent=tickets.available;
  // Raffle prizes
  var html='';
  RAFFLE_PRIZES.forEach(function(r){
    html+='<div class="raffle-prize-card">';
    html+='<div class="raffle-medal r'+r.rank+'">'+r.rank+'</div>';
    html+='<div class="raffle-prize-info"><h4>'+r.icon+' '+r.prize+'</h4><p>'+r.desc+'</p></div></div>';
  });
  document.getElementById('raffle-prizes').innerHTML=html;
}

function scrollToRaffle(){
  setTimeout(function(){
    var el=document.getElementById('raffle-anchor');
    if(el)el.scrollIntoView({behavior:'smooth'});
  },100);
}

function doRaffle(){
  var tickets=getTickets();
  if(tickets.available<1)return showModal('ğŸ˜…','í‹°ì¼“ì´ ì—†ì–´ìš”','ìƒí’ˆì„ êµ¬ë§¤í•˜ë©´ ì´ë²¤íŠ¸ í‹°ì¼“ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”!');
  tickets.available--;
  // Remove first available from history
  for(var i=0;i<tickets.history.length;i++){
    if(tickets.history[i].status==='available'){tickets.history[i].status='used';break}
  }
  setTickets(tickets);
  setRaffleCount(getRaffleCount()+1);
  var ball=document.getElementById('raffle-ball');
  ball.classList.add('spinning');ball.textContent='?';
  var count=0;
  var iv=setInterval(function(){
    ball.textContent=['ğŸ•','ğŸ”','â˜•','ğŸ','ğŸ‰','âœ¨'][count%6];count++;
    if(count>20){
      clearInterval(iv);ball.classList.remove('spinning');
      var r=Math.random();
      var result=r<0.05?RAFFLE_PRIZES[0]:r<0.2?RAFFLE_PRIZES[1]:RAFFLE_PRIZES[2];
      ball.textContent=result.icon;
      showModal(result.icon,result.rank+'ë“± ë‹¹ì²¨!','<b>'+result.prize+'</b><br><span style="font-size:12px;color:var(--text-sub)">'+result.desc+'</span>');
      renderBenefit();
    }
  },80);
}

// ===== MYPAGE =====
function renderMypage(){
  var u=getUser();if(!u)return;
  var tickets=getTickets();
  var purchases=getPurchases();
  var tracks=getTracks();
  var settings=getSettings();
  document.getElementById('my-avatar').textContent=u.nickname[0];
  document.getElementById('my-name').textContent=u.nickname;
  document.getElementById('my-email').textContent=u.email;
  document.getElementById('my-badge-area').innerHTML=settings.wow?
    '<span class="mypage-badge" style="background:#FEE500;color:#3C1E1E">ì¿ íŒ¡ ì™€ìš° ë©¤ë²„</span>':
    '<span class="mypage-badge" style="background:var(--border);color:var(--text-sub)">ì¼ë°˜ íšŒì›</span>';
  document.getElementById('my-tickets').textContent=tickets.available+tickets.pending;
  document.getElementById('my-purchases').textContent=purchases.length;
  document.getElementById('my-wishcnt').textContent=tracks.length;
  document.getElementById('my-raffles').textContent=getRaffleCount();
  document.getElementById('toggle-wow').className='toggle'+(settings.wow?' on':'');
  document.getElementById('toggle-marketing').className='toggle'+(settings.marketing?' on':'');
  document.getElementById('toggle-price').className='toggle'+(settings.noti_price!==false?' on':'');
  document.getElementById('toggle-restock').className='toggle'+(settings.noti_restock?' on':'');
  document.getElementById('toggle-event').className='toggle'+(settings.noti_event!==false?' on':'');
  var kakaoStatus=document.getElementById('kakao-status');
  if(kakaoStatus){
    kakaoStatus.innerHTML=settings.kakao?
      '<span style="color:var(--green);font-size:13px;font-weight:600">ì—°ë™ì™„ë£Œ âœ“</span>':
      '<span style="color:var(--primary);font-size:13px">ì—°ë™í•˜ê¸°</span> <span class="arrow">â€º</span>';
  }
}
function toggleWow(){var s=getSettings();s.wow=!s.wow;setSettings(s);renderMypage()}
function toggleMarketing(){var s=getSettings();s.marketing=!s.marketing;setSettings(s);renderMypage()}
function toggleNoti(key){var s=getSettings();s['noti_'+key]=!s['noti_'+key];setSettings(s);renderMypage()}
function linkKakao(){
  var s=getSettings();
  if(s.kakao)return;
  s.kakao=true;setSettings(s);
  showModal('ğŸ‰','ì¹´ì¹´ì˜¤ ì—°ë™ ì™„ë£Œ!','ë¦¬ì›Œë“œ ì ë¦½ ëŒ€ê¸° ê¸°ê°„ì´ ë‹¨ì¶•ë©ë‹ˆë‹¤.');
  renderMypage();
}

// ===== SUB PAGES =====
var SUB_CONTENT={
  notice:'<div class="card"><div style="font-size:14px;font-weight:700;margin-bottom:8px">ğŸ“¢ PricePick ì˜¤í”ˆ ì•ˆë‚´</div><p style="font-size:13px;color:var(--text-sub);line-height:1.6">ì•ˆë…•í•˜ì„¸ìš”, PricePickì…ë‹ˆë‹¤.<br><br>ì¿ íŒ¡ ìµœì €ê°€ ì¶”ì  & ì‡¼í•‘ ë¦¬ì›Œë“œ ì„œë¹„ìŠ¤ë¥¼ ì˜¤í”ˆí–ˆìŠµë‹ˆë‹¤. ê´€ì‹¬ìƒí’ˆì„ ë“±ë¡í•˜ê³  ëª©í‘œê°€ë¥¼ ì„¤ì •í•˜ë©´, ê°€ê²© ë³€ë™ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•´ë“œë¦½ë‹ˆë‹¤.<br><br>êµ¬ë§¤ ì‹œ ì´ë²¤íŠ¸ í‹°ì¼“ì´ ì§€ê¸‰ë˜ë©°, ì¶”ì²¨ì„ í†µí•´ ë‹¤ì–‘í•œ ê²½í’ˆì„ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>ë§ì€ ì´ìš© ë¶€íƒë“œë¦½ë‹ˆë‹¤! ğŸ™<br><br><span style="color:var(--text-light)">2026.02.09</span></p></div>',
  inquiry:'<div class="card"><div style="font-size:14px;font-weight:700;margin-bottom:12px">ğŸ’¬ 1:1 ë¬¸ì˜í•˜ê¸°</div><div style="margin-bottom:10px"><span class="input-label">ë¬¸ì˜ ìœ í˜•</span><select class="input-field" style="padding:10px 14px"><option>ì´ìš© ë¬¸ì˜</option><option>í‹°ì¼“/í¬ì¸íŠ¸</option><option>ì˜¤ë¥˜ ì‹ ê³ </option><option>ê¸°íƒ€</option></select></div><div style="margin-bottom:10px"><span class="input-label">ë¬¸ì˜ ë‚´ìš©</span><textarea class="input-field" rows="5" placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" style="resize:none"></textarea></div><button class="modal-btn" onclick="showModal(\'âœ…\',\'ì ‘ìˆ˜ ì™„ë£Œ\',\'ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\');closeSub()">ë¬¸ì˜í•˜ê¸°</button></div>',
  terms:'<div class="card"><div style="font-size:14px;font-weight:700;margin-bottom:8px">ì´ìš©ì•½ê´€</div><div style="font-size:12px;color:var(--text-sub);line-height:1.7"><p><b>ì œ1ì¡° (ëª©ì )</b><br>ì´ ì•½ê´€ì€ PricePick(ì´í•˜ "ì„œë¹„ìŠ¤")ì˜ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ íšŒì‚¬ì™€ ì´ìš©ì ê°„ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p><br><p><b>ì œ2ì¡° (ì •ì˜)</b><br>â‘ "ì„œë¹„ìŠ¤"ë€ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ê°€ê²© ì¶”ì , ì‡¼í•‘ ë¦¬ì›Œë“œ ë“± ê´€ë ¨ ì„œë¹„ìŠ¤ë¥¼ ë§í•©ë‹ˆë‹¤.<br>â‘¡"ì´ìš©ì"ë€ ì´ ì•½ê´€ì— ë”°ë¼ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ìë¥¼ ë§í•©ë‹ˆë‹¤.</p><br><p><b>ì œ3ì¡° (ì„œë¹„ìŠ¤ ì´ìš©)</b><br>â‘ ì„œë¹„ìŠ¤ ì´ìš©ì€ íšŒì›ê°€ì… í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>â‘¡ì´ë²¤íŠ¸ í‹°ì¼“ ë° ê²½í’ˆì€ í”„ë¡œëª¨ì…˜ ê¸°ê°„ ë‚´ì—ë§Œ ìœ íš¨í•©ë‹ˆë‹¤.<br>â‘¢ë¶€ì •í•œ ë°©ë²•ìœ¼ë¡œ íšë“í•œ ë¦¬ì›Œë“œëŠ” íšŒìˆ˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><br><p><b>ì œ4ì¡° (ê°œì¸ì •ë³´)</b><br>íšŒì‚¬ëŠ” ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ ë³´í˜¸í•©ë‹ˆë‹¤.</p></div></div>',
  privacy:'<div class="card"><div style="font-size:14px;font-weight:700;margin-bottom:8px">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</div><div style="font-size:12px;color:var(--text-sub);line-height:1.7"><p><b>1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´</b><br>ë‹‰ë„¤ì„, ì´ë©”ì¼ ì£¼ì†Œ</p><br><p><b>2. ìˆ˜ì§‘ ëª©ì </b><br>ì„œë¹„ìŠ¤ ì œê³µ, ê°€ê²© ì•Œë¦¼, ë¦¬ì›Œë“œ ì§€ê¸‰</p><br><p><b>3. ë³´ìœ  ê¸°ê°„</b><br>íšŒì› íƒˆí‡´ ì‹œê¹Œì§€ (íƒˆí‡´ ì¦‰ì‹œ íŒŒê¸°)</p><br><p><b>4. ì œ3ì ì œê³µ</b><br>ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><br><p><b>5. ì•ˆì „ì„± í™•ë³´ ì¡°ì¹˜</b><br>ê°œì¸ì •ë³´ëŠ” localStorageì— ì €ì¥ë˜ë©°, ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (í”„ë¡œí† íƒ€ì…)</p></div></div>'
};
function openSub(key){
  var titles={notice:'ê³µì§€ì‚¬í•­',inquiry:'1:1 ë¬¸ì˜í•˜ê¸°',terms:'ì´ìš©ì•½ê´€',privacy:'ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨'};
  document.getElementById('sub-title').textContent=titles[key]||'';
  document.getElementById('sub-body').innerHTML=SUB_CONTENT[key]||'';
  document.getElementById('sub-overlay').classList.add('show');
}
function closeSub(){document.getElementById('sub-overlay').classList.remove('show')}

// ===== MODAL =====
function showModal(icon,title,msg){
  document.getElementById('modal-content').innerHTML=
    '<div class="icon">'+icon+'</div><h3>'+title+'</h3><p>'+msg+'</p>'+
    '<button class="modal-btn" onclick="closeModal()">í™•ì¸</button>';
  document.getElementById('modal').classList.add('show');
}
function closeModal(){document.getElementById('modal').classList.remove('show')}

// ===== BACK BUTTON =====
window.addEventListener('popstate',function(){
  if(document.getElementById('modal').classList.contains('show')){closeModal();return}
  if(document.getElementById('add-modal').classList.contains('show')){closeAddModal();return}
  if(document.getElementById('sub-overlay').classList.contains('show')){closeSub();return}
  if(document.getElementById('detail-overlay').classList.contains('show')){closeDetail();return}
});
function pushState(){history.pushState({overlay:true},'','')}
var _openDetail=openDetail;
openDetail=function(){pushState();_openDetail.apply(null,arguments)};
var _openSub=openSub;
openSub=function(){pushState();_openSub.apply(null,arguments)};

// ===== START =====
initApp();
</script>
</body>
</html>
