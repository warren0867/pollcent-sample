<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>PricePick</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè∑Ô∏è</text></svg>">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#346aff">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--primary:#346aff;--primary-light:rgba(52,106,255,0.08);--primary-dark:#2856d9;--bg:#f5f5f5;--bg-elevated:#fff;--card:#fff;--card-hover:#f9fafb;--text:#111;--text-sub:#888;--text-light:#bbb;--border:#eee;--red:#e74c3c;--green:#10B981;--orange:#F59E0B;--gold:#FFD93D;--tab-h:60px;--header-h:52px;--safe-top:env(safe-area-inset-top,0px);--safe-bottom:env(safe-area-inset-bottom,0px)}
html,body{margin:0;padding:0;height:100%;background:#f5f5f5}
#app-shell{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);overflow:hidden}

/* Header */
.header{min-height:calc(var(--header-h) + var(--safe-top));padding-top:var(--safe-top);background:var(--card);display:flex;align-items:center;justify-content:space-between;padding-left:20px;padding-right:16px;z-index:100;flex-shrink:0}
.header h1{font-size:18px;font-weight:800}
.header-icons{display:flex;gap:12px;align-items:center}
.header-icons span{font-size:18px;cursor:pointer}

/* Content */
.content{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding-bottom:10px}

/* Pages */
.page{display:none}
.page.active{display:block}

/* Tab bar */
.tabbar{flex-shrink:0;height:calc(var(--tab-h) + var(--safe-bottom));padding-bottom:var(--safe-bottom);background:var(--card);display:flex;align-items:flex-end;box-shadow:0 -1px 10px rgba(0,0,0,.06);z-index:100}
.tab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;height:var(--tab-h);gap:2px;font-size:10px;color:var(--text-sub);text-decoration:none;transition:.2s;cursor:pointer;position:relative}
.tab.active{color:var(--primary)}
.tab svg{width:22px;height:22px;stroke-width:1.8}
.tab-center{position:relative}
.tab-center-btn{width:48px;height:48px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:300;border:none;cursor:pointer;position:absolute;top:-14px;left:50%;transform:translateX(-50%);box-shadow:0 4px 14px rgba(59,130,246,.35);transition:.2s}
.tab-center-btn:active{transform:translateX(-50%) scale(.92)}

/* Cards */
.card{background:var(--card);border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,.04)}

/* Chips */
.chip{display:inline-flex;align-items:center;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:600;cursor:pointer;transition:.2s;border:1.5px solid var(--border)}
.chip.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* Product grid */
.product-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:0 16px 16px}
.product-card{background:var(--card);border-radius:14px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.05);cursor:pointer;transition:transform .2s}
.product-card:active{transform:scale(.97)}
.product-img{width:100%;aspect-ratio:1;background:#f8f9fa;overflow:hidden;position:relative}
.img-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:44px;background:linear-gradient(135deg,#f8f9fa,#e9ecef)}
.product-badge{position:absolute;top:8px;left:8px;font-size:10px;font-weight:700;padding:3px 7px;border-radius:4px;color:#fff}
.badge-rocket{background:var(--primary)}
.badge-hot{background:var(--red)}
.badge-lowest{background:var(--red)}
.product-info{padding:10px 10px 12px}
.product-name{font-size:12px;line-height:1.35;height:33px;overflow:hidden;color:var(--text);margin-bottom:6px}
.product-price-row{display:flex;align-items:baseline;gap:4px}
.product-price{font-size:16px;font-weight:800;color:var(--text)}
.product-change{font-size:11px;font-weight:600}
.product-change.down{color:var(--red)}
.product-change.up{color:var(--green)}

/* Section headers */
.section-header{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 10px;font-size:16px;font-weight:800}
.section-header .more{font-size:13px;color:var(--text-sub);font-weight:500}
.section-sub{font-size:12px;color:var(--text-sub);padding:0 16px 12px}

/* Horizontal scroll */
.h-scroll{display:flex;gap:10px;overflow-x:auto;padding:0 16px 12px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.h-scroll::-webkit-scrollbar{display:none}
.h-card{flex-shrink:0;width:120px;cursor:pointer}
.h-card-img{width:120px;height:120px;border-radius:12px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;font-size:36px;margin-bottom:6px;position:relative;overflow:hidden}
.h-card-name{font-size:11px;line-height:1.3;height:29px;overflow:hidden;color:var(--text)}
.h-card-price{font-size:13px;font-weight:700;margin-top:2px}
.h-card-discount{font-size:11px;color:var(--red);font-weight:600}

/* Banner */
.banner{margin:0 16px 12px;border-radius:14px;padding:18px 16px;color:#fff;position:relative;overflow:hidden}
.banner.b1{background:linear-gradient(135deg,#6366F1,#818CF8)}
.banner.b2{background:linear-gradient(135deg,#F59E0B,#FBBF24)}
.banner h3{font-size:16px;font-weight:700;margin-bottom:2px}
.banner p{font-size:12px;opacity:.85}

/* Goldbox countdown */
.goldbox{margin:0 16px 12px;background:var(--card);border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.goldbox-header{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.goldbox-header h3{font-size:15px;font-weight:800;flex:1}
.countdown{display:flex;align-items:center;gap:2px;font-size:13px;font-weight:700;color:var(--red)}
.countdown svg{width:16px;height:16px}

/* Category icons */
.category-row{display:flex;gap:16px;padding:12px 16px;overflow-x:auto;scrollbar-width:none}
.category-row::-webkit-scrollbar{display:none}
.cat-item{display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0;cursor:pointer}
.cat-icon{width:52px;height:52px;border-radius:50%;background:var(--card);border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.cat-label{font-size:10px;color:var(--text-sub);white-space:nowrap}

/* Track items */
.track-card{display:flex;gap:12px;padding:14px 16px;background:var(--card);margin-bottom:1px;cursor:pointer}
.track-thumb{width:80px;height:80px;border-radius:10px;background:#f8f9fa;overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:32px}
.track-body{flex:1;min-width:0;display:flex;flex-direction:column;justify-content:center}
.track-name{font-size:13px;line-height:1.3;margin-bottom:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.track-price-row{display:flex;align-items:baseline;gap:6px}
.track-current{font-size:16px;font-weight:800}
.track-change{font-size:12px;font-weight:600}

/* Detail overlay */
.detail-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:150;display:none;flex-direction:column}
.detail-overlay.show{display:flex}
.detail-top{display:flex;align-items:center;padding:10px 12px;padding-top:calc(10px + var(--safe-top));background:var(--card);gap:8px;flex-shrink:0}
.detail-top button{width:36px;height:36px;border-radius:50%;border:none;background:transparent;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.detail-top .share{margin-left:auto}
.detail-scroll{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}
.detail-bottom{flex-shrink:0;display:flex;align-items:center;padding:10px 16px;background:var(--card);box-shadow:0 -1px 6px rgba(0,0,0,.06);gap:10px;padding-bottom:calc(10px + var(--safe-bottom))}
.detail-bottom .add-btn{display:flex;align-items:center;gap:4px;padding:10px 14px;border-radius:10px;border:1.5px solid var(--border);font-size:13px;font-weight:600;cursor:pointer;background:#fff;white-space:nowrap}
.detail-bottom .avg-info{flex:1;text-align:center;font-size:12px;color:var(--text-sub)}
.detail-bottom .avg-info b{display:block;font-size:14px;color:var(--primary);font-weight:800}
.detail-bottom .buy-btn{padding:10px 20px;border-radius:10px;background:var(--primary);color:#fff;font-size:14px;font-weight:700;border:none;cursor:pointer;white-space:nowrap}
.detail-bottom .buy-btn:active{opacity:.85}

/* Price graph card */
.graph-card{margin:0 16px 12px;background:var(--card);border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.graph-title{font-size:14px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.price-stats{display:flex;flex-direction:column;gap:8px;margin-top:12px}
.price-stat{display:flex;align-items:center;justify-content:space-between;font-size:13px}
.price-stat .label{display:flex;align-items:center;gap:6px;color:var(--text-sub)}
.price-stat .label .dot{width:8px;height:8px;border-radius:50%}
.price-stat .value{font-weight:700}

/* Alert setting card */
.alert-card{margin:0 16px 12px;background:var(--card);border-radius:14px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.alert-header{padding:14px 16px;font-size:14px;font-weight:700;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
.alert-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
.alert-row:last-child{border-bottom:none}
.alert-row .left{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text)}
.alert-row .right{font-size:13px;color:var(--text-sub);display:flex;align-items:center;gap:4px}
.alert-info{padding:12px 16px;font-size:12px;color:var(--text-sub);background:#f9fafb;border-bottom:1px solid var(--border)}

/* Toggle switch */
.toggle{width:44px;height:24px;border-radius:12px;background:var(--text-light);position:relative;cursor:pointer;transition:.3s;flex-shrink:0}
.toggle.on{background:var(--primary)}
.toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:#fff;transition:.3s;box-shadow:0 1px 3px rgba(0,0,0,.15)}
.toggle.on::after{left:22px}

/* ÌòúÌÉù page */
.ticket-box{margin:0 16px 12px;background:var(--card);border-radius:16px;padding:20px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.ticket-box-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.ticket-box-title h3{font-size:15px;font-weight:700}
.ticket-box-title .tip{font-size:11px;color:var(--primary);font-weight:600;background:var(--primary-light);padding:3px 8px;border-radius:8px}
.ticket-stats{display:flex;gap:16px;margin-bottom:16px}
.ticket-stat{flex:1}
.ticket-stat .label{font-size:12px;color:var(--text-sub);margin-bottom:4px}
.ticket-stat .val{font-size:28px;font-weight:800;color:var(--primary);display:flex;align-items:center;gap:4px}
.ticket-stat .val .icon{font-size:20px}
.ticket-actions{display:flex;gap:8px}
.ticket-actions button{flex:1;padding:10px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;border:1.5px solid var(--border);background:var(--card);transition:.2s}
.ticket-actions button:active{background:var(--border)}
.ticket-actions button.primary{background:var(--primary);color:#fff;border-color:var(--primary)}

/* Event card */
.event-card{margin:0 16px 8px;background:var(--card);border-radius:14px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.event-row{display:flex;align-items:center;padding:14px 16px;gap:12px}
.event-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.event-info{flex:1}
.event-info h4{font-size:14px;font-weight:600;margin-bottom:1px}
.event-info p{font-size:12px;color:var(--text-sub)}
.event-status{font-size:12px;font-weight:600;padding:4px 10px;border-radius:20px;white-space:nowrap}
.event-status.live{background:#DCFCE7;color:#16A34A}
.event-status.end{background:var(--border);color:var(--text-sub)}

/* Raffle */
.raffle-section{margin:0 16px 12px;background:linear-gradient(135deg,#6366F1,#818CF8);border-radius:16px;padding:24px;text-align:center;color:#fff}
.raffle-section h3{font-size:18px;font-weight:800;margin-bottom:4px}
.raffle-section p{font-size:12px;opacity:.8;margin-bottom:16px}
.raffle-ball{width:72px;height:72px;border-radius:50%;background:#fff;color:var(--primary);font-size:28px;font-weight:800;display:flex;align-items:center;justify-content:center;margin:0 auto 14px;box-shadow:0 4px 16px rgba(0,0,0,.3);transition:.3s}
.raffle-ball.spinning{animation:spin .1s linear infinite}
@keyframes spin{0%{transform:rotate(0) scale(1)}50%{transform:rotate(180deg) scale(1.1)}100%{transform:rotate(360deg) scale(1)}}
.raffle-info{display:flex;align-items:center;justify-content:center;gap:6px;font-size:13px;margin-bottom:14px;opacity:.9}
.raffle-btn{padding:10px 32px;border-radius:12px;background:#fff;color:#6366F1;font-size:14px;font-weight:700;border:none;cursor:pointer}
.raffle-btn:active{opacity:.85}
.raffle-prizes{margin:0 16px 12px}
.raffle-prize-card{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card);border-radius:14px;margin-bottom:8px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.raffle-medal{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:800;color:#fff;flex-shrink:0}
.raffle-medal.r1{background:linear-gradient(135deg,#F59E0B,#D97706)}
.raffle-medal.r2{background:linear-gradient(135deg,#9CA3AF,#6B7280)}
.raffle-medal.r3{background:linear-gradient(135deg,#D97706,#92400E)}
.raffle-prize-info{flex:1}
.raffle-prize-info h4{font-size:14px;font-weight:600}
.raffle-prize-info p{font-size:12px;color:var(--text-sub)}

/* MyPage */
.mypage-profile{padding:24px 16px;background:var(--card);text-align:center;margin-bottom:8px}
.mypage-avatar{width:56px;height:56px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;margin:0 auto 8px}
.mypage-name{font-size:17px;font-weight:700;margin-bottom:2px}
.mypage-email{font-size:13px;color:var(--text-sub)}
.mypage-badge{display:inline-block;margin-top:6px;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600}
.mypage-section{background:var(--card);margin-bottom:8px}
.mypage-section-title{padding:14px 16px 6px;font-size:13px;font-weight:700;color:var(--text-sub)}
.mypage-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer}
.mypage-row:active{background:var(--border)}
.mypage-row .left{display:flex;align-items:center;gap:10px;font-size:14px}
.mypage-row .left .icon{font-size:18px;width:24px;text-align:center}
.mypage-row .right{display:flex;align-items:center;gap:4px;font-size:13px;color:var(--text-sub)}
.mypage-row .arrow{font-size:14px;color:var(--text-light)}
.mypage-divider{height:1px;background:var(--border);margin:0 16px}

/* Savings card */
.savings-card{margin:0 16px 8px;background:linear-gradient(135deg,#346aff,#6B8FFF);border-radius:16px;padding:20px;color:#fff;text-align:center}
.savings-card .label{font-size:12px;opacity:.85;margin-bottom:4px}
.savings-card .amount{font-size:28px;font-weight:800;letter-spacing:-0.5px}
.savings-card .sub{font-size:11px;opacity:.7;margin-top:4px}

/* Stats row */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:0;padding:12px 0;margin:0 16px;border-top:1px solid var(--border)}
.stat-box{text-align:center}
.stat-box .val{font-size:18px;font-weight:800;color:var(--primary)}
.stat-box .lbl{font-size:10px;color:var(--text-sub);margin-top:2px}

/* Modal */
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.45);z-index:200;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:var(--card);border-radius:20px;padding:28px 24px;max-width:320px;width:100%;text-align:center;animation:modalIn .25s}
@keyframes modalIn{from{transform:scale(.92);opacity:0}to{transform:scale(1);opacity:1}}
.modal .icon{font-size:48px;margin-bottom:10px}
.modal h3{font-size:17px;font-weight:700;margin-bottom:6px}
.modal p{font-size:13px;color:var(--text-sub);margin-bottom:16px;line-height:1.5}
.modal-btn{width:100%;padding:12px;border-radius:12px;background:var(--primary);color:#fff;font-size:14px;font-weight:700;border:none;cursor:pointer}

/* Input */
.input-field{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;font-size:15px;outline:none;transition:.2s;background:var(--card)}
.input-field:focus{border-color:var(--primary)}
.input-label{display:block;font-size:12px;font-weight:600;color:var(--text-sub);margin-bottom:4px}

/* Onboarding AI chat */
.onboard{display:flex;flex-direction:column;height:100%}
.onboard-header{text-align:center;padding:20px 16px 10px;padding-top:calc(20px + var(--safe-top))}
.onboard-logo{font-size:28px;font-weight:800;color:var(--primary);letter-spacing:-0.5px}
.onboard-sub{font-size:12px;color:var(--text-sub);margin-top:2px}
.chat-area{flex:1;overflow-y:auto;padding:8px 16px;display:flex;flex-direction:column;gap:6px}
.chat-row{display:flex;gap:8px;align-items:flex-end;animation:chatIn .3s ease}
.chat-row.user{flex-direction:row-reverse}
@keyframes chatIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.chat-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;background:var(--primary-light)}
.chat-bubble{max-width:75%;padding:10px 14px;border-radius:16px;font-size:13px;line-height:1.5;word-break:break-word}
.chat-row:not(.user) .chat-bubble{background:var(--card);border-bottom-left-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.chat-row.user .chat-bubble{background:var(--primary);color:#fff;border-bottom-right-radius:4px}
.chat-typing{display:flex;gap:4px;padding:10px 14px;background:var(--card);border-radius:16px;border-bottom-left-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.06);width:fit-content}
.chat-typing span{width:6px;height:6px;border-radius:50%;background:var(--text-light);animation:typing 1.2s infinite}
.chat-typing span:nth-child(2){animation-delay:.2s}
.chat-typing span:nth-child(3){animation-delay:.4s}
@keyframes typing{0%,60%,100%{opacity:.3;transform:translateY(0)}30%{opacity:1;transform:translateY(-4px)}}
.chat-input-area{padding:10px 16px;padding-bottom:calc(10px + var(--safe-bottom));background:var(--card);box-shadow:0 -1px 6px rgba(0,0,0,.04);display:none;gap:8px;align-items:center}
.chat-input-area.show{display:flex}
.chat-input-area input{flex:1;padding:10px 14px;border:1.5px solid var(--border);border-radius:24px;font-size:14px;outline:none}
.chat-input-area input:focus{border-color:var(--primary)}
.chat-input-area button{width:36px;height:36px;border-radius:50%;background:var(--primary);color:#fff;border:none;font-size:16px;cursor:pointer;flex-shrink:0}
.chat-options{display:flex;flex-wrap:wrap;gap:6px;padding:4px 0}
.chat-opt{padding:8px 16px;border-radius:20px;border:1.5px solid var(--primary);color:var(--primary);font-size:13px;font-weight:600;cursor:pointer;background:#fff;transition:.2s}
.chat-opt:active{background:var(--primary);color:#fff}

/* Empty */
.empty{text-align:center;padding:40px 20px;color:var(--text-light)}
.empty .icon{font-size:40px;margin-bottom:10px}
.empty p{font-size:13px;line-height:1.5}

/* Deeplink info */
.deeplink-info{margin:0 16px 12px;background:#FFFBEB;border:1.5px dashed #F59E0B;border-radius:12px;padding:12px;font-size:11px;color:#92400E}
.deeplink-info code{display:block;margin-top:6px;padding:6px;background:#FEF3C7;border-radius:6px;font-size:10px;word-break:break-all}

/* Sub-page overlay */
.sub-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:160;display:none;flex-direction:column}
.sub-overlay.show{display:flex}
.sub-header{display:flex;align-items:center;padding:12px 16px;padding-top:calc(12px + var(--safe-top));background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,.04);flex-shrink:0}
.sub-header button{width:36px;height:36px;border:none;background:transparent;font-size:18px;cursor:pointer}
.sub-header h2{flex:1;text-align:center;font-size:15px;font-weight:700;margin-right:36px}
.sub-body{flex:1;overflow-y:auto;padding:16px}
.sub-body.no-pad{padding:0}

/* Inquiry chatbot */
.iq-chat{display:flex;flex-direction:column;height:100%}
.iq-area{flex:1;overflow-y:auto;padding:12px 16px;display:flex;flex-direction:column;gap:6px}
.iq-bottom{padding:10px 16px;padding-bottom:calc(10px + var(--safe-bottom));background:var(--card);box-shadow:0 -1px 6px rgba(0,0,0,.04);display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.iq-bottom button{padding:10px 16px;border-radius:12px;font-size:13px;font-weight:600;cursor:pointer;border:1.5px solid var(--border);background:var(--card)}
.iq-bottom button.primary{background:var(--primary);color:#fff;border-color:var(--primary)}

/* 2x event card */
.event-2x-card{flex-shrink:0;width:140px;border-radius:14px;padding:14px;color:#fff;position:relative;overflow:hidden}
.event-2x-card .badge-2x{position:absolute;top:8px;right:8px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:10px;font-weight:700}

/* Cart overlay */
.cart-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:160;display:none;flex-direction:column}
.cart-overlay.show{display:flex}
.cart-header{display:flex;align-items:center;padding:12px 16px;padding-top:calc(12px + var(--safe-top));background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,.04);flex-shrink:0}
.cart-header button{width:36px;height:36px;border:none;background:transparent;font-size:18px;cursor:pointer}
.cart-header h2{flex:1;text-align:center;font-size:15px;font-weight:700;margin-right:36px}
.cart-body{flex:1;overflow-y:auto;padding:12px 16px;padding-bottom:calc(var(--tab-h) + var(--safe-bottom) + 20px)}
.cart-item{display:flex;align-items:center;gap:12px;padding:14px;background:var(--card);border-radius:14px;margin-bottom:8px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.cart-check{width:24px;height:24px;border-radius:50%;border:2px solid var(--text-light);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:.2s;font-size:14px}
.cart-check.checked{background:var(--primary);border-color:var(--primary);color:#fff}
.cart-item-info{flex:1;min-width:0}
.cart-item-name{font-size:13px;line-height:1.3;margin-bottom:3px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.cart-item-price{font-size:15px;font-weight:800}
.cart-item-del{width:28px;height:28px;border-radius:50%;border:none;background:var(--border);font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.cart-bottom{position:fixed;bottom:0;left:0;right:0;padding:12px 16px;padding-bottom:calc(12px + var(--safe-bottom));background:var(--card);box-shadow:0 -2px 10px rgba(0,0,0,.06);z-index:161}
.cart-bottom button{width:100%;padding:14px;border-radius:12px;background:var(--primary);color:#fff;font-size:15px;font-weight:700;border:none;cursor:pointer}
.cart-bottom button:disabled{background:var(--text-light);cursor:default}
.cart-badge{position:absolute;top:-4px;right:-6px;min-width:16px;height:16px;border-radius:8px;background:var(--red);color:#fff;font-size:9px;font-weight:700;display:flex;align-items:center;justify-content:center;padding:0 4px}

/* Settings overlay */
.settings-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:160;display:none;flex-direction:column}
.settings-overlay.show{display:flex}
.settings-header{display:flex;align-items:center;padding:12px 16px;padding-top:calc(12px + var(--safe-top));background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,.04);flex-shrink:0}
.settings-header button{width:36px;height:36px;border:none;background:transparent;font-size:18px;cursor:pointer}
.settings-header h2{flex:1;text-align:center;font-size:15px;font-weight:700;margin-right:36px}
.settings-body{flex:1;overflow-y:auto;padding:0;padding-bottom:calc(var(--safe-bottom) + 20px)}

/* Reward exchange */
.reward-ex{margin:0 16px 12px;background:var(--card);border-radius:16px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.04)}
.reward-ex-header{padding:16px;font-size:15px;font-weight:700;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px}
.reward-ex-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border)}
.reward-ex-item:last-child{border-bottom:none}
.reward-ex-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}
.reward-ex-info{flex:1}
.reward-ex-info h4{font-size:14px;font-weight:600;margin-bottom:2px}
.reward-ex-info p{font-size:12px;color:var(--text-sub)}
.reward-ex-btn{padding:8px 14px;border-radius:10px;font-size:12px;font-weight:700;border:none;cursor:pointer;white-space:nowrap}
.reward-ex-btn.bronze{background:#FEF3C7;color:#92400E}
.reward-ex-btn.silver{background:#F3F4F6;color:#4B5563}
.reward-ex-btn.gold{background:#FDF2F8;color:#9D174D}
.reward-ex-btn:disabled{opacity:.4;cursor:default}
.tier-badge{display:inline-block;padding:2px 8px;border-radius:8px;font-size:10px;font-weight:700;margin-right:4px}
.tier-badge.bronze{background:#FEF3C7;color:#92400E}
.tier-badge.silver{background:#E5E7EB;color:#374151}
.tier-badge.gold{background:#FDF2F8;color:#9D174D}

/* Savings top bar */
.savings-top{margin:0 16px 8px;background:linear-gradient(135deg,#346aff,#6B8FFF);border-radius:14px;padding:14px 16px;color:#fff;display:flex;align-items:center;justify-content:space-between}
.savings-top .left{display:flex;align-items:center;gap:8px}
.savings-top .left .icon{font-size:20px}
.savings-top .left .info .label{font-size:11px;opacity:.85}
.savings-top .left .info .amount{font-size:18px;font-weight:800}
.savings-top .btn{padding:6px 14px;border-radius:8px;background:rgba(255,255,255,.25);color:#fff;font-size:12px;font-weight:600;border:none;cursor:pointer}

/* Price drop alert */
.price-alert{margin:0 16px 8px;background:#FFF8E1;border:1.5px solid #FFD54F;border-radius:12px;padding:12px 14px;display:flex;align-items:center;gap:10px;cursor:pointer;animation:alertPulse 2s ease-in-out infinite}
@keyframes alertPulse{0%,100%{box-shadow:0 0 0 0 rgba(255,213,79,0)}50%{box-shadow:0 0 0 4px rgba(255,213,79,0.3)}}
.price-alert .emoji{font-size:24px;flex-shrink:0}
.price-alert .info{flex:1;min-width:0}
.price-alert .info .title{font-size:13px;font-weight:700;color:#333;margin-bottom:2px}
.price-alert .info .desc{font-size:11px;color:#888}
.price-alert .action{font-size:12px;font-weight:700;color:#346aff;white-space:nowrap}
.price-alert .close-btn{font-size:14px;color:#bbb;cursor:pointer;padding:4px}

/* Quick buy button */
.quick-buy{display:flex;align-items:center;gap:4px;padding:6px 10px;border-radius:8px;background:#346aff;color:#fff;font-size:11px;font-weight:600;border:none;cursor:pointer;white-space:nowrap;margin-top:6px}
.quick-buy:active{opacity:.85}

/* Simple reward banner */
.reward-simple{margin:0 16px 10px;background:linear-gradient(135deg,#FF6B35,#FF9F1C);border-radius:14px;padding:20px;color:#fff;text-align:center}
.reward-simple h3{font-size:18px;font-weight:800;margin-bottom:4px}
.reward-simple p{font-size:13px;opacity:.9;margin-bottom:4px}
.reward-simple .sub{font-size:11px;opacity:.7}
.reward-steps{display:flex;gap:0;margin:0 16px 10px;background:var(--card);border-radius:14px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.reward-step{flex:1;text-align:center;padding:16px 8px;position:relative}
.reward-step:not(:last-child)::after{content:'‚Üí';position:absolute;right:-6px;top:50%;transform:translateY(-50%);font-size:14px;color:var(--text-light);z-index:1}
.reward-step .icon{font-size:24px;margin-bottom:4px}
.reward-step .label{font-size:12px;font-weight:700;color:var(--text)}
.reward-step .desc{font-size:10px;color:var(--text-sub);margin-top:2px}

/* Monthly report */
.report-card{margin:0 16px 8px;background:var(--card);border-radius:16px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.report-card h3{font-size:15px;font-weight:800;margin-bottom:14px;display:flex;align-items:center;gap:6px}
.report-summary{display:flex;gap:0;margin-bottom:14px;background:var(--bg);border-radius:12px;overflow:hidden}
.report-stat{flex:1;text-align:center;padding:12px 8px}
.report-stat .val{font-size:18px;font-weight:800;margin-bottom:2px}
.report-stat .val.blue{color:var(--primary)}
.report-stat .val.green{color:#16A34A}
.report-stat .val.orange{color:#F59E0B}
.report-stat .lbl{font-size:10px;color:var(--text-sub)}
.report-cats{display:flex;flex-direction:column;gap:8px}
.report-cat{display:flex;align-items:center;gap:10px}
.report-cat .emoji{font-size:18px;width:24px;text-align:center}
.report-cat .info{flex:1}
.report-cat .name{font-size:12px;font-weight:600;margin-bottom:2px}
.report-cat .bar-bg{width:100%;height:6px;border-radius:3px;background:var(--border)}
.report-cat .bar{height:100%;border-radius:3px}
.report-cat .amount{font-size:12px;font-weight:700;color:var(--text);white-space:nowrap;min-width:60px;text-align:right}
.report-tip{margin-top:12px;padding:10px 12px;background:linear-gradient(135deg,#EFF6FF,#E0E7FF);border-radius:10px;font-size:12px;color:var(--primary);font-weight:600;text-align:center}

/* Similar products */
.similar-section{margin:0 16px 12px}
.similar-header{font-size:14px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.similar-scroll{display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.similar-scroll::-webkit-scrollbar{display:none}
.similar-card{flex-shrink:0;width:120px;background:var(--card);border-radius:12px;padding:10px;box-shadow:0 1px 4px rgba(0,0,0,.06);cursor:pointer}
.similar-card:active{transform:scale(.97)}
.similar-card .emoji{font-size:28px;text-align:center;margin-bottom:6px}
.similar-card .name{font-size:11px;line-height:1.3;height:29px;overflow:hidden;margin-bottom:4px}
.similar-card .price{font-size:12px;font-weight:700}
.similar-card .discount{font-size:11px;color:var(--red);font-weight:600}
.similar-card .timing{margin-top:4px}

/* Attendance check */
.attend-card{margin:0 16px 8px;background:var(--card);border-radius:16px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.attend-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.attend-header h3{font-size:15px;font-weight:800}
.attend-header .streak{font-size:12px;font-weight:600;color:var(--primary)}
.attend-days{display:flex;justify-content:space-between;gap:4px}
.attend-day{flex:1;text-align:center;padding:8px 0;border-radius:10px;background:var(--bg);position:relative}
.attend-day .d{font-size:10px;color:var(--text-sub);margin-bottom:4px}
.attend-day .stamp{width:28px;height:28px;border-radius:50%;margin:0 auto;display:flex;align-items:center;justify-content:center;font-size:14px;background:var(--border);color:var(--text-light)}
.attend-day.done .stamp{background:var(--primary);color:#fff}
.attend-day.today .stamp{background:#FEF3C7;color:#F59E0B;border:2px solid #F59E0B}
.attend-day.today.done .stamp{background:var(--primary);color:#fff;border:2px solid var(--primary)}
.attend-day.bonus .stamp{background:linear-gradient(135deg,#F59E0B,#FBBF24);color:#fff}
.attend-bonus{margin-top:10px;text-align:center;font-size:12px;color:var(--text-sub)}
.attend-btn{display:block;margin:10px auto 0;padding:8px 24px;border-radius:10px;background:var(--primary);color:#fff;font-size:13px;font-weight:700;border:none;cursor:pointer}
.attend-btn:disabled{background:var(--border);color:var(--text-sub);cursor:default}

/* AI Price Prediction */
.predict-card{margin:0 16px 12px;background:var(--card);border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.predict-header{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.predict-header .ai-badge{padding:3px 8px;border-radius:6px;background:linear-gradient(135deg,#8B5CF6,#A78BFA);color:#fff;font-size:10px;font-weight:700}
.predict-header h4{font-size:14px;font-weight:700;flex:1}
.predict-main{display:flex;align-items:center;gap:16px;margin-bottom:12px}
.predict-circle{width:72px;height:72px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:20px;font-weight:800;flex-shrink:0}
.predict-circle.down{background:#DCFCE7;color:#16A34A}
.predict-circle.up{background:#FEE2E2;color:#DC2626}
.predict-circle.stable{background:#FEF3C7;color:#92400E}
.predict-circle .pct{font-size:10px;font-weight:600;margin-top:-2px}
.predict-info{flex:1}
.predict-info .verdict{font-size:15px;font-weight:700;margin-bottom:4px}
.predict-info .reason{font-size:12px;color:var(--text-sub);line-height:1.4}
.predict-factors{display:flex;flex-wrap:wrap;gap:6px}
.predict-factor{display:flex;align-items:center;gap:4px;padding:4px 10px;border-radius:8px;background:var(--bg);font-size:11px;color:var(--text-sub)}
.predict-factor .dot{width:6px;height:6px;border-radius:50%}

/* Notification center */
.noti-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:160;display:none;flex-direction:column}
.noti-overlay.show{display:flex}
.noti-header{display:flex;align-items:center;padding:12px 16px;padding-top:calc(12px + var(--safe-top));background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,.04);flex-shrink:0}
.noti-header button{width:36px;height:36px;border:none;background:transparent;font-size:18px;cursor:pointer}
.noti-header h2{flex:1;text-align:center;font-size:15px;font-weight:700;margin-right:36px}
.noti-body{flex:1;overflow-y:auto;padding:0}
.noti-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer}
.noti-item.unread{background:#F8FAFF}
.noti-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.noti-content{flex:1;min-width:0}
.noti-content h4{font-size:13px;font-weight:600;margin-bottom:2px}
.noti-content p{font-size:12px;color:var(--text-sub);line-height:1.4}
.noti-time{font-size:11px;color:var(--text-light);white-space:nowrap;flex-shrink:0}
.noti-badge{position:absolute;top:-2px;right:-2px;min-width:14px;height:14px;border-radius:7px;background:#e74c3c;color:#fff;font-size:9px;font-weight:700;display:flex;align-items:center;justify-content:center;padding:0 3px}
.header-bell{position:relative;cursor:pointer}

/* Invite card */
.invite-card{margin:0 16px 8px;background:linear-gradient(135deg,#7C3AED,#A78BFA);border-radius:16px;padding:20px;color:#fff;text-align:center}
.invite-card h3{font-size:16px;font-weight:800;margin-bottom:4px}
.invite-card p{font-size:12px;opacity:.85;margin-bottom:14px}
.invite-reward{display:flex;justify-content:center;gap:16px;margin-bottom:14px}
.invite-reward .item{background:rgba(255,255,255,.2);border-radius:10px;padding:8px 14px;font-size:12px;font-weight:600}
.invite-btn{padding:10px 24px;border-radius:12px;background:#fff;color:#7C3AED;font-size:14px;font-weight:700;border:none;cursor:pointer}
.invite-btn:active{opacity:.85}
.invite-stats{display:flex;justify-content:center;gap:20px;margin-top:12px;font-size:11px;opacity:.8}
.invite-code{margin:8px 16px 0;background:var(--card);border-radius:10px;padding:10px 14px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.invite-code .code{font-size:13px;font-weight:700;color:var(--primary);letter-spacing:1px}
.invite-code .copy-btn{padding:6px 12px;border-radius:8px;background:var(--primary);color:#fff;font-size:12px;font-weight:600;border:none;cursor:pointer}

/* Traffic light */
.timing-badge{display:inline-flex;align-items:center;gap:3px;padding:3px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-top:4px}
.timing-badge.buy{background:#DCFCE7;color:#16A34A}
.timing-badge.wait{background:#FEF3C7;color:#92400E}
.timing-badge.expensive{background:#FEE2E2;color:#DC2626}

/* Challenge card */
.challenge-card{margin:0 16px 8px;background:var(--card);border-radius:16px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.challenge-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.challenge-header h3{font-size:15px;font-weight:800}
.challenge-header .badge{font-size:11px;font-weight:600;padding:3px 10px;border-radius:8px;background:#DCFCE7;color:#16A34A}
.challenge-goal{font-size:13px;color:var(--text-sub);margin-bottom:8px}
.challenge-bar-bg{width:100%;height:10px;border-radius:5px;background:var(--border);overflow:hidden;margin-bottom:6px}
.challenge-bar{height:100%;border-radius:5px;background:linear-gradient(90deg,#346aff,#6B8FFF);transition:width .5s}
.challenge-info{display:flex;justify-content:space-between;font-size:12px;color:var(--text-sub)}
.challenge-info .current{color:var(--primary);font-weight:700}
.challenge-bonus{margin-top:10px;padding:8px 12px;background:var(--primary-light);border-radius:8px;font-size:12px;color:var(--primary);font-weight:600;text-align:center}

/* Share wishlist */
.share-btn{display:flex;align-items:center;gap:4px;padding:6px 10px;border-radius:8px;background:#FEF3C7;color:#92400E;font-size:11px;font-weight:600;border:none;cursor:pointer;white-space:nowrap}
.share-btn:active{opacity:.85}
.gift-request{margin:0 16px 10px;background:linear-gradient(135deg,#EC4899,#F472B6);border-radius:14px;padding:14px 16px;color:#fff;display:flex;align-items:center;gap:10px;cursor:pointer}
.gift-request .icon{font-size:24px}
.gift-request .info{flex:1}
.gift-request .info h4{font-size:14px;font-weight:700;margin-bottom:2px}
.gift-request .info p{font-size:11px;opacity:.85}
.gift-request .action{padding:6px 14px;border-radius:8px;background:rgba(255,255,255,.25);color:#fff;font-size:12px;font-weight:600;border:none;cursor:pointer}

/* Streak card */
.streak-card{margin:0 16px 8px;background:linear-gradient(135deg,#FF6B35,#FF9F1C);border-radius:16px;padding:20px;color:#fff;text-align:center}
.streak-card h3{font-size:16px;font-weight:800;margin-bottom:12px}
.streak-dots{display:flex;justify-content:center;gap:10px;margin-bottom:10px}
.streak-dot{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700}
.streak-dot.filled{background:#fff;color:#FF6B35}
.streak-dot.empty{background:rgba(255,255,255,0.3);color:#fff}
.streak-card .tip{font-size:12px;opacity:.85}
.streak-card .record{font-size:11px;opacity:.7;margin-top:4px}

/* Ranking card */
.ranking-card{margin:0 16px 8px;background:var(--card);border-radius:16px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.ranking-card h3{font-size:15px;font-weight:800;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.ranking-item{display:flex;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);gap:10px}
.ranking-item:last-child{border-bottom:none}
.ranking-item.me{background:#EFF6FF;margin:0 -16px;padding:10px 16px;border-radius:8px}
.ranking-medal{font-size:18px;width:28px;text-align:center}
.ranking-rank{font-size:14px;font-weight:700;color:var(--text-sub);width:28px;text-align:center}
.ranking-name{flex:1;font-size:14px;font-weight:600}
.ranking-amount{font-size:14px;font-weight:700;color:var(--primary)}
</style>
</head>
<body>
<div id="app-shell">

<!-- Header -->
<div class="header" id="main-header">
  <h1 id="header-title">Í¥ÄÏã¨ÏÉÅÌíà</h1>
  <div class="header-icons">
    <span class="header-bell" onclick="openNotiCenter()">üîî<span class="noti-badge" id="noti-badge" style="display:none">0</span></span>
    <span id="header-cart" onclick="openCart()" style="position:relative">üõí<span class="cart-badge" id="cart-badge" style="display:none">0</span></span>
    <span id="header-setting" onclick="openSettings()">‚öôÔ∏è</span>
  </div>
</div>

<!-- Content -->
<div class="content" id="content">

  <!-- Onboarding AI Chat -->
  <div class="page active" id="page-start">
    <div class="onboard">
      <div class="onboard-header">
        <div class="onboard-logo">PricePick</div>
        <div class="onboard-sub">AI ÏáºÌïë Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏</div>
      </div>
      <div class="chat-area" id="chat-area"></div>
      <div class="chat-input-area" id="chat-input-area">
        <input type="text" id="chat-input" placeholder="ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî..." onkeydown="if(event.key==='Enter')sendChatInput()">
        <button onclick="sendChatInput()">‚Üí</button>
      </div>
    </div>
  </div>

  <!-- Í¥ÄÏã¨ÏÉÅÌíà -->
  <div class="page" id="page-wish">
    <div class="gift-request" onclick="shareWishlist()">
      <span class="icon">üéÅ</span>
      <div class="info">
        <h4>ÏúÑÏãúÎ¶¨Ïä§Ìä∏ Í≥µÏú†ÌïòÍ∏∞</h4>
        <p>ÏπúÍµ¨ÏóêÍ≤å ÎÇ¥Í∞Ä Í∞ñÍ≥† Ïã∂ÏùÄ ÏÉÅÌíàÏùÑ ÏïåÎ†§Ï£ºÏÑ∏Ïöî</p>
      </div>
      <button class="action">Í≥µÏú†</button>
    </div>
    <div style="padding:4px 16px 0">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
        <span class="chip active" id="wish-count">Ï†ÑÏ≤¥ 0</span>
        <span class="chip" onclick="switchTab('search')" style="font-size:14px;padding:6px 12px">+ Ï∂îÍ∞Ä</span>
      </div>
    </div>
    <div class="category-row">
      <div class="cat-item"><div class="cat-icon">üõí</div><div class="cat-label">Íµ¨Îß§ÌÉÄÏù¥Î∞ç</div></div>
      <div class="cat-item"><div class="cat-icon">üìâ</div><div class="cat-label">Ïó≠ÎåÄÏµúÏ†ÄÍ∞Ä</div></div>
      <div class="cat-item"><div class="cat-icon">üîÑ</div><div class="cat-label">ÏûêÏ£º ÏÇ∞ ÏÉÅÌíà</div></div>
      <div class="cat-item"><div class="cat-icon">üî•</div><div class="cat-label">ÏµúÍ∑º Ìï†Ïù∏</div></div>
      <div class="cat-item"><div class="cat-icon">‚≠ê</div><div class="cat-label">Ïù∏Í∏∞ÏÉÅÌíà</div></div>
    </div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 16px">
      <span style="font-size:12px;color:var(--text-sub)">ÏµúÏã†Ïàú</span>
      <div style="display:flex;gap:12px">
        <span style="font-size:12px;color:var(--text-sub);cursor:pointer">ÌïÑÌÑ∞</span>
        <span style="font-size:12px;color:var(--text-sub);cursor:pointer">Ìé∏Ïßë</span>
      </div>
    </div>
    <div id="wish-list"></div>
  </div>

  <!-- Ìï´Îîú (Ìôà) -->
  <div class="page" id="page-hot">
    <div id="attend-area"></div>
    <div id="savings-top-area"></div>
    <div id="price-alert-area"></div>
    <div id="hot-extra"></div>
  </div>

  <!-- ÌòúÌÉù -->
  <div class="page" id="page-benefit">
    <!-- ÌïµÏã¨ Î©îÏãúÏßÄ -->
    <div class="reward-simple" style="margin-top:10px">
      <h3>ÏáºÌïëÌïòÎ©¥ Ïª§ÌîºÍ∞Ä Í≥µÏßú! ‚òï</h3>
      <p>Ïø†Ìå°ÏóêÏÑú ÌèâÏÜåÏ≤òÎüº ÏáºÌïëÌïòÏÑ∏Ïöî</p>
      <div class="sub">Íµ¨Îß§ Í∏àÏï°Ïóê Îî∞Îùº Î¶¨ÏõåÎìú Ìã∞ÏºìÏù¥ ÏåìÏó¨Ïöî</div>
    </div>

    <!-- 3Îã®Í≥Ñ ÏïàÎÇ¥ -->
    <div class="reward-steps">
      <div class="reward-step">
        <div class="icon">üõí</div>
        <div class="label">Ïø†Ìå° Íµ¨Îß§</div>
        <div class="desc">ÌèâÏÜåÏ≤òÎüº ÏáºÌïë</div>
      </div>
      <div class="reward-step">
        <div class="icon">üé´</div>
        <div class="label">Ìã∞Ïºì Ï†ÅÎ¶Ω</div>
        <div class="desc">ÏûêÎèô ÏßÄÍ∏â</div>
      </div>
      <div class="reward-step">
        <div class="icon">‚òï</div>
        <div class="label">Ïª§Ìîº ÍµêÌôò</div>
        <div class="desc">Í∏∞ÌîÑÌã∞ÏΩò Î∞õÍ∏∞</div>
      </div>
    </div>

    <div id="benefit-ticket">
      <!-- ÎÇ¥ Ìã∞Ïºì ÌòÑÌô© (Í∞ÑÍ≤∞) -->
      <div class="ticket-box">
        <div class="ticket-box-title">
          <h3>ÎÇ¥ Ìã∞Ïºì</h3>
          <span class="tip" id="ticket-pending">Ï†ÅÎ¶ΩÏòàÏ†ï 0Ïû•</span>
        </div>
        <div class="ticket-stats">
          <div class="ticket-stat"><div class="label">ÏÇ¨Ïö© Í∞ÄÎä•</div><div class="val"><span class="icon">üé´</span> <span id="ticket-available">0</span></div></div>
          <div class="ticket-stat"><div class="label">Ïª§ÌîºÍπåÏßÄ</div><div class="val"><span class="icon">‚òï</span> <span id="ticket-remaining">8</span></div></div>
        </div>
        <div class="ticket-actions">
          <button onclick="switchTab('hot')">ÏáºÌïëÌïòÎü¨ Í∞ÄÍ∏∞</button>
          <button class="primary" onclick="scrollToRaffle()">Í≤ΩÌíà Ï∂îÏ≤®</button>
        </div>
      </div>

      <!-- ÍµêÌôòÏÜå (Ïã¨Ìîå) -->
      <div class="section-header" style="padding-top:8px">‚òï Ìã∞Ïºì ÍµêÌôòÏÜå</div>
      <div class="reward-ex" id="reward-exchange">
        <div class="reward-ex-item">
          <div class="reward-ex-icon" style="background:#FEF3C7">‚òï</div>
          <div class="reward-ex-info">
            <h4>ÏïÑÏù¥Ïä§ ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏</h4>
            <p>Ìã∞Ïºì 8Ïû•ÏúºÎ°ú ÍµêÌôò</p>
          </div>
          <button class="reward-ex-btn bronze" id="ex-bronze-btn" onclick="exchangeReward('bronze')">ÍµêÌôò</button>
        </div>
        <div class="reward-ex-item">
          <div class="reward-ex-icon" style="background:#FEF3C7">üçï</div>
          <div class="reward-ex-info">
            <h4>ÎèÑÎØ∏ÎÖ∏ÌîºÏûê ÏÑ∏Ìä∏</h4>
            <p>Ìã∞Ïºì 20Ïû•ÏúºÎ°ú ÍµêÌôò</p>
          </div>
          <button class="reward-ex-btn gold" onclick="exchangeReward('gold')">ÍµêÌôò</button>
        </div>
      </div>

      <!-- Ï∂îÏ≤® -->
      <div class="section-header" id="raffle-anchor" style="padding-top:8px">üé∞ Í≤ΩÌíà Ï∂îÏ≤®</div>
      <div class="raffle-section">
        <h3>Ìã∞ÏºìÏúºÎ°ú Í≤ΩÌíà ÏùëÎ™®!</h3>
        <p>Îß§Ïùº Ï∂îÏ≤® Í∏∞Ìöå</p>
        <div class="raffle-ball" id="raffle-ball">?</div>
        <div class="raffle-info">ÎÇ¥ Ìã∞Ïºì: <b id="raffle-tickets">0</b>Ïû•</div>
        <button class="raffle-btn" onclick="doRaffle()">Ï∂îÏ≤®ÌïòÍ∏∞</button>
      </div>
      <div class="raffle-prizes" id="raffle-prizes"></div>

      <!-- ÏßÑÌñâÏ§ë Ïù¥Î≤§Ìä∏ -->
      <div class="section-header" style="padding-top:8px">üéä ÏßÑÌñâÏ§ë Ïù¥Î≤§Ìä∏</div>
      <div class="h-scroll" id="event-2x-scroll"></div>
    </div>

  </div>

  <!-- Í≤ÄÏÉâ -->
  <div class="page" id="page-search">
    <div style="padding:12px 16px">
      <div style="display:flex;gap:8px;align-items:center">
        <input type="text" class="input-field" id="search-input" placeholder="Ï∞æÎäî ÏÉÅÌíàÏù¥ ÏûàÎÇòÏöî?" oninput="doSearch()" onkeydown="if(event.key==='Enter')submitSearch()" style="flex:1">
      </div>
    </div>
    <div id="search-home"></div>
    <div id="search-results" style="padding:0 16px"></div>
  </div>

  <!-- ÎßàÏù¥ÌéòÏù¥ÏßÄ -->
  <div class="page" id="page-my">
    <div class="mypage-profile">
      <div class="mypage-avatar" id="my-avatar">P</div>
      <div class="mypage-name" id="my-name">-</div>
      <div class="mypage-email" id="my-email">-</div>
      <div id="my-badge-area"></div>
    </div>
    <div class="mypage-section">
      <div class="stats-grid">
        <div class="stat-box"><div class="val" id="my-tickets">0</div><div class="lbl">Ìã∞Ïºì</div></div>
        <div class="stat-box"><div class="val" id="my-purchases">0</div><div class="lbl">Íµ¨Îß§</div></div>
        <div class="stat-box"><div class="val" id="my-wishcnt">0</div><div class="lbl">Í¥ÄÏã¨ÏÉÅÌíà</div></div>
        <div class="stat-box"><div class="val" id="my-raffles">0</div><div class="lbl">Ï∂îÏ≤®</div></div>
      </div>
    </div>
    <div id="my-report-section"></div>
    <div id="my-invite-section"></div>
    <div id="my-challenge-section"></div>
    <div id="my-streak-section"></div>
    <div id="my-savings-section"></div>
    <div id="my-ranking-section"></div>
    <div class="mypage-section" id="wow-section">
      <div class="mypage-section-title">Ïø†Ìå° Î©§Î≤ÑÏã≠</div>
      <div class="mypage-row" onclick="toggleWow()">
        <div class="left"><span class="icon">üöÄ</span> Ïø†Ìå° ÏôÄÏö∞ Î©§Î≤ÑÏã≠</div>
        <div class="right" id="wow-status"><span style="color:var(--primary);font-size:13px">Í∞ÄÏûÖÌïòÍ∏∞</span> <span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="showModal('üöÄ','ÏôÄÏö∞ ÌòúÌÉù ÏïàÎÇ¥','<b>Ïø†Ìå° ÏôÄÏö∞ Î©§Î≤ÑÏã≠ ÌòúÌÉù</b><br><br>‚úÖ Î°úÏºìÎ∞∞ÏÜ° Î¨¥Î£åÎ∞∞ÏÜ°<br>‚úÖ Î°úÏºìÌîÑÎ†àÏãú Î¨¥Î£åÎ∞∞ÏÜ°<br>‚úÖ Ïø†Ìå°ÌîåÎ†àÏù¥ Î¨¥Î£å Ïù¥Ïö©<br>‚úÖ ÏôÄÏö∞ Ìï†Ïù∏Í∞Ä Ï†ÅÏö©<br>‚úÖ Ïø†Ìå°Ïù¥Ï∏† Î¨¥Î£åÎ∞∞Îã¨<br><br><span style=font-size:12px;color:var(--text-sub)>Ïõî 4,990Ïõê / Ïó∞ 58,000Ïõê</span>')">
        <div class="left"><span class="icon">üìã</span> ÏôÄÏö∞ ÌòúÌÉù Î≥¥Í∏∞</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="showModal('üìä','Ïù¥Î≤à Îã¨ ÏôÄÏö∞ Ï†àÏïΩ','<b>Î¨¥Î£åÎ∞∞ÏÜ°ÏúºÎ°ú ÏïÑÎÇÄ Î∞∞ÏÜ°ÎπÑ</b><br><br>üöÄ Î°úÏºìÎ∞∞ÏÜ°: <b>12,000Ïõê</b><br>ü•¨ Î°úÏºìÌîÑÎ†àÏãú: <b>8,000Ïõê</b><br>üé¨ Ïø†Ìå°ÌîåÎ†àÏù¥: <b>7,900Ïõê</b><br><br>Ï¥ù Ï†àÏïΩ: <b style=color:var(--primary)>27,900Ïõê</b>')">
        <div class="left"><span class="icon">üí∞</span> Ïù¥Î≤à Îã¨ Ï†àÏïΩ ÎÇ¥Ïó≠</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">Í≥ÑÏ†ï Ïó∞Îèô</div>
      <div class="mypage-row" id="kakao-row" onclick="linkKakao()">
        <div class="left"><span class="icon">üí¨</span> Ïπ¥Ïπ¥Ïò§ Ïó∞Îèô</div>
        <div class="right" id="kakao-status"><span style="color:var(--primary);font-size:13px">Ïó∞ÎèôÌïòÍ∏∞</span> <span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleMarketing()">
        <div class="left"><span class="icon">üì¢</span> ÎßàÏºÄÌåÖ ÏàòÏã† ÎèôÏùò</div>
        <div class="right"><div class="toggle" id="toggle-marketing"></div></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ÏïåÎ¶º ÏÑ§Ï†ï</div>
      <div class="mypage-row" onclick="toggleNoti('price')">
        <div class="left"><span class="icon">üìâ</span> Í∞ÄÍ≤© ÌïòÎùΩ ÏïåÎ¶º</div>
        <div class="right"><div class="toggle on" id="toggle-price"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleNoti('restock')">
        <div class="left"><span class="icon">üì¶</span> Ïû¨ÏûÖÍ≥† ÏïåÎ¶º</div>
        <div class="right"><div class="toggle" id="toggle-restock"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleNoti('event')">
        <div class="left"><span class="icon">üéâ</span> Ïù¥Î≤§Ìä∏ ÏïåÎ¶º</div>
        <div class="right"><div class="toggle on" id="toggle-event"></div></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">Í≥†Í∞ùÏÑºÌÑ∞</div>
      <div class="mypage-row" onclick="openSub('notice')">
        <div class="left"><span class="icon">üìã</span> Í≥µÏßÄÏÇ¨Ìï≠</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="openInquiry()">
        <div class="left"><span class="icon">ü§ñ</span> 1:1 Î¨∏ÏùòÌïòÍ∏∞</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ÏïΩÍ¥Ä Î∞è Ï†ïÏ±Ö</div>
      <div class="mypage-row" onclick="openSub('terms')">
        <div class="left"><span class="icon">üìÑ</span> Ïù¥Ïö©ÏïΩÍ¥Ä</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="openSub('privacy')">
        <div class="left"><span class="icon">üîí</span> Í∞úÏù∏Ï†ïÎ≥¥ Ï≤òÎ¶¨Î∞©Ïπ®</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
    </div>
    <div class="mypage-section" style="margin-bottom:20px">
      <div class="mypage-row" onclick="doLogout()">
        <div class="left" style="color:var(--text-sub)"><span class="icon">üö™</span> Î°úÍ∑∏ÏïÑÏõÉ</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="doDeleteAccount()">
        <div class="left" style="color:var(--red)"><span class="icon">‚ö†Ô∏è</span> Í≥ÑÏ†ïÌÉàÌá¥</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
    </div>
  </div>
</div>

<!-- Tab bar -->
<div class="tabbar" id="tabbar" style="display:none">
  <div class="tab" data-tab="hot" onclick="switchTab('hot')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    Ìôà
  </div>
  <div class="tab" data-tab="wish" onclick="switchTab('wish')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
    Í¥ÄÏã¨ÏÉÅÌíà
  </div>
  <div class="tab tab-center" data-tab="search" onclick="switchTab('search')">
    <button class="tab-center-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" width="22" height="22"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    </button>
    <span style="margin-top:30px;font-size:10px;color:var(--text-sub)">Í≤ÄÏÉâ</span>
  </div>
  <div class="tab" data-tab="benefit" onclick="switchTab('benefit')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="2" y="6" width="20" height="14" rx="2"/><path d="M2 10h20"/><path d="M12 6v14"/></svg>
    ÌòúÌÉù
  </div>
  <div class="tab" data-tab="my" onclick="switchTab('my')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    ÎßàÏù¥
  </div>
</div>

<!-- Product Detail Overlay -->
<div class="detail-overlay" id="detail-overlay">
  <div class="detail-top">
    <button onclick="closeDetail()">‚Üê</button>
    <button>üîó</button>
    <button class="share">üì§</button>
  </div>
  <div class="detail-scroll" id="detail-scroll"></div>
  <div class="detail-bottom" id="detail-bottom"></div>
</div>

<!-- Sub-page Overlay -->
<div class="sub-overlay" id="sub-overlay">
  <div class="sub-header">
    <button onclick="closeSub()">‚Üê</button>
    <h2 id="sub-title">-</h2>
  </div>
  <div class="sub-body" id="sub-body"></div>
</div>

<!-- Add Product Modal -->
<div class="modal-overlay" id="add-modal" onclick="if(event.target===this)closeAddModal()">
  <div class="modal" style="max-width:340px;padding:20px 16px;text-align:left">
    <h3 style="text-align:center;margin-bottom:12px">Í¥ÄÏã¨ÏÉÅÌíà Ï∂îÍ∞Ä</h3>
    <div style="margin-bottom:10px"><span class="input-label">ÏÉÅÌíà ÏÑ†ÌÉù</span></div>
    <div id="add-product-list" style="max-height:300px;overflow-y:auto"></div>
    <button class="modal-btn" style="margin-top:12px" onclick="closeAddModal()">Îã´Í∏∞</button>
  </div>
</div>

<!-- Cart Overlay -->
<div class="cart-overlay" id="cart-overlay">
  <div class="cart-header">
    <button onclick="closeCart()">‚Üê</button>
    <h2>Ïû•Î∞îÍµ¨Îãà</h2>
  </div>
  <div class="cart-body" id="cart-body"></div>
  <div class="cart-bottom" id="cart-bottom-bar" style="display:none">
    <button id="cart-go-btn" onclick="cartGoToCoupang()" disabled>ÏÑ†ÌÉùÌïú ÏÉÅÌíà Ïø†Ìå°ÏóêÏÑú Î≥¥Í∏∞</button>
  </div>
</div>

<!-- Settings Overlay -->
<div class="settings-overlay" id="settings-overlay">
  <div class="settings-header">
    <button onclick="closeSettings()">‚Üê</button>
    <h2>ÏÑ§Ï†ï</h2>
  </div>
  <div class="settings-body" id="settings-body">
    <div class="mypage-section">
      <div class="mypage-section-title">ÏïåÎ¶º</div>
      <div class="mypage-row" onclick="toggleSetting('noti_price')">
        <div class="left"><span class="icon">üìâ</span> Í∞ÄÍ≤© ÌïòÎùΩ ÏïåÎ¶º</div>
        <div class="right"><div class="toggle on" id="set-noti-price"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleSetting('noti_restock')">
        <div class="left"><span class="icon">üì¶</span> Ïû¨ÏûÖÍ≥† ÏïåÎ¶º</div>
        <div class="right"><div class="toggle" id="set-noti-restock"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleSetting('noti_event')">
        <div class="left"><span class="icon">üéâ</span> Ïù¥Î≤§Ìä∏/ÌòúÌÉù ÏïåÎ¶º</div>
        <div class="right"><div class="toggle on" id="set-noti-event"></div></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">ÌëúÏãú</div>
      <div class="mypage-row" onclick="toggleSetting('dark_mode')">
        <div class="left"><span class="icon">üåô</span> Îã§ÌÅ¨ Î™®Îìú</div>
        <div class="right"><div class="toggle" id="set-dark-mode"></div></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="toggleSetting('price_unit')">
        <div class="left"><span class="icon">üí∞</span> ÎßåÏõê Îã®ÏúÑ ÌëúÏãú</div>
        <div class="right"><div class="toggle" id="set-price-unit"></div></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">Îç∞Ïù¥ÌÑ∞</div>
      <div class="mypage-row" onclick="clearCache()">
        <div class="left"><span class="icon">üóëÔ∏è</span> Ï∫êÏãú ÏÇ≠Ï†ú</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="exportData()">
        <div class="left"><span class="icon">üì§</span> Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
    </div>
    <div class="mypage-section">
      <div class="mypage-section-title">Ïï± Ï†ïÎ≥¥</div>
      <div class="mypage-row">
        <div class="left"><span class="icon">üì±</span> Î≤ÑÏ†Ñ</div>
        <div class="right"><span style="color:var(--text-sub)">1.0.0</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="openSub('terms')">
        <div class="left"><span class="icon">üìÑ</span> Ïù¥Ïö©ÏïΩÍ¥Ä</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
      <div class="mypage-divider"></div>
      <div class="mypage-row" onclick="openSub('privacy')">
        <div class="left"><span class="icon">üîí</span> Í∞úÏù∏Ï†ïÎ≥¥ Ï≤òÎ¶¨Î∞©Ïπ®</div>
        <div class="right"><span class="arrow">‚Ä∫</span></div>
      </div>
    </div>
  </div>
</div>

<!-- Notification Center -->
<div class="noti-overlay" id="noti-overlay">
  <div class="noti-header">
    <button onclick="closeNotiCenter()">‚Üê</button>
    <h2>ÏïåÎ¶º</h2>
  </div>
  <div class="noti-body" id="noti-body"></div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal" id="modal-content"></div>
</div>

<script>
// ===== DATA =====
var PRODUCTS=[
  {id:1,name:'LG Ïä§ÌÉ†Î∞îÏù¥ÎØ∏ 27Ïù∏Ïπò Ìè¨ÌÑ∞Î∏î Î™®ÎãàÌÑ∞',emoji:'üñ•Ô∏è',originalPrice:1190000,currentPrice:899000,discount:24,url:'https://www.coupang.com/vp/products/7335498014',badge:'rocket',category:'Ï†ÑÏûê/ÎîîÏßÄÌÑ∏',ai:'Ï£ºÎ∞©ÏóêÏÑú Î†àÏãúÌîº Î≥¥Î©¥ÏÑú ÏöîÎ¶¨ÌïòÎ†§Í≥† ÏÉÄÏñ¥Ïöî. ÏïÑÏù¥ ÏòÅÏÉÅ ÌãÄÏñ¥ÎÜìÍ∏∞ÏóêÎèÑ Îî±!'},
  {id:2,name:'Ïï†Ìîå ÏóêÏñ¥Ìåü ÌîÑÎ°ú 2ÏÑ∏ÎåÄ USB-C',emoji:'üéß',originalPrice:359000,currentPrice:289000,discount:19,url:'https://www.coupang.com/vp/products/7601553541',badge:'rocket',category:'Ï†ÑÏûê/ÎîîÏßÄÌÑ∏',ai:'ÏßÄÌïòÏ≤† Ï∂úÌá¥Í∑ºÍ∏∏Ïóê ÎÖ∏Ïù¥Ï¶àÏ∫îÏä¨ÎßÅÏù¥ ÌïÑÏàòÎùº Íµ¨Îß§ÌñàÏñ¥Ïöî. ÌÜµÌôî ÌíàÏßàÎèÑ Ï¢ãÏïÑÏöî.'},
  {id:3,name:'Îã§Ïù¥Ïä® V15 ÎîîÌÖçÌä∏ Î¨¥ÏÑ†Ï≤≠ÏÜåÍ∏∞',emoji:'üßπ',originalPrice:1290000,currentPrice:899000,discount:30,url:'https://www.coupang.com/vp/products/6497498498',badge:'hot',category:'ÏÉùÌôú/Ï£ºÎ∞©',ai:'ÏïÑÏù¥ ÏûàÎäî ÏßëÏù¥Îùº Îß§Ïùº Ï≤≠ÏÜåÌï¥Ïïº Ìï¥ÏÑúÏöî. Î†àÏù¥Ï†ÄÎ°ú Î®ºÏßÄ Î≥¥Ïù¥ÎãàÍπå Îçî Íπ®ÎÅóÌïòÍ≤å!'},
  {id:4,name:'ÏÇºÏÑ± Í∞§Îü≠Ïãú Î≤ÑÏ¶à3 ÌîÑÎ°ú',emoji:'üéµ',originalPrice:359900,currentPrice:279000,discount:22,url:'https://www.coupang.com/vp/products/8040177674',badge:'rocket',category:'Ï†ÑÏûê/ÎîîÏßÄÌÑ∏',ai:'Í∞§Îü≠Ïãú Ïì∞ÎäîÎç∞ ÏóêÏñ¥ÌåüÎ≥¥Îã§ Ïó∞ÎèôÏù¥ Ï¢ãÏïÑÏÑú Î∞îÍø®Ïñ¥Ïöî. ANC ÏÑ±Îä•ÎèÑ ÎßåÏ°±!'},
  {id:5,name:'ÎÇòÏù¥ÌÇ§ ÏóêÏñ¥Ìè¨Ïä§1 07 ÌôîÏù¥Ìä∏',emoji:'üëü',originalPrice:139000,currentPrice:99900,discount:28,url:'https://www.coupang.com/vp/products/6023436854',badge:'lowest',category:'Ìå®ÏÖò/ÏùòÎ•ò',ai:'Îç∞ÏùºÎ¶¨ Ïã†Î∞úÎ°ú ÏµúÍ≥†! Ïñ¥Îñ§ Ïò∑Ïù¥Îì† Ïûò Ïñ¥Ïö∏Î†§ÏÑú Î™á Ïº§Î†àÏß∏ Ïû¨Íµ¨Îß§ Ï§ë.'},
  {id:6,name:'ÏÉ§Ïò§ÎØ∏ Î°úÎ¥áÏ≤≠ÏÜåÍ∏∞ X20 Pro Plus',emoji:'ü§ñ',originalPrice:899000,currentPrice:599000,discount:33,url:'https://www.coupang.com/vp/products/7812345678',badge:'hot',category:'ÏÉùÌôú/Ï£ºÎ∞©',ai:'ÎßûÎ≤åÏù¥Îùº Ï≤≠ÏÜåÌï† ÏãúÍ∞ÑÏù¥ ÏóÜÏñ¥ÏÑú Íµ¨Îß§. Î¨ºÍ±∏Î†àÍπåÏßÄ ÏûêÎèôÏù¥Îùº ÎÑàÎ¨¥ Ìé∏Ìï¥Ïöî.'},
  {id:7,name:'Ìè¨Ïπ¥Î¶¨Ïä§Ïõ®Ìä∏ 1.5L 12Í∞ú',emoji:'üíß',originalPrice:28000,currentPrice:25600,discount:9,url:'https://www.coupang.com/vp/products/1234567890',badge:'rocket',category:'ÏãùÌíà/ÏùåÎ£å',ai:'Ìó¨Ïä§Ïû• Îã§ÎãàÎ©¥ÏÑú Ïö¥Îèô ÌõÑ Îß§Ïùº ÎßàÏÖîÏÑú ÎåÄÎüâÍµ¨Îß§ÌñàÏñ¥Ïöî. Îã®Í∞Ä Ï†àÏïΩ!'},
  {id:8,name:'ÌîÑÎ°úÌïè Ïä§Ìè¨Ï∏† WPI Ï¥àÏΩúÎ¶ø 330ml x12',emoji:'ü•õ',originalPrice:29000,currentPrice:24900,discount:14,url:'https://www.coupang.com/vp/products/2345678901',badge:'rocket',category:'ÏãùÌíà/ÏùåÎ£å',ai:'Ïö¥Îèô ÌõÑ Îã®Î∞±Ïßà Î≥¥Ï∂©Ïö©ÏúºÎ°ú Îß§Ïùº ÌïòÎÇòÏî©. ÎßõÎèÑ Í¥úÏ∞ÆÍ≥† Í∞ÄÍ≤©ÎèÑ Ìï©Î¶¨Ï†Å!'},
];

var RAFFLE_PRIZES=[
  {rank:1,prize:'ÎèÑÎØ∏ÎÖ∏ÌîºÏûê ÎùºÏßÄ ÏÑ∏Ìä∏',icon:'üçï',desc:'ÌéòÌçºÎ°úÎãà + ÏΩúÎùº 1.25L'},
  {rank:2,prize:'Îß•ÎèÑÎÇ†Îìú ÎπÖÎß• ÏÑ∏Ìä∏',icon:'üçî',desc:'ÎπÖÎß• + Í∞êÏûêÌäÄÍπÄ + ÏΩúÎùº'},
  {rank:3,prize:'Ïä§ÌÉÄÎ≤ÖÏä§ ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏',icon:'‚òï',desc:'Tall ÏÇ¨Ïù¥Ï¶à'},
];

var EVENT_2X=[
  {cat:'Ï†ÑÏûêÏ†úÌíà',emoji:'üñ•Ô∏è',bg:'linear-gradient(135deg,#346aff,#6B8FFF)',end:'02/28'},
  {cat:'Ìå®ÏÖò/ÏùòÎ•ò',emoji:'üëü',bg:'linear-gradient(135deg,#8B5CF6,#A78BFA)',end:'02/20'},
  {cat:'ÏÉùÌôúÏö©Ìíà',emoji:'üßπ',bg:'linear-gradient(135deg,#10B981,#34D399)',end:'02/25'},
  {cat:'ÏãùÌíà/ÏùåÎ£å',emoji:'ü•§',bg:'linear-gradient(135deg,#F59E0B,#FBBF24)',end:'03/05'},
  {cat:'Î∑∞Ìã∞',emoji:'üíÑ',bg:'linear-gradient(135deg,#EC4899,#F472B6)',end:'02/15'},
];

// ===== STORAGE =====
function S(k,v){if(v===undefined){try{return JSON.parse(localStorage.getItem('pp_'+k))}catch(e){return null}}localStorage.setItem('pp_'+k,JSON.stringify(v))}
function getUser(){return S('user')}
function getTracks(){return S('tracks')||[]}
function setTracks(t){S('tracks',t)}
function getTickets(){return S('tickets')||{pending:0,available:0,history:[]}}
function setTickets(t){S('tickets',t)}
function getPurchases(){return S('purchases')||[]}
function getSettings(){return S('settings')||{marketing:false}}
function setSettings(s){S('settings',s)}
function getRaffleCount(){return S('raffles')||0}
function setRaffleCount(n){S('raffles',n)}
function getStreak(){return S('streak')||{current:0,longest:0,lastDate:null}}
function setStreak(s){S('streak',s)}
function getRanking(){return S('ranking')||[]}

// ===== ONBOARDING AI CHAT =====
var obStep=0;
var obData={nickname:'',noti:true};
var chatArea,chatInput,chatInputArea;

function startOnboarding(){
  chatArea=document.getElementById('chat-area');
  chatInput=document.getElementById('chat-input');
  chatInputArea=document.getElementById('chat-input-area');
  obStep=0;
  chatArea.innerHTML='';
  setTimeout(function(){obNext()},500);
}

function obNext(){
  if(obStep===0){
    addBotMsg('ÏïàÎÖïÌïòÏÑ∏Ïöî! üëã');
    setTimeout(function(){
      addBotMsg('Ï†ÄÎäî PricePick AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ÏòàÏöî.\nÏø†Ìå° ÏµúÏ†ÄÍ∞ÄÎ•º Ï∂îÏ†ÅÌïòÍ≥†, ÏáºÌïëÌï† Îïå Î¶¨ÏõåÎìúÎ•º Î∞õÏùÑ Ïàò ÏûàÎèÑÎ°ù ÎèÑÏôÄÎìúÎ†§Ïöî!');
      setTimeout(function(){
        addBotMsg('Î®ºÏ†Ä, Ïñ¥Îñ§ Ïù¥Î¶ÑÏúºÎ°ú Î∂àÎü¨ÎìúÎ¶¥ÍπåÏöî?');
        showInput('ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
        obStep=1;
      },800);
    },600);
  } else if(obStep===2){
    addBotMsg(obData.nickname+'Îãò, Î∞òÍ∞ÄÏõåÏöî! üòä');
    setTimeout(function(){
      addBotMsg('Í∞ÄÍ≤©Ïù¥ ÎÇ¥Î†§Í∞ÄÎ©¥ ÏïåÎ¶ºÏùÑ Î≥¥ÎÇ¥ÎìúÎ¶¥ÍπåÏöî?\nÍ¥ÄÏã¨ÏÉÅÌíàÏùò Í∞ÄÍ≤© Î≥ÄÎèôÏùÑ Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ï∂îÏ†ÅÌï¥ÎìúÎ†§Ïöî!');
      showOptions(['ÎÑ§, ÏïåÎ¶º Î∞õÏùÑÍ≤åÏöî üîî','ÏïÑÎãàÏöî, Í¥úÏ∞ÆÏïÑÏöî']);
      obStep=3;
    },700);
  } else if(obStep===4){
    var notiMsg=obData.noti?'Ï¢ãÏïÑÏöî! ÏµúÏ†ÄÍ∞ÄÎ•º ÎÜìÏπòÏßÄ ÏïäÎèÑÎ°ù ÏïåÎ†§ÎìúÎ¶¥Í≤åÏöî üìä':'ÏïåÍ≤†Ïñ¥Ïöî! ÎÇòÏ§ëÏóê ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑú Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏñ¥Ïöî.';
    addBotMsg(notiMsg);
    setTimeout(function(){
      addBotMsg('PricePickÏùÄ Ïù¥Î†áÍ≤å ÎèÑÏôÄÎìúÎ†§Ïöî:');
      setTimeout(function(){
        addBotMsg('üìä <b>Í∞ÄÍ≤© Ï∂îÏ†Å</b> ‚Äî Í¥ÄÏã¨ÏÉÅÌíàÏùò Í∞ÄÍ≤©ÏùÑ Îß§Ïùº Ï∂îÏ†ÅÌïòÍ≥† Ïó≠ÎåÄ ÏµúÏ†ÄÍ∞ÄÎ•º ÏïåÎ†§ÎìúÎ†§Ïöî');
        setTimeout(function(){
          addBotMsg('üé´ <b>ÏáºÌïë Î¶¨ÏõåÎìú</b> ‚Äî Íµ¨Îß§ÌïòÎ©¥ Ïù¥Î≤§Ìä∏ Ìã∞ÏºìÏù¥ ÏßÄÍ∏âÎèºÏöî. Í∏àÏï°Ïù¥ ÌÅ¥ÏàòÎ°ù Îçî Ï¢ãÏùÄ Ìã∞Ïºì!');
          setTimeout(function(){
            addBotMsg('üçï <b>Í≤ΩÌíà Ï∂îÏ≤®</b> ‚Äî Ìã∞ÏºìÏúºÎ°ú ÎèÑÎØ∏ÎÖ∏ÌîºÏûê, Îß•ÎèÑÎÇ†Îìú, Ïä§ÌÉÄÎ≤ÖÏä§ Îì± Í≤ΩÌíàÏóê ÏùëÎ™®Ìï¥Ïöî');
            setTimeout(function(){
              addBotMsg('Í∑∏Îüº ÏãúÏûëÌï¥Î≥ºÍπåÏöî? üòÑ');
              showOptions(['ÏãúÏûëÌïòÍ∏∞! üéâ']);
              obStep=5;
            },600);
          },600);
        },600);
      },500);
    },600);
  } else if(obStep===6){
    addBotMsg('Ï¢ãÏïÑÏöî! '+obData.nickname+'ÎãòÏùò Í≥ÑÏ†ïÏù¥ ÏÉùÏÑ±ÎêòÏóàÏñ¥Ïöî. ‚úÖ\nÏßÄÍ∏àÎ∂ÄÌÑ∞ Ïä§ÎßàÌä∏Ìïú ÏáºÌïëÏùÑ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî!');
    setTimeout(function(){
      S('user',{nickname:obData.nickname,email:obData.nickname.toLowerCase()+'@pricepick.app',joined:new Date().toISOString().slice(0,10)});
      var settings=getSettings();
      settings.marketing=obData.noti;
      setSettings(settings);
      setTimeout(function(){initApp()},1000);
    },800);
  }
}

function addBotMsg(text){
  var row=document.createElement('div');row.className='chat-row';
  row.innerHTML='<div class="chat-avatar">ü§ñ</div><div class="chat-bubble">'+text+'</div>';
  chatArea.appendChild(row);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function addUserMsg(text){
  var row=document.createElement('div');row.className='chat-row user';
  row.innerHTML='<div class="chat-avatar" style="background:var(--primary);color:#fff;font-size:12px;font-weight:700">ÎÇò</div><div class="chat-bubble">'+text+'</div>';
  chatArea.appendChild(row);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function addTyping(){
  var row=document.createElement('div');row.className='chat-row';row.id='typing-row';
  row.innerHTML='<div class="chat-avatar">ü§ñ</div><div class="chat-typing"><span></span><span></span><span></span></div>';
  chatArea.appendChild(row);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function removeTyping(){var el=document.getElementById('typing-row');if(el)el.remove()}

function showInput(placeholder){
  chatInputArea.classList.add('show');
  chatInput.placeholder=placeholder||'ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî...';
  chatInput.value='';
  chatInput.focus();
}

function hideInput(){chatInputArea.classList.remove('show')}

function showOptions(opts){
  hideInput();
  var wrap=document.createElement('div');wrap.className='chat-row';wrap.id='options-row';
  var inner='<div style="width:32px;flex-shrink:0"></div><div class="chat-options">';
  opts.forEach(function(o,i){
    inner+='<div class="chat-opt" onclick="pickOption('+i+',this)">'+o+'</div>';
  });
  inner+='</div>';
  wrap.innerHTML=inner;
  chatArea.appendChild(wrap);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function removeOptions(){var el=document.getElementById('options-row');if(el)el.remove()}

function sendChatInput(){
  var val=chatInput.value.trim();
  if(!val)return;
  hideInput();
  addUserMsg(val);
  if(obStep===1){
    obData.nickname=val;
    obStep=2;
    addTyping();
    setTimeout(function(){removeTyping();obNext()},800);
  }
}

function pickOption(idx,el){
  var text=el.textContent;
  removeOptions();
  addUserMsg(text);
  if(obStep===3){
    obData.noti=idx===0;
    obStep=4;
  } else if(obStep===5){
    obStep=6;
  }
  addTyping();
  setTimeout(function(){removeTyping();obNext()},800);
}

function doLogout(){if(confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')){localStorage.clear();location.reload()}}
function doDeleteAccount(){if(confirm('Ï†ïÎßê ÌÉàÌá¥ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÎ™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§.')){localStorage.clear();location.reload()}}

// ÏπúÍµ¨ Ï¥àÎåÄ
function shareInvite(){
  var u=getUser();if(!u)return;
  var msg='PricePickÏóêÏÑú Ïø†Ìå° ÏµúÏ†ÄÍ∞Ä Ï∂îÏ†ÅÌïòÍ≥† Ïª§ÌîºÎèÑ Î∞õÏïÑÏöî! ‚òï\nÎÇ¥ Ï¥àÎåÄÏΩîÎìúÎ°ú Í∞ÄÏûÖÌïòÎ©¥ Î≥¥ÎÑàÏä§ Ìã∞Ïºì 2Ïû•!\nhttps://pricepick.app/invite/'+u.nickname;
  if(navigator.share){
    navigator.share({title:'PricePick Ï¥àÎåÄ',text:msg}).catch(function(){});
  }else{
    navigator.clipboard.writeText(msg).then(function(){showModal('üìã','Î≥µÏÇ¨ ÏôÑÎ£å!','Ï¥àÎåÄ Î©îÏãúÏßÄÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏñ¥Ïöî.<br>Ïπ¥Ïπ¥Ïò§ÌÜ°Ïù¥ÎÇò Î©îÏãúÏßÄÎ°ú Í≥µÏú†Ìï¥Î≥¥ÏÑ∏Ïöî!')});
  }
  // ÏãúÎÆ¨: Ï¥àÎåÄ Ïπ¥Ïö¥Ìä∏ Ï¶ùÍ∞Ä
  var inv=S('invite')||{count:0,earned:0};
  inv.count++;inv.earned+=2;S('invite',inv);
}
function copyInviteCode(code){
  navigator.clipboard.writeText(code).then(function(){showModal('üìã','Î≥µÏÇ¨ ÏôÑÎ£å!','Ï¥àÎåÄÏΩîÎìú <b>'+code+'</b>Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏñ¥Ïöî.')}).catch(function(){showModal('üìã','Ï¥àÎåÄÏΩîÎìú',code)});
}

// ÏúÑÏãúÎ¶¨Ïä§Ìä∏ Í≥µÏú†/ÏÑ†Î¨ºÏöîÏ≤≠
function shareWishlist(){
  var tracks=getTracks();
  var u=getUser();if(!u)return;
  if(tracks.length===0)return showModal('üìã','Í¥ÄÏã¨ÏÉÅÌíà ÏóÜÏùå','Î®ºÏ†Ä Í¥ÄÏã¨ÏÉÅÌíàÏùÑ Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî.');
  var msg=u.nickname+'ÎãòÏùò ÏúÑÏãúÎ¶¨Ïä§Ìä∏ üéÅ\n\n';
  tracks.forEach(function(t,i){msg+=(i+1)+'. '+t.name+' ('+t.currentPrice.toLocaleString()+'Ïõê)\n'});
  msg+='\nPricePickÏóêÏÑú ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî!';
  if(navigator.share){
    navigator.share({title:u.nickname+'Ïùò ÏúÑÏãúÎ¶¨Ïä§Ìä∏',text:msg}).catch(function(){});
  }else{
    navigator.clipboard.writeText(msg).then(function(){showModal('üìã','Î≥µÏÇ¨ ÏôÑÎ£å!','ÏúÑÏãúÎ¶¨Ïä§Ìä∏Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏñ¥Ïöî.')});
  }
}
function shareGiftRequest(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  var u=getUser();
  if(!p||!u)return;
  var msg='üíù '+u.nickname+'ÎãòÏù¥ Ïù¥ ÏÉÅÌíàÏùÑ Í∞ñÍ≥† Ïã∂Ïñ¥Ìï¥Ïöî!\n\n'+p.emoji+' '+p.name+'\nüí∞ '+p.currentPrice.toLocaleString()+'Ïõê\n\nÏø†Ìå°ÏóêÏÑú ÏÑ†Î¨ºÌïòÍ∏∞: '+p.url;
  if(navigator.share){
    navigator.share({title:'ÏÑ†Î¨º ÏöîÏ≤≠',text:msg}).catch(function(){});
  }else{
    navigator.clipboard.writeText(msg).then(function(){showModal('üéÅ','ÏÑ†Î¨º ÏöîÏ≤≠ Î≥µÏÇ¨!','Î©îÏãúÏßÄÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏñ¥Ïöî.<br>ÏπúÍµ¨ÏóêÍ≤å Î≥¥ÎÇ¥Î≥¥ÏÑ∏Ïöî!')});
  }
}

// ===== Ï∂úÏÑùÏ≤¥ÌÅ¨ =====
function getAttendance(){return S('attendance')||{days:[],streak:0,lastDate:null}}
function setAttendance(a){S('attendance',a)}

function doAttendance(){
  var today=new Date().toISOString().slice(0,10);
  var att=getAttendance();
  if(att.lastDate===today)return;
  var yesterday=new Date(Date.now()-86400000).toISOString().slice(0,10);
  att.days.push(today);
  if(att.days.length>30)att.days=att.days.slice(-30);
  att.streak=(att.lastDate===yesterday)?att.streak+1:1;
  att.lastDate=today;
  // 7Ïùº Î≥¥ÎÑàÏä§
  if(att.streak>=7){
    var tickets=getTickets();
    tickets.available+=2;
    tickets.history.push({id:Date.now()+77,tier:'silver',amount:0,date:new Date().toISOString(),status:'available',product:'7Ïùº Ï∂úÏÑù Î≥¥ÎÑàÏä§'});
    setTickets(tickets);
    att.streak=0;
    setAttendance(att);
    addNotification('attend','üìÖ 7Ïùº Ïó∞ÏÜç Ï∂úÏÑù Îã¨ÏÑ±!','Î≥¥ÎÑàÏä§ Ìã∞Ïºì 2Ïû•Ïù¥ ÏßÄÍ∏âÎêòÏóàÏñ¥Ïöî');
    showModal('üìÖ','7Ïùº Ïó∞ÏÜç Ï∂úÏÑù!','Ï∂ïÌïòÌï¥Ïöî! Î≥¥ÎÑàÏä§ Ìã∞Ïºì 2Ïû•Ïù¥ ÏßÄÍ∏âÎêòÏóàÏäµÎãàÎã§ üé´üé´');
    return;
  }
  setAttendance(att);
  addNotification('attend','üìÖ Ï∂úÏÑù Ï≤¥ÌÅ¨ ÏôÑÎ£å!','Ïó∞ÏÜç '+att.streak+'ÏùºÏß∏ Ï∂úÏÑùÏ§ë');
}

function renderAttendance(){
  var att=getAttendance();
  var today=new Date().toISOString().slice(0,10);
  var checkedToday=att.lastDate===today;
  var dayNames=['Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†','Ïùº'];
  var todayIdx=new Date().getDay();
  todayIdx=todayIdx===0?6:todayIdx-1;
  var html='<div class="attend-card" style="margin-top:10px">';
  html+='<div class="attend-header"><h3>üìÖ Ï∂úÏÑùÏ≤¥ÌÅ¨</h3><span class="streak">Ïó∞ÏÜç '+att.streak+'Ïùº</span></div>';
  html+='<div class="attend-days">';
  for(var i=0;i<7;i++){
    var isToday=i===todayIdx;
    var isDone=i<todayIdx||(isToday&&checkedToday);
    var isBonus=i===6;
    var cls='attend-day';
    if(isDone)cls+=' done';
    if(isToday)cls+=' today';
    if(isBonus)cls+=' bonus';
    html+='<div class="'+cls+'"><div class="d">'+dayNames[i]+'</div>';
    if(isBonus)html+='<div class="stamp">'+(isDone?'‚úì':'üéÅ')+'</div>';
    else html+='<div class="stamp">'+(isDone?'‚úì':'')+'</div>';
    html+='</div>';
  }
  html+='</div>';
  html+='<div class="attend-bonus">7Ïùº Ïó∞ÏÜç Ï∂úÏÑù Ïãú Î≥¥ÎÑàÏä§ Ìã∞Ïºì 2Ïû•!</div>';
  if(!checkedToday)html+='<button class="attend-btn" onclick="doAttendance();renderAttendance()">Ïò§Îäò Ï∂úÏÑùÌïòÍ∏∞</button>';
  else html+='<button class="attend-btn" disabled>Ï∂úÏÑù ÏôÑÎ£å ‚úì</button>';
  html+='</div>';
  document.getElementById('attend-area').innerHTML=html;
}

// ===== ÏïåÎ¶ºÏÑºÌÑ∞ =====
function getNotifications(){return S('notifications')||[]}
function addNotification(type,title,desc){
  var notis=getNotifications();
  notis.unshift({id:Date.now(),type:type,title:title,desc:desc,time:new Date().toISOString(),read:false});
  if(notis.length>30)notis=notis.slice(0,30);
  S('notifications',notis);
  updateNotiBadge();
}
function updateNotiBadge(){
  var notis=getNotifications();
  var unread=notis.filter(function(n){return!n.read}).length;
  var badge=document.getElementById('noti-badge');
  if(badge){
    if(unread>0){badge.style.display='flex';badge.textContent=unread>9?'9+':unread}
    else{badge.style.display='none'}
  }
}
function openNotiCenter(){
  var notis=getNotifications();
  if(notis.length===0){
    // Í∏∞Î≥∏ ÏïåÎ¶º ÏÉùÏÑ±
    var defaults=[
      {type:'price',title:'üìâ ÏóêÏñ¥Ìåü ÌîÑÎ°ú Í∞ÄÍ≤© ÌïòÎùΩ!',desc:'359,000Ïõê ‚Üí 289,000Ïõê (19% Ìï†Ïù∏)',time:new Date(Date.now()-3600000).toISOString()},
      {type:'ticket',title:'üé´ Ïù¥Î≤§Ìä∏ Ìã∞Ïºì ÎèÑÏ∞©',desc:'Íµ¨Îß§Ìïú ÏÉÅÌíàÏùò Ïù¥Î≤§Ìä∏ Ìã∞ÏºìÏù¥ ÏÇ¨Ïö© Í∞ÄÎä•Ìï¥Ïöî',time:new Date(Date.now()-7200000).toISOString()},
      {type:'event',title:'üéä Ï†ÑÏûêÏ†úÌíà 2Î∞∞ Ï†ÅÎ¶Ω Ïù¥Î≤§Ìä∏',desc:'2/28ÍπåÏßÄ Ï†ÑÏûêÏ†úÌíà Íµ¨Îß§ Ïãú Ìã∞Ïºì 2Î∞∞!',time:new Date(Date.now()-86400000).toISOString()},
      {type:'friend',title:'üéÅ ÏπúÍµ¨Í∞Ä Í∞ÄÏûÖÌñàÏñ¥Ïöî!',desc:'Ï¥àÎåÄ Î≥¥ÎÑàÏä§ Ìã∞Ïºì 2Ïû•Ïù¥ ÏßÄÍ∏âÎêòÏóàÏäµÎãàÎã§',time:new Date(Date.now()-172800000).toISOString()},
      {type:'price',title:'üìâ Îã§Ïù¥Ïä® Ï≤≠ÏÜåÍ∏∞ Ïó≠ÎåÄ ÏµúÏ†ÄÍ∞Ä',desc:'1,290,000Ïõê ‚Üí 899,000Ïõê (30% Ìï†Ïù∏)',time:new Date(Date.now()-259200000).toISOString()},
      {type:'challenge',title:'üéØ Ï†àÏïΩ Ï±åÎ¶∞ÏßÄ 50% Îã¨ÏÑ±!',desc:'Î™©Ìëú Ï†àÎ∞òÏùÑ Ïù¥Î§òÏñ¥Ïöî. Í≥ÑÏÜç ÌôîÏù¥ÌåÖ!',time:new Date(Date.now()-345600000).toISOString()},
    ];
    defaults.forEach(function(d){
      notis.push({id:Date.now()+Math.random()*1000,type:d.type,title:d.title,desc:d.desc,time:d.time,read:false});
    });
    S('notifications',notis);
  }
  var iconMap={price:'#EFF6FF',ticket:'#FEF3C7',event:'#F3E8FF',friend:'#DCFCE7',attend:'#EFF6FF',challenge:'#FFF7ED'};
  var html='';
  notis.forEach(function(n){
    var ago=getTimeAgo(n.time);
    var bg=iconMap[n.type]||'#f5f5f5';
    html+='<div class="noti-item'+(n.read?'':' unread')+'" onclick="markNotiRead('+n.id+')">';
    html+='<div class="noti-icon" style="background:'+bg+'">'+n.title.slice(0,2)+'</div>';
    html+='<div class="noti-content"><h4>'+n.title.slice(2).trim()+'</h4><p>'+n.desc+'</p></div>';
    html+='<span class="noti-time">'+ago+'</span></div>';
  });
  if(notis.length===0)html='<div class="empty"><div class="icon">üîî</div><p>ÏïÑÏßÅ ÏïåÎ¶ºÏù¥ ÏóÜÏñ¥Ïöî</p></div>';
  document.getElementById('noti-body').innerHTML=html;
  document.getElementById('noti-overlay').classList.add('show');
  // Î™®Îëê ÏùΩÏùå Ï≤òÎ¶¨
  notis.forEach(function(n){n.read=true});
  S('notifications',notis);
  setTimeout(updateNotiBadge,500);
}
function closeNotiCenter(){document.getElementById('noti-overlay').classList.remove('show')}
function markNotiRead(id){
  var notis=getNotifications();
  notis.forEach(function(n){if(n.id===id)n.read=true});
  S('notifications',notis);
  updateNotiBadge();
}
function getTimeAgo(isoStr){
  var diff=Date.now()-new Date(isoStr).getTime();
  var min=Math.floor(diff/60000);
  if(min<1)return 'Î∞©Í∏à';
  if(min<60)return min+'Î∂Ñ Ï†Ñ';
  var hr=Math.floor(min/60);
  if(hr<24)return hr+'ÏãúÍ∞Ñ Ï†Ñ';
  var day=Math.floor(hr/24);
  return day+'Ïùº Ï†Ñ';
}

// ===== AI Í∞ÄÍ≤© ÏòàÏ∏° =====
function getPricePrediction(p){
  // ÏãúÎÆ¨Î†àÏù¥ÏÖò: Ìï†Ïù∏Ïú®, ÏãúÏ¶å, Ìå®ÌÑ¥ Í∏∞Î∞ò ÏòàÏ∏°
  var seed=(p.id*7+p.currentPrice)%100;
  var factors=[];
  var direction,pct,verdict,reason;
  if(p.discount>=30){
    direction='down';pct=Math.floor(65+seed%20);
    verdict='üìâ Ï∂îÍ∞Ä ÌïòÎùΩ Í∞ÄÎä•ÏÑ± '+pct+'%';
    reason='ÌòÑÏû¨ Ïó≠ÎåÄ ÏµúÏ†ÄÍ∞Ä Íµ¨Í∞ÑÏù¥ÏóêÏöî. ÎπÑÏä∑Ìïú Ìå®ÌÑ¥ÏóêÏÑú Ï∂îÍ∞Ä Ìï†Ïù∏Ïù¥ ÏûàÏóàÏñ¥Ïöî.';
    factors.push({label:'Ïó≠ÎåÄÏµúÏ†ÄÍ∞Ä Í∑ºÏ†ë',color:'#16A34A'});
    factors.push({label:'ÏãúÏ¶å ÏÑ∏Ïùº ÏßÑÌñâÏ§ë',color:'#346aff'});
  }else if(p.discount>=20){
    direction='down';pct=Math.floor(50+seed%25);
    verdict='üìâ ÌïòÎùΩ Í∞ÄÎä•ÏÑ± '+pct+'%';
    reason='ÏµúÍ∑º 30Ïùº Ìå®ÌÑ¥ÏÉÅ Ï∂îÍ∞Ä Ìï†Ïù∏ Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÏñ¥Ïöî. Ï°∞Í∏à Îçî Í∏∞Îã§Î†§Î≥¥ÏÑ∏Ïöî.';
    factors.push({label:'30Ïùº ÌèâÍ∑† Ïù¥Ìïò',color:'#16A34A'});
    factors.push({label:'2Ï£º Ï£ºÍ∏∞ ÏÑ∏Ïùº Ìå®ÌÑ¥',color:'#F59E0B'});
  }else if(p.discount>=10){
    direction='stable';pct=Math.floor(30+seed%20);
    verdict='‚û°Ô∏è ÌòÑÏû¨Í∞Ä Ïú†ÏßÄ Í∞ÄÎä•ÏÑ± '+pct+'%';
    reason='ÎãπÎ∂ÑÍ∞Ñ ÌÅ∞ Í∞ÄÍ≤© Î≥ÄÎèôÏù¥ ÏóÜÏùÑ Í≤ÉÏúºÎ°ú ÏòàÏÉÅÎèºÏöî.';
    factors.push({label:'Í∞ÄÍ≤© ÏïàÏ†ï Íµ¨Í∞Ñ',color:'#F59E0B'});
    factors.push({label:'Ïû¨Í≥† Ï∂©Î∂Ñ',color:'#6B7280'});
  }else{
    direction='up';pct=Math.floor(40+seed%30);
    verdict='üìà ÏÉÅÏäπ Í∞ÄÎä•ÏÑ± '+pct+'%';
    reason='ÌòÑÏû¨ Ìï†Ïù∏Ìè≠Ïù¥ ÏûëÏïÑÏöî. Í≥ºÍ±∞ Ìå®ÌÑ¥ÏÉÅ Í∞ÄÍ≤©Ïù¥ Ïò§Î•º Ïàò ÏûàÏñ¥Ïöî.';
    factors.push({label:'Ìï†Ïù∏ Ï¢ÖÎ£å ÏûÑÎ∞ï',color:'#DC2626'});
    factors.push({label:'ÏàòÏöî Ï¶ùÍ∞Ä Ï∂îÏÑ∏',color:'#F59E0B'});
  }
  factors.push({label:'30Ïùº Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù',color:'#8B5CF6'});
  return{direction:direction,pct:pct,verdict:verdict,reason:reason,factors:factors};
}

// Íµ¨Îß§ ÌÉÄÏù¥Î∞ç ÌåêÎã®
function getTimingSignal(p){
  if(p.discount>=25)return{signal:'buy',label:'üü¢ ÏßÄÍ∏à ÏÇ¨ÏÑ∏Ïöî',reason:'Ïó≠ÎåÄ ÏµúÏ†ÄÍ∞Ä Í∑ºÏ†ë'};
  if(p.discount>=15)return{signal:'wait',label:'üü° Ï¢Ä Îçî Í∏∞Îã§Î†§Î≥¥ÏÑ∏Ïöî',reason:'Ï∂îÍ∞Ä Ìï†Ïù∏ Í∞ÄÎä•ÏÑ±'};
  return{signal:'expensive',label:'üî¥ ÎπÑÏã∏Ïöî',reason:'ÌèâÍ∑†Í∞ÄÎ≥¥Îã§ ÎÜíÏùå'};
}

// ===== TABS =====
var TITLES={wish:'Í¥ÄÏã¨ÏÉÅÌíà',hot:'Ìôà',search:'Í≤ÄÏÉâ',benefit:'ÌòúÌÉù',my:'ÎßàÏù¥ÌéòÏù¥ÏßÄ'};
function switchTab(name){
  document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active')});
  document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('active')});
  var pg=document.getElementById('page-'+name);
  if(pg)pg.classList.add('active');
  var tb=document.querySelector('.tab[data-tab="'+name+'"]');
  if(tb)tb.classList.add('active');
  document.getElementById('header-title').textContent=TITLES[name]||'';
  if(name==='wish')renderWishlist();
  if(name==='hot')renderHotdeals();
  if(name==='search')renderSearch();
  if(name==='benefit')renderBenefit();
  if(name==='my')renderMypage();
  document.getElementById('content').scrollTop=0;
}

// ===== INIT =====
function initApp(){
  var u=getUser();
  if(!u){
    document.getElementById('page-start').classList.add('active');
    document.getElementById('tabbar').style.display='none';
    document.getElementById('main-header').style.display='none';
    startOnboarding();
    return;
  }
  document.getElementById('page-start').classList.remove('active');
  document.getElementById('main-header').style.display='flex';
  document.getElementById('tabbar').style.display='flex';
  processTickets();
  updateNotiBadge();
  switchTab('hot');
}

// ===== WISHLIST =====
function renderWishlist(){
  var tracks=getTracks();
  document.getElementById('wish-count').textContent='Ï†ÑÏ≤¥ '+tracks.length;
  var html='';
  if(tracks.length===0){
    html='<div class="empty"><div class="icon">üëÄ</div><p>Í¥ÄÏã¨ÏÉÅÌíàÏùÑ Îì±Î°ùÌï¥Î≥¥ÏÑ∏Ïöî<br>Ìï´ÎîúÏù¥ÎÇò Í≤ÄÏÉâÏóêÏÑú ÏÉÅÌíàÏùÑ Ï∞æÏïÑ<br>Í¥ÄÏã¨ÏÉÅÌíàÏúºÎ°ú Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏñ¥Ïöî!</p></div>';
  }
  tracks.forEach(function(t){
    var change=Math.round((Math.random()*6-3)*10)/10;
    var changeClass=change<0?'down':'up';
    var arrow=change<0?'‚ñº':'‚ñ≤';
    var prod=PRODUCTS.find(function(x){return x.id===t.productId});
    var sig=prod?getTimingSignal(prod):{signal:'wait',label:'üü° ÌôïÏù∏Ï§ë'};
    html+='<div class="track-card" onclick="openDetail('+t.productId+',true)">';
    html+='<div class="track-thumb">'+t.emoji+'</div>';
    html+='<div class="track-body"><div class="track-name">'+t.name+'</div>';
    html+='<div class="track-price-row"><span class="track-current">'+t.currentPrice.toLocaleString()+'Ïõê</span>';
    html+='<span class="track-change '+changeClass+'">'+arrow+' '+Math.abs(change)+'%</span></div>';
    html+='<div style="display:flex;align-items:center;gap:6px;margin-top:4px">';
    html+='<span class="timing-badge '+sig.signal+'">'+sig.label+'</span>';
    html+='<button class="share-btn" onclick="event.stopPropagation();shareGiftRequest('+t.productId+')">üéÅ ÏÑ†Î¨ºÏöîÏ≤≠</button>';
    html+='</div></div></div>';
  });
  document.getElementById('wish-list').innerHTML=html;
}

// ===== HOTDEALS =====
function renderHotdeals(){
  // Ï∂úÏÑùÏ≤¥ÌÅ¨
  renderAttendance();
  // Ï†àÏïΩ Í∏àÏï° ÏÉÅÎã® Î∞∞ÎÑà
  var purchases=getPurchases();
  var totalSaved=0;
  purchases.forEach(function(p){
    var orig=p.originalPrice;
    if(!orig){var prod=PRODUCTS.find(function(x){return x.name===p.name});if(prod)orig=prod.originalPrice}
    if(orig)totalSaved+=(orig-p.price);
  });
  var savingsArea=document.getElementById('savings-top-area');
  if(purchases.length>0){
    savingsArea.innerHTML='<div class="savings-top" style="margin-top:10px"><div class="left"><span class="icon">üí∞</span><div class="info"><div class="label">PricePickÏúºÎ°ú ÏïÑÎÇÄ Í∏àÏï°</div><div class="amount">'+totalSaved.toLocaleString()+'Ïõê</div></div></div><button class="btn" onclick="switchTab(\'my\')">ÎÇ¥Ïó≠ Î≥¥Í∏∞</button></div>';
  }else{
    savingsArea.innerHTML='<div class="savings-top" style="margin-top:10px"><div class="left"><span class="icon">üí∞</span><div class="info"><div class="label">PricePickÏúºÎ°ú Ï†àÏïΩ ÏãúÏûë!</div><div class="amount">ÏµúÏ†ÄÍ∞ÄÏóê ÏÇ¨Í≥† Î¶¨ÏõåÎìúÍπåÏßÄ</div></div></div></div>';
  }
  // Ï†àÏïΩ Ï±åÎ¶∞ÏßÄ ÎØ∏Îãà
  var chalTarget=50000;
  var chalPct=Math.min(100,Math.round(totalSaved/chalTarget*100));
  if(purchases.length>0){
    savingsArea.innerHTML+='<div style="margin:0 16px 4px;display:flex;align-items:center;gap:8px"><span style="font-size:12px;color:var(--text-sub)">üéØ Ïù¥Îã¨ Ï±åÎ¶∞ÏßÄ</span><div style="flex:1;height:6px;border-radius:3px;background:var(--border);overflow:hidden"><div style="height:100%;width:'+chalPct+'%;background:var(--primary);border-radius:3px"></div></div><span style="font-size:12px;font-weight:700;color:var(--primary)">'+chalPct+'%</span></div>';
  }
  // Í∞ÄÍ≤© ÌïòÎùΩ ÏïåÎ¶º
  var alertArea=document.getElementById('price-alert-area');
  var tracks=getTracks();
  var alertProduct=tracks.length>0?PRODUCTS.find(function(x){return x.id===tracks[0].productId}):PRODUCTS[1];
  if(alertProduct){
    var dropPct=alertProduct.discount;
    var prevPrice=alertProduct.originalPrice;
    alertArea.innerHTML='<div class="price-alert" onclick="openDetail('+alertProduct.id+')"><span class="emoji">üìâ</span><div class="info"><div class="title">'+alertProduct.name+'</div><div class="desc">'+prevPrice.toLocaleString()+'Ïõê ‚Üí <b style="color:#e74c3c">'+alertProduct.currentPrice.toLocaleString()+'Ïõê</b> ('+dropPct+'%‚Üì)</div></div><span class="action">Î≥¥Îü¨Í∞ÄÍ∏∞ ‚Ä∫</span></div>';
  }
  renderHotExtra();
}

// ===== COUNTDOWN =====
// ===== PRODUCT DETAIL =====
var currentDetailId=null;
var chartInstance=null;
function closeDetail(){document.getElementById('detail-overlay').classList.remove('show');currentDetailId=null}

function genHistory(p){
  var h=[];
  for(var i=50;i>=0;i--){
    var d=new Date();d.setDate(d.getDate()-i);
    var v=p.currentPrice+Math.round(p.currentPrice*(Math.random()*0.4-0.15));
    h.push({date:(d.getMonth()+1)+'/'+('0'+d.getDate()).slice(-2),price:v});
  }
  return h;
}

// ===== ADD TO WISHLIST =====
function addToWishFromDetail(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var tracks=getTracks();
  if(tracks.find(function(t){return t.productId===id}))return showModal('üìå','Ïù¥ÎØ∏ Îì±Î°ùÎê®','Ïù¥ ÏÉÅÌíàÏùÄ Ïù¥ÎØ∏ Í¥ÄÏã¨ÏÉÅÌíàÏóê Îì±Î°ùÎêòÏñ¥ ÏûàÏñ¥Ïöî.');
  var target=parseInt(document.getElementById('detail-target').value,10)||Math.round(p.currentPrice*0.85);
  var history=genHistory(p);
  tracks.push({productId:id,name:p.name,emoji:p.emoji,currentPrice:p.currentPrice,targetPrice:target,history:history});
  setTracks(tracks);
  showModal('‚úÖ','Í¥ÄÏã¨ÏÉÅÌíà Îì±Î°ù!',p.name+'<br>Î™©ÌëúÍ∞Ä: '+target.toLocaleString()+'Ïõê');
}

function addProductFromModal(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var tracks=getTracks();
  if(tracks.find(function(t){return t.productId===id}))return showModal('üìå','Ïù¥ÎØ∏ Îì±Î°ùÎê®','Ïù¥ ÏÉÅÌíàÏùÄ Ïù¥ÎØ∏ Í¥ÄÏã¨ÏÉÅÌíàÏóê Îì±Î°ùÎêòÏñ¥ ÏûàÏñ¥Ïöî.');
  var target=Math.round(p.currentPrice*0.85);
  tracks.push({productId:id,name:p.name,emoji:p.emoji,currentPrice:p.currentPrice,targetPrice:target,history:genHistory(p)});
  setTracks(tracks);
  closeAddModal();
  showModal('‚úÖ','Í¥ÄÏã¨ÏÉÅÌíà Îì±Î°ù!',p.name);
}

// ===== ADD MODAL =====
function openAddModal(){
  var tracks=getTracks();
  var ids=tracks.map(function(t){return t.productId});
  var html='';
  PRODUCTS.forEach(function(p){
    var added=ids.indexOf(p.id)>=0;
    html+='<div style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border)">';
    html+='<div style="width:40px;height:40px;border-radius:8px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">'+p.emoji+'</div>';
    html+='<div style="flex:1;min-width:0"><div style="font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p.name+'</div>';
    html+='<div style="font-size:12px;font-weight:700;color:var(--text)">'+p.currentPrice.toLocaleString()+'Ïõê</div></div>';
    if(added){
      html+='<span style="font-size:12px;color:var(--text-sub);padding:6px 10px;border-radius:8px;background:var(--border)">Îì±Î°ùÎê®</span>';
    }else{
      html+='<button style="font-size:12px;color:#fff;padding:6px 10px;border-radius:8px;background:var(--primary);border:none;cursor:pointer;font-weight:600" onclick="addProductFromModal('+p.id+')">Ï∂îÍ∞Ä</button>';
    }
    html+='</div>';
  });
  document.getElementById('add-product-list').innerHTML=html;
  document.getElementById('add-modal').classList.add('show');
}
function closeAddModal(){document.getElementById('add-modal').classList.remove('show')}

// ===== PURCHASE SIMULATION =====
function quickBuy(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  simulatePurchase(id);
  // Ïã§Ï†úÎ°úÎäî Ïø†Ìå° Îî•ÎßÅÌÅ¨Î°ú Ïù¥Îèô
  // window.open(p.url, '_blank');
}

function simulatePurchase(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var secretTier=p.currentPrice>=100000?'gold':p.currentPrice>=20000?'silver':'bronze';
  var tickets=getTickets();
  // Check if 2x event applies
  var is2x=false;
  EVENT_2X.forEach(function(ev){
    if(ev.cat==='Ï†ÑÏûêÏ†úÌíà'&&(p.emoji==='üñ•Ô∏è'||p.emoji==='üéß'||p.emoji==='üéµ'))is2x=true;
    if(ev.cat==='ÏÉùÌôúÏö©Ìíà'&&(p.emoji==='üßπ'||p.emoji==='ü§ñ'))is2x=true;
    if(ev.cat==='Ìå®ÏÖò/ÏùòÎ•ò'&&p.emoji==='üëü')is2x=true;
    if(ev.cat==='ÏãùÌíà/ÏùåÎ£å'&&(p.emoji==='üíß'||p.emoji==='ü•õ'))is2x=true;
  });
  var ticketCount=is2x?2:1;
  tickets.pending+=ticketCount;
  for(var ti=0;ti<ticketCount;ti++){
    tickets.history.push({id:Date.now()+ti,tier:secretTier,amount:p.currentPrice,date:new Date().toISOString(),status:'pending',product:p.name});
  }
  setTickets(tickets);
  var purchases=getPurchases();
  purchases.unshift({name:p.name,price:p.currentPrice,originalPrice:p.originalPrice,date:new Date().toISOString().slice(0,10),emoji:p.emoji});
  S('purchases',purchases);
  // Ïä§Ìä∏Î¶≠ ÏóÖÎç∞Ïù¥Ìä∏
  var streakResult=updatePurchaseStreak();
  // Îû≠ÌÇπ ÏóÖÎç∞Ïù¥Ìä∏
  updateRankingData(p.currentPrice);
  closeDetail();
  var msg='<b>'+p.name+'</b> Íµ¨Îß§ ÏôÑÎ£å!<br><br>üé´ Ïù¥Î≤§Ìä∏ Ìã∞Ïºì '+ticketCount+'Ïû•Ïù¥ ÏßÄÍ∏âÎêòÏóàÏäµÎãàÎã§.';
  if(is2x)msg+='<br><span style="font-size:12px;color:var(--orange);font-weight:700">üéä 2Î∞∞ Ï†ÅÎ¶Ω Ïù¥Î≤§Ìä∏ Ï†ÅÏö©!</span>';
  if(streakResult.bonusTicket)msg+='<br><span style="font-size:12px;color:var(--orange);font-weight:700">üî• 5Ïùº Ïó∞ÏÜç Íµ¨Îß§ Î≥¥ÎÑàÏä§ Ìã∞Ïºì!</span>';
  else if(streakResult.streak>1)msg+='<br><span style="font-size:12px;color:var(--text-sub)">üî• Ïó∞ÏÜç Íµ¨Îß§ '+streakResult.streak+'ÏùºÏß∏!</span>';
  msg+='<br><span style="font-size:12px;color:var(--text-sub)">Í∏àÏï°Ïù¥ ÌÅ¥ÏàòÎ°ù Îçî Ï¢ãÏùÄ Ìã∞ÏºìÏù¥ ÎÇòÏò¨ Ïàò ÏûàÏñ¥Ïöî!</span>';
  showModal('üé´','Ïù¥Î≤§Ìä∏ Ìã∞Ïºì ÏßÄÍ∏â!',msg);
}

// ===== STREAK =====
function updatePurchaseStreak(){
  var today=new Date().toISOString().slice(0,10);
  var yesterday=new Date(Date.now()-86400000).toISOString().slice(0,10);
  var streak=getStreak();
  if(streak.lastDate===today)return{streak:streak.current,bonusTicket:false};
  var newStreak;
  if(streak.lastDate===yesterday){newStreak=streak.current+1}
  else{newStreak=1}
  var bonusTicket=false;
  if(newStreak>=5){
    var tickets=getTickets();
    var tier=Math.random()<0.5?'lottery':'roulette';
    tickets.available++;
    tickets.history.push({id:Date.now()+99,tier:'silver',amount:0,date:new Date().toISOString(),status:'available',product:'5Ïùº Ïó∞ÏÜç Î≥¥ÎÑàÏä§'});
    setTickets(tickets);
    bonusTicket=true;
    newStreak=0;
  }
  var longest=Math.max(newStreak,streak.longest);
  setStreak({current:newStreak,longest:longest,lastDate:today});
  return{streak:newStreak,bonusTicket:bonusTicket};
}

// ===== RANKING =====
function updateRankingData(amount){
  var u=getUser();if(!u)return;
  var month=new Date().toISOString().slice(0,7);
  var ranking=S('ranking_data')||{};
  if(!ranking[month])ranking[month]={};
  if(!ranking[month][u.nickname])ranking[month][u.nickname]=0;
  ranking[month][u.nickname]+=amount;
  S('ranking_data',ranking);
}

function getMonthlyRanking(){
  var month=new Date().toISOString().slice(0,7);
  var ranking=S('ranking_data')||{};
  var data=ranking[month]||{};
  // ÎçîÎØ∏ Ïú†Ï†Ä Ï∂îÍ∞Ä (Î¶¨ÏñºÍ∞ê)
  var dummies={'ÍπÄÏßÄÏàò':156000,'Ïù¥ÌïòÎäò':98000,'Î∞ïÏÑúÏú§':72000,'ÏµúÎØºÏ§Ä':45000,'Ï†ïÏàòÏïÑ':31000};
  var merged={};
  Object.keys(dummies).forEach(function(k){merged[k]=dummies[k]});
  Object.keys(data).forEach(function(k){merged[k]=(merged[k]||0)+data[k]});
  var arr=Object.keys(merged).map(function(k){return{name:k,total:merged[k]}});
  arr.sort(function(a,b){return b.total-a.total});
  return arr.slice(0,10);
}

// ===== TICKET PROCESSING =====
function processTickets(){
  var tickets=getTickets();
  var now=Date.now();
  var changed=false;
  tickets.history.forEach(function(t){
    if(t.status==='pending'){
      var elapsed=(now-new Date(t.date).getTime())/1000;
      if(elapsed>30){
        t.status='available';
        tickets.pending=Math.max(0,tickets.pending-1);
        tickets.available++;
        changed=true;
      }
    }
  });
  if(changed)setTickets(tickets);
}

// ===== SEARCH =====
var SEARCH_TAGS=['ÏóêÏñ¥Ìåü','Ï≤≠ÏÜåÍ∏∞','Î™®ÎãàÌÑ∞','Ïö¥Îèô','Ïä§ÎãàÏª§Ï¶à','Î°úÎ¥áÏ≤≠ÏÜåÍ∏∞','Î≤ÑÏ¶à','ÎÇòÏù¥ÌÇ§'];
var CATEGORIES=[
  {name:'Ï†ÑÏûê/ÎîîÏßÄÌÑ∏',emoji:'üì±'},{name:'ÏÉùÌôú/Ï£ºÎ∞©',emoji:'üè†'},{name:'Ìå®ÏÖò/ÏùòÎ•ò',emoji:'üëï'},
  {name:'Ïä§Ìè¨Ï∏†/Í±¥Í∞ï',emoji:'üí™'},{name:'ÏãùÌíà/ÏùåÎ£å',emoji:'üçΩÔ∏è'},{name:'Î∑∞Ìã∞/ÎØ∏Ïö©',emoji:'üíÑ'}
];
var selectedCategory='Ï†ÑÏûê/ÎîîÏßÄÌÑ∏';

// ÏµúÍ∑ºÍ≤ÄÏÉâÏñ¥
function getRecentSearches(){return S('recent_search')||[]}
function addRecentSearch(q){
  if(!q)return;
  var list=getRecentSearches().filter(function(s){return s!==q});
  list.unshift(q);
  if(list.length>10)list=list.slice(0,10);
  S('recent_search',list);
}
function removeRecentSearch(q){
  S('recent_search',getRecentSearches().filter(function(s){return s!==q}));
  renderSearchHome();
}
function clearRecentSearches(){
  S('recent_search',[]);
  renderSearchHome();
}

// ÏµúÍ∑º Î≥∏ ÏÉÅÌíà
function getRecentViews(){return S('recent_view')||[]}
function addRecentView(id){
  var list=getRecentViews().filter(function(v){return v!==id});
  list.unshift(id);
  if(list.length>10)list=list.slice(0,10);
  S('recent_view',list);
}

// Í≤ÄÏÉâ Ìôà Î†åÎçîÎßÅ
function renderSearchHome(){
  var html='';
  // Ï∂îÏ≤úÍ≤ÄÏÉâÏñ¥
  html+='<div style="padding:0 16px 12px">';
  html+='<div style="font-size:13px;font-weight:700;margin-bottom:8px">Ï∂îÏ≤ú Í≤ÄÏÉâÏñ¥</div>';
  html+='<div style="display:flex;flex-wrap:wrap;gap:6px">';
  SEARCH_TAGS.forEach(function(tag){
    html+='<span class="chip" onclick="document.getElementById(\'search-input\').value=\''+tag+'\';submitSearch()">'+tag+'</span>';
  });
  html+='</div></div>';

  // ÏµúÍ∑ºÍ≤ÄÏÉâÏñ¥
  html+='<div style="padding:0 16px 12px">';
  html+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">';
  html+='<span style="font-size:13px;font-weight:700">ÏµúÍ∑º Í≤ÄÏÉâÏñ¥</span>';
  var recent=getRecentSearches();
  if(recent.length>0) html+='<span style="font-size:12px;color:var(--text-sub);cursor:pointer" onclick="clearRecentSearches()">Ï†ÑÏ≤¥ÏÇ≠Ï†ú</span>';
  html+='</div>';
  if(recent.length>0){
    html+='<div style="display:flex;flex-wrap:wrap;gap:6px">';
    recent.forEach(function(s){
      html+='<span class="chip" style="padding-right:6px" onclick="document.getElementById(\'search-input\').value=\''+s+'\';submitSearch()">';
      html+=s+'<span onclick="event.stopPropagation();removeRecentSearch(\''+s+'\')" style="margin-left:6px;font-size:11px;color:var(--text-sub);cursor:pointer">‚úï</span></span>';
    });
    html+='</div>';
  }else{
    html+='<div style="font-size:12px;color:var(--text-sub)">ÏµúÍ∑º Í≤ÄÏÉâÌïú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</div>';
  }
  html+='</div>';

  // ÏµúÍ∑º Î≥∏ ÏÉÅÌíà
  html+='<div style="padding:0 16px 12px">';
  html+='<div style="font-size:13px;font-weight:700;margin-bottom:8px">ÏµúÍ∑º Î≥∏ ÏÉÅÌíà</div>';
  var views=getRecentViews();
  if(views.length>0){
    html+='<div style="display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;-webkit-overflow-scrolling:touch">';
    views.forEach(function(vid){
      var p=PRODUCTS.find(function(x){return x.id===vid});
      if(!p)return;
      html+='<div onclick="openDetail('+p.id+')" style="min-width:110px;max-width:110px;background:var(--card);border-radius:12px;padding:10px;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06);flex-shrink:0">';
      html+='<div style="font-size:28px;text-align:center;margin-bottom:6px">'+p.emoji+'</div>';
      html+='<div style="font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p.name+'</div>';
      html+='<div style="font-size:12px;font-weight:700;color:var(--primary);margin-top:2px">'+p.currentPrice.toLocaleString()+'Ïõê</div>';
      html+='</div>';
    });
    html+='</div>';
  }else{
    html+='<div style="font-size:12px;color:var(--text-sub)">ÏµúÍ∑º Î≥∏ ÏÉÅÌíàÏù¥ ÏóÜÏäµÎãàÎã§</div>';
  }
  html+='</div>';

  document.getElementById('search-home').innerHTML=html;
  document.getElementById('search-results').innerHTML='';
}

function submitSearch(){
  var q=document.getElementById('search-input').value.trim().toLowerCase();
  if(!q)return;
  addRecentSearch(q);
  doSearch();
}

// Ìï´ÎîúÌÉ≠ ÌïòÎã® ÏÑπÏÖò
function renderHotExtra(){
  var html='';
  // Ïù¥Î≤§Ìä∏ ÏÉÅÌíà Î∞∞ÎÑà
  html+='<div style="padding:12px 16px">';
  html+='<div style="font-size:14px;font-weight:700;margin-bottom:8px">üéâ Ïù¥Î≤§Ìä∏ ÏÉÅÌíà</div>';
  html+='<div style="display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;-webkit-overflow-scrolling:touch">';
  EVENT_2X.forEach(function(ev){
    html+='<div style="min-width:200px;border-radius:14px;padding:16px;color:#fff;background:'+ev.bg+';flex-shrink:0;cursor:pointer">';
    html+='<div style="font-size:24px;margin-bottom:4px">'+ev.emoji+'</div>';
    html+='<div style="font-size:14px;font-weight:700">'+ev.cat+' 2Î∞∞ Ï†ÅÎ¶Ω</div>';
    html+='<div style="font-size:11px;opacity:.85;margin-top:4px">~'+ev.end+'ÍπåÏßÄ</div>';
    html+='</div>';
  });
  html+='</div></div>';

  // Ïù∏Í∏∞ ÏÉÅÌíà (discount ÎÜíÏùÄÏàú)
  var popular=PRODUCTS.slice().sort(function(a,b){return b.discount-a.discount});
  html+='<div style="padding:0 16px 12px">';
  html+='<div style="font-size:14px;font-weight:700;margin-bottom:8px">üî• Ïù∏Í∏∞ ÏÉÅÌíà</div>';
  html+='<div style="display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;-webkit-overflow-scrolling:touch">';
  popular.forEach(function(p){
    html+='<div style="min-width:150px;max-width:150px;background:var(--card);border-radius:12px;padding:12px;box-shadow:0 1px 4px rgba(0,0,0,.06);flex-shrink:0">';
    html+='<div onclick="openDetail('+p.id+')" style="cursor:pointer">';
    html+='<div style="font-size:30px;text-align:center;margin-bottom:6px">'+p.emoji+'</div>';
    html+='<div style="font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p.name+'</div>';
    html+='<div style="display:flex;align-items:center;gap:4px;margin-top:4px">';
    html+='<span style="font-size:13px;font-weight:700;color:var(--red)">'+p.discount+'%</span>';
    html+='<span style="font-size:12px;font-weight:700">'+p.currentPrice.toLocaleString()+'Ïõê</span>';
    html+='</div>';
    var sig=getTimingSignal(p);
    html+='<div class="timing-badge '+sig.signal+'">'+sig.label+'</div>';
    html+='</div>';
    html+='<button class="quick-buy" onclick="event.stopPropagation();quickBuy('+p.id+')">üõí Ïø†Ìå°ÏóêÏÑú Î≥¥Í∏∞</button>';
    html+='</div>';
  });
  html+='</div></div>';

  // Í≥®ÎìúÎ∞ïÏä§ (3Ïó¥ Í∑∏Î¶¨Îìú + Ïπ¥Ïö¥Ìä∏Îã§Ïö¥)
  html+='<div style="padding:0 16px 12px">';
  html+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">';
  html+='<span style="font-size:14px;font-weight:700">üèÜ Í≥®ÎìúÎ∞ïÏä§</span>';
  html+='<span id="hot-goldbox-timer" style="font-size:12px;color:var(--red);font-weight:600"></span></div>';
  html+='<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">';
  PRODUCTS.slice(0,6).forEach(function(p){
    html+='<div onclick="openDetail('+p.id+')" style="background:var(--card);border-radius:12px;padding:10px;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06);text-align:center">';
    html+='<div style="font-size:26px;margin-bottom:4px">'+p.emoji+'</div>';
    html+='<div style="font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p.name.slice(0,8)+'</div>';
    html+='<div style="font-size:12px;font-weight:700;color:var(--red);margin-top:2px">'+p.discount+'%‚Üì</div>';
    html+='</div>';
  });
  html+='</div></div>';

  // ÏßÄÍ∏à ÏµúÏ†ÄÍ∞Ä (badge==='lowest')
  var lowest=PRODUCTS.filter(function(p){return p.badge==='lowest'});
  if(lowest.length>0){
    html+='<div style="padding:0 16px 12px">';
    html+='<div style="font-size:14px;font-weight:700;margin-bottom:8px">üí∞ ÏßÄÍ∏à ÏµúÏ†ÄÍ∞Ä</div>';
    lowest.forEach(function(p){
      html+='<div onclick="openDetail('+p.id+')" style="background:linear-gradient(135deg,#FEF3C7,#FDE68A);border-radius:14px;padding:14px;cursor:pointer;margin-bottom:8px;display:flex;align-items:center;gap:12px">';
      html+='<div style="font-size:34px">'+p.emoji+'</div>';
      html+='<div style="flex:1"><div style="font-size:13px;font-weight:700">'+p.name+'</div>';
      html+='<div style="display:flex;align-items:center;gap:6px;margin-top:4px">';
      html+='<span style="font-size:11px;color:var(--text-sub);text-decoration:line-through">'+p.originalPrice.toLocaleString()+'Ïõê</span>';
      html+='<span style="font-size:14px;font-weight:700;color:var(--red)">'+p.currentPrice.toLocaleString()+'Ïõê</span>';
      html+='</div></div>';
      html+='<div style="display:flex;flex-direction:column;align-items:center;gap:4px">';
      html+='<div style="background:var(--red);color:#fff;border-radius:8px;padding:4px 8px;font-size:12px;font-weight:700">ÏµúÏ†ÄÍ∞Ä</div>';
      html+='<button class="quick-buy" onclick="event.stopPropagation();quickBuy('+p.id+')" style="margin-top:0">Î≥¥Îü¨Í∞ÄÍ∏∞</button>';
      html+='</div></div>';
    });
    html+='</div>';
  }

  // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÌíà
  html+='<div style="padding:0 16px 16px">';
  html+='<div style="font-size:14px;font-weight:700;margin-bottom:8px">üìÇ Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÌíà</div>';
  html+='<div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px">';
  CATEGORIES.forEach(function(c){
    var active=c.name===selectedCategory;
    html+='<span class="chip" style="'+(active?'background:var(--primary);color:#fff;border-color:var(--primary)':'')+'" onclick="selectedCategory=\''+c.name+'\';renderHotExtra()">'+c.emoji+' '+c.name+'</span>';
  });
  html+='</div>';
  var catProducts=PRODUCTS.filter(function(p){return p.category===selectedCategory});
  if(catProducts.length===0){
    html+='<div style="text-align:center;padding:20px;color:var(--text-sub);font-size:13px">Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÌíàÏù¥ ÏóÜÏäµÎãàÎã§</div>';
  }else{
    html+='<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px">';
    catProducts.forEach(function(p){
      html+='<div onclick="openDetail('+p.id+')" style="background:var(--card);border-radius:12px;padding:12px;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06)">';
      html+='<div style="font-size:30px;text-align:center;margin-bottom:6px">'+p.emoji+'</div>';
      html+='<div style="font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p.name+'</div>';
      html+='<div style="display:flex;align-items:center;gap:4px;margin-top:4px">';
      html+='<span style="font-size:13px;font-weight:700;color:var(--red)">'+p.discount+'%</span>';
      html+='<span style="font-size:12px;font-weight:700">'+p.currentPrice.toLocaleString()+'Ïõê</span>';
      html+='</div></div>';
    });
    html+='</div>';
  }
  html+='</div>';

  document.getElementById('hot-extra').innerHTML=html;
  updateHotGoldboxTimer();
}

function updateHotGoldboxTimer(){
  var el=document.getElementById('hot-goldbox-timer');
  if(!el)return;
  var now=new Date();
  var end=new Date(now);
  end.setHours(23,59,59,999);
  var diff=end-now;
  var h=Math.floor(diff/3600000);
  var m=Math.floor((diff%3600000)/60000);
  var s=Math.floor((diff%60000)/1000);
  el.textContent=String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0')+' ÎÇ®Ïùå';
  setTimeout(updateHotGoldboxTimer,1000);
}

function renderSearch(){
  document.getElementById('search-input').value='';
  document.getElementById('search-home').style.display='';
  document.getElementById('search-results').style.display='none';
  document.getElementById('search-results').innerHTML='';
  renderSearchHome();
}
function doSearch(){
  var q=document.getElementById('search-input').value.trim().toLowerCase();
  if(!q){
    document.getElementById('search-home').style.display='';
    document.getElementById('search-results').style.display='none';
    document.getElementById('search-results').innerHTML='';
    return;
  }
  document.getElementById('search-home').style.display='none';
  document.getElementById('search-results').style.display='';
  var results=PRODUCTS.filter(function(p){return p.name.toLowerCase().indexOf(q)>=0});
  var html='';
  if(results.length===0){html='<div class="empty"><div class="icon">üò¢</div><p>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏñ¥Ïöî</p></div>'}
  results.forEach(function(p){
    html+='<div class="track-card" onclick="openDetail('+p.id+')" style="margin-bottom:1px">';
    html+='<div class="track-thumb">'+p.emoji+'</div>';
    html+='<div class="track-body"><div class="track-name">'+p.name+'</div>';
    if(p.ai) html+='<div style="font-size:11px;color:var(--primary);margin-bottom:3px">üí¨ '+p.ai.slice(0,30)+'...</div>';
    html+='<div class="track-price-row"><span class="track-current">'+p.currentPrice.toLocaleString()+'Ïõê</span>';
    html+='<span class="product-change down" style="font-size:11px">‚ñº'+p.discount+'%</span></div></div></div>';
  });
  document.getElementById('search-results').innerHTML=html;
}

// ===== BENEFIT =====
function renderBenefit(){
  processTickets();
  var tickets=getTickets();
  document.getElementById('ticket-pending').textContent='Ï†ÅÎ¶ΩÏòàÏ†ï '+tickets.pending+'Ïû•';
  document.getElementById('ticket-available').textContent=tickets.available;
  var remaining=Math.max(0,8-tickets.available);
  document.getElementById('ticket-remaining').textContent=remaining>0?remaining+'Ïû•':'ÍµêÌôò Í∞ÄÎä•!';
  document.getElementById('raffle-tickets').textContent=tickets.available;
  // 2x event scroll
  var ehtml='';
  EVENT_2X.forEach(function(ev){
    ehtml+='<div class="event-2x-card" style="background:'+ev.bg+'">';
    ehtml+='<div class="badge-2x">x2</div>';
    ehtml+='<div style="font-size:28px;margin-bottom:6px">'+ev.emoji+'</div>';
    ehtml+='<div style="font-size:14px;font-weight:700">'+ev.cat+'</div>';
    ehtml+='<div style="font-size:11px;opacity:.8;margin-bottom:6px">Ìã∞Ïºì 2Î∞∞ Ï†ÅÎ¶Ω</div>';
    ehtml+='<div style="font-size:10px;background:rgba(255,255,255,.2);display:inline-block;padding:2px 8px;border-radius:10px">~'+ev.end+'</div>';
    ehtml+='</div>';
  });
  document.getElementById('event-2x-scroll').innerHTML=ehtml;
  // Raffle prizes
  var html='';
  RAFFLE_PRIZES.forEach(function(r){
    html+='<div class="raffle-prize-card">';
    html+='<div class="raffle-medal r'+r.rank+'">'+r.rank+'</div>';
    html+='<div class="raffle-prize-info"><h4>'+r.icon+' '+r.prize+'</h4><p>'+r.desc+'</p></div></div>';
  });
  document.getElementById('raffle-prizes').innerHTML=html;
}

function scrollToRaffle(){
  setTimeout(function(){
    var el=document.getElementById('raffle-anchor');
    if(el)el.scrollIntoView({behavior:'smooth'});
  },100);
}

function doRaffle(){
  var tickets=getTickets();
  if(tickets.available<1)return showModal('üòÖ','Ìã∞ÏºìÏù¥ ÏóÜÏñ¥Ïöî','ÏÉÅÌíàÏùÑ Íµ¨Îß§ÌïòÎ©¥ Ïù¥Î≤§Ìä∏ Ìã∞ÏºìÏùÑ Î∞õÏùÑ Ïàò ÏûàÏñ¥Ïöî!');
  tickets.available--;
  for(var i=0;i<tickets.history.length;i++){
    if(tickets.history[i].status==='available'){tickets.history[i].status='used';break}
  }
  setTickets(tickets);
  setRaffleCount(getRaffleCount()+1);
  var ball=document.getElementById('raffle-ball');
  ball.classList.add('spinning');ball.textContent='?';
  var count=0;
  var iv=setInterval(function(){
    ball.textContent=['üçï','üçî','‚òï','üéÅ','üéâ','‚ú®'][count%6];count++;
    if(count>20){
      clearInterval(iv);ball.classList.remove('spinning');
      var r=Math.random();
      var result=r<0.05?RAFFLE_PRIZES[0]:r<0.2?RAFFLE_PRIZES[1]:RAFFLE_PRIZES[2];
      ball.textContent=result.icon;
      showModal(result.icon,result.rank+'Îì± ÎãπÏ≤®!','<b>'+result.prize+'</b><br><span style="font-size:12px;color:var(--text-sub)">'+result.desc+'</span>');
      renderBenefit();
    }
  },80);
}

// ===== MYPAGE =====
function renderMypage(){
  var u=getUser();if(!u)return;
  var tickets=getTickets();
  var purchases=getPurchases();
  var tracks=getTracks();
  var settings=getSettings();
  document.getElementById('my-avatar').textContent=u.nickname[0];
  document.getElementById('my-name').textContent=u.nickname;
  document.getElementById('my-email').textContent=u.email;
  // Badge - kakao status
  document.getElementById('my-badge-area').innerHTML=settings.kakao?
    '<span class="mypage-badge" style="background:#FEE500;color:#3C1E1E">Ïπ¥Ïπ¥Ïò§ Ïó∞ÎèôÏôÑÎ£å</span>':
    '<span class="mypage-badge" style="background:var(--border);color:var(--text-sub)">ÏùºÎ∞ò ÌöåÏõê</span>';
  document.getElementById('my-tickets').textContent=tickets.available+tickets.pending;
  document.getElementById('my-purchases').textContent=purchases.length;
  document.getElementById('my-wishcnt').textContent=tracks.length;
  document.getElementById('my-raffles').textContent=getRaffleCount();
  // Total savings
  var totalSaved=0;
  purchases.forEach(function(p){
    var orig=p.originalPrice;
    if(!orig){var prod=PRODUCTS.find(function(x){return x.name===p.name});if(prod)orig=prod.originalPrice}
    if(orig)totalSaved+=(orig-p.price);
  });
  document.getElementById('my-savings-section').innerHTML=
    '<div class="savings-card"><div class="label">Ï¥ù ÏïÑÎÇÄ Í∏àÏï°</div><div class="amount">'+totalSaved.toLocaleString()+'Ïõê</div><div class="sub">PricePickÍ≥º Ìï®ÍªòÌïú Ïä§ÎßàÌä∏ ÏáºÌïë</div></div>';
  // ÏõîÍ∞Ñ ÏÜåÎπÑ Î¶¨Ìè¨Ìä∏
  var totalSpent=0;
  var catSpend={};
  purchases.forEach(function(p){
    totalSpent+=p.price;
    var prod=PRODUCTS.find(function(x){return x.name===p.name});
    var cat=prod?prod.category:'Í∏∞ÌÉÄ';
    catSpend[cat]=(catSpend[cat]||0)+p.price;
  });
  // ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞ Î≥¥Í∞ï
  if(totalSpent===0){totalSpent=523000;totalSaved=32000;catSpend={'Ï†ÑÏûê/ÎîîÏßÄÌÑ∏':289000,'ÏÉùÌôú/Ï£ºÎ∞©':134000,'ÏãùÌíà/ÏùåÎ£å':50500,'Ìå®ÏÖò/ÏùòÎ•ò':49500}}
  var catEmojis={'Ï†ÑÏûê/ÎîîÏßÄÌÑ∏':'üì±','ÏÉùÌôú/Ï£ºÎ∞©':'üè†','Ìå®ÏÖò/ÏùòÎ•ò':'üëï','ÏãùÌíà/ÏùåÎ£å':'üçΩÔ∏è','Ïä§Ìè¨Ï∏†/Í±¥Í∞ï':'üí™','Î∑∞Ìã∞/ÎØ∏Ïö©':'üíÑ','Í∏∞ÌÉÄ':'üì¶'};
  var catColors=['#346aff','#10B981','#F59E0B','#EC4899','#8B5CF6','#EF4444'];
  var catArr=Object.keys(catSpend).map(function(k){return{name:k,amount:catSpend[k]}}).sort(function(a,b){return b.amount-a.amount});
  var maxCatAmount=catArr.length>0?catArr[0].amount:1;
  var savingsRate=totalSpent>0?Math.round(totalSaved/totalSpent*100):0;
  var repHtml='<div class="report-card">';
  repHtml+='<h3>üìä Ïù¥Î≤à Îã¨ ÏÜåÎπÑ Î¶¨Ìè¨Ìä∏</h3>';
  repHtml+='<div class="report-summary">';
  repHtml+='<div class="report-stat"><div class="val blue">'+totalSpent.toLocaleString()+'</div><div class="lbl">Ï¥ù ÏßÄÏ∂ú(Ïõê)</div></div>';
  repHtml+='<div class="report-stat"><div class="val green">'+totalSaved.toLocaleString()+'</div><div class="lbl">Ï†àÏïΩ(Ïõê)</div></div>';
  repHtml+='<div class="report-stat"><div class="val orange">'+savingsRate+'%</div><div class="lbl">Ï†àÏïΩÎ•†</div></div>';
  repHtml+='</div>';
  repHtml+='<div style="font-size:13px;font-weight:700;margin-bottom:8px">Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú</div>';
  repHtml+='<div class="report-cats">';
  catArr.forEach(function(c,i){
    var pct=Math.round(c.amount/maxCatAmount*100);
    var color=catColors[i%catColors.length];
    repHtml+='<div class="report-cat">';
    repHtml+='<span class="emoji">'+(catEmojis[c.name]||'üì¶')+'</span>';
    repHtml+='<div class="info"><div class="name">'+c.name+'</div>';
    repHtml+='<div class="bar-bg"><div class="bar" style="width:'+pct+'%;background:'+color+'"></div></div></div>';
    repHtml+='<span class="amount">'+c.amount.toLocaleString()+'Ïõê</span>';
    repHtml+='</div>';
  });
  repHtml+='</div>';
  var tipMsg=savingsRate>=5?'üëç Ï†àÏïΩÎ•† '+savingsRate+'%! ÏûòÌïòÍ≥† ÏûàÏñ¥Ïöî':'üí° PricePick ÏµúÏ†ÄÍ∞Ä ÏïåÎ¶ºÏùÑ ÌôúÏö©Ìï¥Î≥¥ÏÑ∏Ïöî';
  repHtml+='<div class="report-tip">'+tipMsg+'</div>';
  repHtml+='</div>';
  document.getElementById('my-report-section').innerHTML=repHtml;
  // ÏπúÍµ¨ Ï¥àÎåÄ Ïπ¥Îìú
  var inviteData=S('invite')||{count:0,earned:0};
  var inviteCode=u.nickname.toUpperCase().slice(0,3)+Math.floor(Math.random()*900+100);
  var invHtml='<div class="invite-card">';
  invHtml+='<h3>ÏπúÍµ¨ Ï¥àÎåÄÌïòÍ≥† Ìã∞Ïºì Î∞õÍ∏∞! üéÅ</h3>';
  invHtml+='<p>ÏπúÍµ¨Í∞Ä Í∞ÄÏûÖÌïòÎ©¥ ÎÇòÎèÑ, ÏπúÍµ¨ÎèÑ Î≥¥ÎÑàÏä§ Ìã∞Ïºì</p>';
  invHtml+='<div class="invite-reward"><div class="item">üé´ ÎÇò +2Ïû•</div><div class="item">üé´ ÏπúÍµ¨ +2Ïû•</div></div>';
  invHtml+='<button class="invite-btn" onclick="shareInvite()">Ï¥àÎåÄ ÎßÅÌÅ¨ Í≥µÏú†ÌïòÍ∏∞</button>';
  invHtml+='<div class="invite-stats"><span>Ï¥àÎåÄÌïú ÏπúÍµ¨: '+inviteData.count+'Î™Ö</span><span>Î∞õÏùÄ Ìã∞Ïºì: '+inviteData.earned+'Ïû•</span></div>';
  invHtml+='</div>';
  invHtml+='<div class="invite-code"><span style="font-size:12px;color:var(--text-sub)">ÎÇ¥ Ï¥àÎåÄÏΩîÎìú</span><span class="code">'+inviteCode+'</span><button class="copy-btn" onclick="copyInviteCode(\''+inviteCode+'\')">Î≥µÏÇ¨</button></div>';
  document.getElementById('my-invite-section').innerHTML=invHtml;
  // Ï†àÏïΩ Ï±åÎ¶∞ÏßÄ
  var chalTarget=50000;
  var chalSaved=totalSaved;
  var chalPct=Math.min(100,Math.round(chalSaved/chalTarget*100));
  var chalHtml='<div class="challenge-card">';
  chalHtml+='<div class="challenge-header"><h3>üéØ Ïù¥Îã¨Ïùò Ï±åÎ¶∞ÏßÄ</h3>';
  if(chalPct>=100)chalHtml+='<span class="badge">Îã¨ÏÑ±! üéâ</span>';
  else chalHtml+='<span class="badge" style="background:var(--primary-light);color:var(--primary)">ÏßÑÌñâÏ§ë</span>';
  chalHtml+='</div>';
  chalHtml+='<div class="challenge-goal">Ïù¥Î≤à Îã¨ '+chalTarget.toLocaleString()+'Ïõê Ï†àÏïΩÌïòÍ∏∞</div>';
  chalHtml+='<div class="challenge-bar-bg"><div class="challenge-bar" style="width:'+chalPct+'%"></div></div>';
  chalHtml+='<div class="challenge-info"><span class="current">'+chalSaved.toLocaleString()+'Ïõê Ï†àÏïΩ</span><span>Î™©Ìëú '+chalTarget.toLocaleString()+'Ïõê</span></div>';
  if(chalPct>=100)chalHtml+='<div class="challenge-bonus">üé´ Ï±åÎ¶∞ÏßÄ Îã¨ÏÑ± Î≥¥ÎÑàÏä§ Ìã∞Ïºì 3Ïû• ÏßÄÍ∏â!</div>';
  else chalHtml+='<div class="challenge-bonus">Îã¨ÏÑ± Ïãú Î≥¥ÎÑàÏä§ Ìã∞Ïºì 3Ïû•!</div>';
  chalHtml+='</div>';
  document.getElementById('my-challenge-section').innerHTML=chalHtml;
  // Ïä§Ìä∏Î¶≠ Ïπ¥Îìú
  var streak=getStreak();
  var streakHtml='<div class="streak-card"><h3>';
  if(streak.current>0)streakHtml+='üî• Ïó∞ÏÜç Íµ¨Îß§ '+streak.current+'ÏùºÏß∏!';
  else streakHtml+='üî• Ïó∞ÏÜç Íµ¨Îß§ ÎèÑÏ†Ñ!';
  streakHtml+='</h3><div class="streak-dots">';
  for(var si=1;si<=5;si++){
    if(si<=streak.current)streakHtml+='<div class="streak-dot filled">‚úì</div>';
    else streakHtml+='<div class="streak-dot empty">'+si+'</div>';
  }
  streakHtml+='</div><div class="tip">5Ïùº Îã¨ÏÑ± Ïãú Î≥¥ÎÑàÏä§ Ìã∞Ïºì!</div>';
  if(streak.longest>0)streakHtml+='<div class="record">ÏµúÏû• Í∏∞Î°ù: '+streak.longest+'Ïùº</div>';
  streakHtml+='</div>';
  document.getElementById('my-streak-section').innerHTML=streakHtml;
  // Ï†àÏïΩÏôï Îû≠ÌÇπ
  var rankings=getMonthlyRanking();
  var rankHtml='<div class="ranking-card"><h3>üèÜ Ïù¥Îã¨Ïùò Ï†àÏïΩÏôï</h3>';
  var medals=['ü•á','ü•à','ü•â'];
  rankings.forEach(function(r,idx){
    var isMe=r.name===u.nickname;
    rankHtml+='<div class="ranking-item'+(isMe?' me':'')+'">';
    if(idx<3)rankHtml+='<span class="ranking-medal">'+medals[idx]+'</span>';
    else rankHtml+='<span class="ranking-rank">'+(idx+1)+'</span>';
    rankHtml+='<span class="ranking-name">'+r.name+(isMe?' ‚Üê ÎÇò':'')+'</span>';
    rankHtml+='<span class="ranking-amount">'+r.total.toLocaleString()+'Ïõê</span>';
    rankHtml+='</div>';
  });
  rankHtml+='</div>';
  document.getElementById('my-ranking-section').innerHTML=rankHtml;
  // Toggles
  document.getElementById('toggle-marketing').className='toggle'+(settings.marketing?' on':'');
  document.getElementById('toggle-price').className='toggle'+(settings.noti_price!==false?' on':'');
  document.getElementById('toggle-restock').className='toggle'+(settings.noti_restock?' on':'');
  document.getElementById('toggle-event').className='toggle'+(settings.noti_event!==false?' on':'');
  var kakaoStatus=document.getElementById('kakao-status');
  if(kakaoStatus){
    kakaoStatus.innerHTML=settings.kakao?
      '<span style="color:var(--green);font-size:13px;font-weight:600">Ïó∞ÎèôÏôÑÎ£å ‚úì</span>':
      '<span style="color:var(--primary);font-size:13px">Ïó∞ÎèôÌïòÍ∏∞</span> <span class="arrow">‚Ä∫</span>';
  }
  // Wow membership
  var wowStatus=document.getElementById('wow-status');
  if(wowStatus){
    wowStatus.innerHTML=settings.wow?
      '<span style="color:var(--green);font-size:13px;font-weight:600">Î©§Î≤Ñ ‚úì</span>':
      '<span style="color:var(--primary);font-size:13px">Í∞ÄÏûÖÌïòÍ∏∞</span> <span class="arrow">‚Ä∫</span>';
  }
}
function toggleMarketing(){var s=getSettings();s.marketing=!s.marketing;setSettings(s);renderMypage()}
function toggleNoti(key){var s=getSettings();s['noti_'+key]=!s['noti_'+key];setSettings(s);renderMypage()}
function linkKakao(){
  var s=getSettings();
  if(s.kakao)return;
  s.kakao=true;setSettings(s);
  showModal('üéâ','Ïπ¥Ïπ¥Ïò§ Ïó∞Îèô ÏôÑÎ£å!','Î¶¨ÏõåÎìú Ï†ÅÎ¶Ω ÎåÄÍ∏∞ Í∏∞Í∞ÑÏù¥ Îã®Ï∂ïÎê©ÎãàÎã§.');
  renderMypage();
}

// ===== SUB PAGES =====
var SUB_CONTENT={
  notice:'<div class="card"><div style="font-size:14px;font-weight:700;margin-bottom:8px">üì¢ PricePick Ïò§Ìîà ÏïàÎÇ¥</div><p style="font-size:13px;color:var(--text-sub);line-height:1.6">ÏïàÎÖïÌïòÏÑ∏Ïöî, PricePickÏûÖÎãàÎã§.<br><br>Ïø†Ìå° ÏµúÏ†ÄÍ∞Ä Ï∂îÏ†Å & ÏáºÌïë Î¶¨ÏõåÎìú ÏÑúÎπÑÏä§Î•º Ïò§ÌîàÌñàÏäµÎãàÎã§. Í¥ÄÏã¨ÏÉÅÌíàÏùÑ Îì±Î°ùÌïòÍ≥† Î™©ÌëúÍ∞ÄÎ•º ÏÑ§Ï†ïÌïòÎ©¥, Í∞ÄÍ≤© Î≥ÄÎèôÏùÑ Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ï∂îÏ†ÅÌï¥ÎìúÎ¶ΩÎãàÎã§.<br><br>Íµ¨Îß§ Ïãú Ïù¥Î≤§Ìä∏ Ìã∞ÏºìÏù¥ ÏßÄÍ∏âÎêòÎ©∞, Ï∂îÏ≤®ÏùÑ ÌÜµÌï¥ Îã§ÏñëÌïú Í≤ΩÌíàÏùÑ Î∞õÏïÑÎ≥¥Ïã§ Ïàò ÏûàÏäµÎãàÎã§.<br><br>ÎßéÏùÄ Ïù¥Ïö© Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§! üôè<br><br><span style="color:var(--text-light)">2026.02.09</span></p></div>',
  terms:'<div class="card"><div style="font-size:14px;font-weight:700;margin-bottom:8px">Ïù¥Ïö©ÏïΩÍ¥Ä</div><div style="font-size:12px;color:var(--text-sub);line-height:1.7"><p><b>Ï†ú1Ï°∞ (Î™©Ï†Å)</b><br>Ïù¥ ÏïΩÍ¥ÄÏùÄ PricePick(Ïù¥Ìïò "ÏÑúÎπÑÏä§")Ïùò Ïù¥Ïö©Í≥º Í¥ÄÎ†®ÌïòÏó¨ ÌöåÏÇ¨ÏôÄ Ïù¥Ïö©Ïûê Í∞ÑÏùò Í∂åÎ¶¨, ÏùòÎ¨¥ Î∞è Ï±ÖÏûÑÏÇ¨Ìï≠ÏùÑ Í∑úÏ†ïÌï®ÏùÑ Î™©Ï†ÅÏúºÎ°ú Ìï©ÎãàÎã§.</p><br><p><b>Ï†ú2Ï°∞ (Ï†ïÏùò)</b><br>‚ë†"ÏÑúÎπÑÏä§"ÎûÄ ÌöåÏÇ¨Í∞Ä Ï†úÍ≥µÌïòÎäî Í∞ÄÍ≤© Ï∂îÏ†Å, ÏáºÌïë Î¶¨ÏõåÎìú Îì± Í¥ÄÎ†® ÏÑúÎπÑÏä§Î•º ÎßêÌï©ÎãàÎã§.<br>‚ë°"Ïù¥Ïö©Ïûê"ÎûÄ Ïù¥ ÏïΩÍ¥ÄÏóê Îî∞Îùº ÏÑúÎπÑÏä§Î•º Ïù¥Ïö©ÌïòÎäî ÏûêÎ•º ÎßêÌï©ÎãàÎã§.</p><br><p><b>Ï†ú3Ï°∞ (ÏÑúÎπÑÏä§ Ïù¥Ïö©)</b><br>‚ë†ÏÑúÎπÑÏä§ Ïù¥Ïö©ÏùÄ ÌöåÏõêÍ∞ÄÏûÖ ÌõÑ Í∞ÄÎä•Ìï©ÎãàÎã§.<br>‚ë°Ïù¥Î≤§Ìä∏ Ìã∞Ïºì Î∞è Í≤ΩÌíàÏùÄ ÌîÑÎ°úÎ™®ÏÖò Í∏∞Í∞Ñ ÎÇ¥ÏóêÎßå Ïú†Ìö®Ìï©ÎãàÎã§.<br>‚ë¢Î∂ÄÏ†ïÌïú Î∞©Î≤ïÏúºÎ°ú ÌöçÎìùÌïú Î¶¨ÏõåÎìúÎäî ÌöåÏàòÎê† Ïàò ÏûàÏäµÎãàÎã§.</p><br><p><b>Ï†ú4Ï°∞ (Í∞úÏù∏Ï†ïÎ≥¥)</b><br>ÌöåÏÇ¨Îäî Ïù¥Ïö©ÏûêÏùò Í∞úÏù∏Ï†ïÎ≥¥Î•º Í¥ÄÎ†® Î≤ïÎ†πÏóê Îî∞Îùº Î≥¥Ìò∏Ìï©ÎãàÎã§.</p></div></div>',
  privacy:'<div class="card"><div style="font-size:14px;font-weight:700;margin-bottom:8px">Í∞úÏù∏Ï†ïÎ≥¥ Ï≤òÎ¶¨Î∞©Ïπ®</div><div style="font-size:12px;color:var(--text-sub);line-height:1.7"><p><b>1. ÏàòÏßëÌïòÎäî Í∞úÏù∏Ï†ïÎ≥¥</b><br>ÎãâÎÑ§ÏûÑ, Ïù¥Î©îÏùº Ï£ºÏÜå</p><br><p><b>2. ÏàòÏßë Î™©Ï†Å</b><br>ÏÑúÎπÑÏä§ Ï†úÍ≥µ, Í∞ÄÍ≤© ÏïåÎ¶º, Î¶¨ÏõåÎìú ÏßÄÍ∏â</p><br><p><b>3. Î≥¥Ïú† Í∏∞Í∞Ñ</b><br>ÌöåÏõê ÌÉàÌá¥ ÏãúÍπåÏßÄ (ÌÉàÌá¥ Ï¶âÏãú ÌååÍ∏∞)</p><br><p><b>4. Ï†ú3Ïûê Ï†úÍ≥µ</b><br>Ïù¥Ïö©ÏûêÏùò Í∞úÏù∏Ï†ïÎ≥¥Î•º Ï†ú3ÏûêÏóêÍ≤å Ï†úÍ≥µÌïòÏßÄ ÏïäÏäµÎãàÎã§.</p><br><p><b>5. ÏïàÏ†ÑÏÑ± ÌôïÎ≥¥ Ï°∞Ïπò</b><br>Í∞úÏù∏Ï†ïÎ≥¥Îäî localStorageÏóê Ï†ÄÏû•ÎêòÎ©∞, ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°ÎêòÏßÄ ÏïäÏäµÎãàÎã§. (ÌîÑÎ°úÌÜ†ÌÉÄÏûÖ)</p></div></div>'
};
function openSub(key){
  var titles={notice:'Í≥µÏßÄÏÇ¨Ìï≠',terms:'Ïù¥Ïö©ÏïΩÍ¥Ä',privacy:'Í∞úÏù∏Ï†ïÎ≥¥ Ï≤òÎ¶¨Î∞©Ïπ®'};
  document.getElementById('sub-title').textContent=titles[key]||'';
  document.getElementById('sub-body').className='sub-body';
  document.getElementById('sub-body').innerHTML=SUB_CONTENT[key]||'';
  document.getElementById('sub-overlay').classList.add('show');
}
function closeSub(){document.getElementById('sub-overlay').classList.remove('show')}

// ===== INQUIRY CHATBOT =====
var iqArea;
var IQ_ANSWERS={
  'Ìã∞Ïºì/Î¶¨ÏõåÎìú Î¨∏Ïùò':'Íµ¨Îß§ Ïãú Ïù¥Î≤§Ìä∏ Ìã∞ÏºìÏù¥ ÏûêÎèô ÏßÄÍ∏âÎê©ÎãàÎã§. Í∏àÏï°Ïù¥ ÌÅ¥ÏàòÎ°ù Ï¢ãÏùÄ Ìã∞ÏºìÏù¥ ÎÇòÏôÄÏöî! Ï†ÅÎ¶ΩÏòàÏ†ï Ìã∞ÏºìÏùÄ ÏùºÏ†ï ÏãúÍ∞Ñ ÌõÑ ÏÇ¨Ïö© Í∞ÄÎä• ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤ΩÎê©ÎãàÎã§. ÌòúÌÉù ÌÉ≠ÏóêÏÑú Ìã∞ÏºìÏúºÎ°ú Ï∂îÏ≤®Ïóê ÏùëÎ™®Ìï† Ïàò ÏûàÏñ¥Ïöî. üé´',
  'Í∞ÄÍ≤© ÏïåÎ¶º Î¨∏Ïùò':'Í¥ÄÏã¨ÏÉÅÌíàÏóê Îì±Î°ùÌïòÎ©¥ Í∞ÄÍ≤© Î≥ÄÎèôÏùÑ Ï∂îÏ†ÅÌï¥ÎìúÎ¶ΩÎãàÎã§. ÏõêÌïòÎäî Î™©Ìëú Í∞ÄÍ≤©ÏùÑ ÏÑ§Ï†ïÌïòÎ©¥ Í∞ÄÍ≤©Ïù¥ ÎÇ¥Î†§Í∞îÏùÑ Îïå ÏïåÎ¶ºÏùÑ Î≥¥ÎÇ¥ÎìúÎ†§Ïöî. ÎßàÏù¥ÌéòÏù¥ÏßÄ > ÏïåÎ¶º ÏÑ§Ï†ïÏóêÏÑú ÏïåÎ¶º Ï¢ÖÎ•òÎ•º Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§. üìä',
  'Í≥ÑÏ†ï/Ïó∞Îèô Î¨∏Ïùò':'Ïπ¥Ïπ¥Ïò§ Ïó∞ÎèôÏùÄ ÎßàÏù¥ÌéòÏù¥ÏßÄ > Í≥ÑÏ†ï Ïó∞ÎèôÏóêÏÑú ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§. Ïπ¥Ïπ¥Ïò§Î•º Ïó∞ÎèôÌïòÎ©¥ Î¶¨ÏõåÎìú Ï†ÅÎ¶Ω ÎåÄÍ∏∞ Í∏∞Í∞ÑÏù¥ Îã®Ï∂ïÎê©ÎãàÎã§. üí¨',
  '2Î∞∞ Ï†ÅÎ¶Ω Ïù¥Î≤§Ìä∏':'ÌòúÌÉù ÌÉ≠ÏóêÏÑú ÌòÑÏû¨ ÏßÑÌñâ Ï§ëÏù∏ 2Î∞∞ Ï†ÅÎ¶Ω Ïù¥Î≤§Ìä∏Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÏñ¥Ïöî. Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÌíà Íµ¨Îß§ Ïãú Ìã∞ÏºìÏù¥ 2Ïû• ÏßÄÍ∏âÎê©ÎãàÎã§! üéä',
  'Í∏∞ÌÉÄ Î¨∏Ïùò':'ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÑ ÏïÑÎûò 1:1 Í≤åÏãúÌåêÏúºÎ°ú ÎÇ®Í≤®Ï£ºÏãúÎ©¥ ÌôïÏù∏ ÌõÑ ÎãµÎ≥ÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.'
};

function openInquiry(){
  document.getElementById('sub-title').textContent='1:1 Î¨∏ÏùòÌïòÍ∏∞';
  document.getElementById('sub-body').className='sub-body no-pad';
  document.getElementById('sub-body').innerHTML=
    '<div class="iq-chat">'+
      '<div class="iq-area" id="iq-area"></div>'+
      '<div class="iq-bottom" id="iq-bottom"></div>'+
    '</div>';
  document.getElementById('sub-overlay').classList.add('show');
  iqArea=document.getElementById('iq-area');
  setTimeout(function(){iqBotMsg('ÏïàÎÖïÌïòÏÑ∏Ïöî! PricePick Í≥†Í∞ùÏÑºÌÑ∞ÏûÖÎãàÎã§. üòä\nÏñ¥Îñ§ ÎèÑÏõÄÏù¥ ÌïÑÏöîÌïòÏÑ∏Ïöî?');
    setTimeout(function(){iqShowTopics()},400);
  },300);
}

function iqBotMsg(text){
  var row=document.createElement('div');row.className='chat-row';
  row.innerHTML='<div class="chat-avatar">ü§ñ</div><div class="chat-bubble">'+text+'</div>';
  iqArea.appendChild(row);iqArea.scrollTop=iqArea.scrollHeight;
}
function iqUserMsg(text){
  var row=document.createElement('div');row.className='chat-row user';
  row.innerHTML='<div class="chat-avatar" style="background:var(--primary);color:#fff;font-size:12px;font-weight:700">ÎÇò</div><div class="chat-bubble">'+text+'</div>';
  iqArea.appendChild(row);iqArea.scrollTop=iqArea.scrollHeight;
}

function iqShowTopics(){
  var topics=['Ìã∞Ïºì/Î¶¨ÏõåÎìú Î¨∏Ïùò','Í∞ÄÍ≤© ÏïåÎ¶º Î¨∏Ïùò','Í≥ÑÏ†ï/Ïó∞Îèô Î¨∏Ïùò','2Î∞∞ Ï†ÅÎ¶Ω Ïù¥Î≤§Ìä∏','Í∏∞ÌÉÄ Î¨∏Ïùò'];
  var row=document.createElement('div');row.className='chat-row';row.id='iq-options';
  var inner='<div style="width:32px;flex-shrink:0"></div><div class="chat-options">';
  topics.forEach(function(t){
    inner+='<div class="chat-opt" onclick="iqPickTopic(this)">'+t+'</div>';
  });
  inner+='</div>';
  row.innerHTML=inner;
  iqArea.appendChild(row);iqArea.scrollTop=iqArea.scrollHeight;
  // Bottom buttons
  document.getElementById('iq-bottom').innerHTML=
    '<button onclick="iqShowBoard()">üìã 1:1 Í≤åÏãúÌåê</button>'+
    '<button onclick="iqShowAgent()">üí¨ ÏÉÅÎã¥Ïõê Ïó∞Í≤∞</button>';
}

function iqPickTopic(el){
  var topic=el.textContent;
  var optRow=document.getElementById('iq-options');if(optRow)optRow.remove();
  iqUserMsg(topic);
  // typing
  var typing=document.createElement('div');typing.className='chat-row';typing.id='iq-typing';
  typing.innerHTML='<div class="chat-avatar">ü§ñ</div><div class="chat-typing"><span></span><span></span><span></span></div>';
  iqArea.appendChild(typing);iqArea.scrollTop=iqArea.scrollHeight;
  setTimeout(function(){
    var t=document.getElementById('iq-typing');if(t)t.remove();
    iqBotMsg(IQ_ANSWERS[topic]||'ÌôïÏù∏ ÌõÑ ÎãµÎ≥ÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.');
    setTimeout(function(){
      iqBotMsg('Îçî Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ ÏïÑÎûòÏóêÏÑú ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
      iqShowTopics();
    },500);
  },800);
}

function iqShowBoard(){
  iqArea.innerHTML='';
  iqBotMsg('1:1 Í≤åÏãúÌåê Î¨∏ÏùòÎ•º ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî.');
  var form=document.createElement('div');
  form.style.cssText='padding:12px;';
  form.innerHTML=
    '<div class="card" style="margin:0"><div style="margin-bottom:10px"><span class="input-label">Î¨∏Ïùò Ïú†Ìòï</span>'+
    '<select class="input-field" id="iq-type" style="padding:10px 14px"><option>Ïù¥Ïö© Î¨∏Ïùò</option><option>Ìã∞Ïºì/Î¶¨ÏõåÎìú</option><option>Ïò§Î•ò Ïã†Í≥†</option><option>Í∏∞ÌÉÄ</option></select></div>'+
    '<div style="margin-bottom:10px"><span class="input-label">Î¨∏Ïùò ÎÇ¥Ïö©</span>'+
    '<textarea class="input-field" id="iq-content" rows="4" placeholder="Î¨∏Ïùò ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" style="resize:none"></textarea></div>'+
    '<button class="modal-btn" onclick="iqSubmitBoard()">Î¨∏Ïùò Ï†ëÏàòÌïòÍ∏∞</button></div>';
  iqArea.appendChild(form);
  document.getElementById('iq-bottom').innerHTML='<button onclick="openInquiry()">‚Üê Ï≤òÏùåÏúºÎ°ú</button>';
}

function iqSubmitBoard(){
  var content=document.getElementById('iq-content').value.trim();
  if(!content)return;
  iqArea.innerHTML='';
  iqBotMsg('Î¨∏ÏùòÍ∞Ä Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§. ‚úÖ\nÎπ†Î•∏ ÏãúÏùº ÎÇ¥Ïóê ÎãµÎ≥ÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.');
  document.getElementById('iq-bottom').innerHTML='<button class="primary" onclick="closeSub()">ÌôïÏù∏</button>';
}

function iqShowAgent(){
  iqArea.innerHTML='';
  document.getElementById('iq-bottom').innerHTML='';
  var html='<div style="text-align:center;padding:40px 20px">';
  html+='<div style="font-size:48px;margin-bottom:12px">üí¨</div>';
  html+='<div style="font-size:16px;font-weight:700;margin-bottom:4px">ÏÉÅÎã¥Ïõê Ïó∞Í≤∞ Ï§ë...</div>';
  html+='<div style="font-size:13px;color:var(--text-sub);margin-bottom:16px">ÌÖîÎ†àÍ∑∏Îû®ÏúºÎ°ú ÏÉÅÎã¥ÏõêÏùÑ Ïó∞Í≤∞ÌïòÍ≥† ÏûàÏäµÎãàÎã§.</div>';
  html+='<div style="display:flex;gap:6px;justify-content:center;margin-bottom:16px">';
  html+='<span style="width:8px;height:8px;border-radius:50%;background:var(--primary);animation:typing 1.2s infinite"></span>';
  html+='<span style="width:8px;height:8px;border-radius:50%;background:var(--primary);animation:typing 1.2s infinite .2s"></span>';
  html+='<span style="width:8px;height:8px;border-radius:50%;background:var(--primary);animation:typing 1.2s infinite .4s"></span>';
  html+='</div>';
  html+='<div style="font-size:12px;color:var(--text-sub)">ÌèâÍ∑† ÎåÄÍ∏∞ÏãúÍ∞Ñ: ÏïΩ 3Î∂Ñ</div>';
  html+='<div style="margin-top:20px;display:flex;gap:8px;justify-content:center">';
  html+='<button style="padding:10px 20px;border-radius:12px;border:1.5px solid var(--border);background:var(--card);font-size:13px;font-weight:600;cursor:pointer" onclick="openInquiry()">‚Üê ÎèåÏïÑÍ∞ÄÍ∏∞</button>';
  html+='<button style="padding:10px 20px;border-radius:12px;border:none;background:var(--primary);color:#fff;font-size:13px;font-weight:600;cursor:pointer" onclick="iqShowBoard()">Í≤åÏãúÌåê Î¨∏Ïùò</button>';
  html+='</div></div>';
  iqArea.innerHTML=html;
}

// ===== MODAL =====
function showModal(icon,title,msg){
  document.getElementById('modal-content').innerHTML=
    '<div class="icon">'+icon+'</div><h3>'+title+'</h3><p>'+msg+'</p>'+
    '<button class="modal-btn" onclick="closeModal()">ÌôïÏù∏</button>';
  document.getElementById('modal').classList.add('show');
}
function closeModal(){document.getElementById('modal').classList.remove('show')}

// ===== BACK BUTTON =====
function pushState(){history.pushState({overlay:true},'','')}
var _openSub=openSub;
openSub=function(){pushState();_openSub.apply(null,arguments)};
var _openInquiry=openInquiry;
openInquiry=function(){pushState();_openInquiry.apply(null,arguments)};

// ===== CART =====
function getCart(){return S('cart')||[]}
function setCart(c){S('cart',c);updateCartBadge()}

function updateCartBadge(){
  var cart=getCart();
  var badge=document.getElementById('cart-badge');
  if(!badge)return;
  if(cart.length>0){badge.style.display='flex';badge.textContent=cart.length}
  else{badge.style.display='none'}
}

function addToCart(id){
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var cart=getCart();
  if(cart.find(function(c){return c.id===id}))return showModal('üõí','Ïù¥ÎØ∏ Îã¥ÍπÄ','Ïù¥ ÏÉÅÌíàÏùÄ Ïù¥ÎØ∏ Ïû•Î∞îÍµ¨ÎãàÏóê ÏûàÏñ¥Ïöî.');
  cart.push({id:p.id,name:p.name,emoji:p.emoji,price:p.currentPrice,url:p.url,checked:false});
  setCart(cart);
  showModal('üõí','Ïû•Î∞îÍµ¨Îãà Ï∂îÍ∞Ä!',p.name+'<br><span style="font-size:12px;color:var(--text-sub)">Ïû•Î∞îÍµ¨ÎãàÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî</span>');
}

function openCart(){
  var cart=getCart();
  var html='';
  if(cart.length===0){
    html='<div class="empty"><div class="icon">üõí</div><p>Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏñ¥Ïöî<br>Ìï´ÎîúÏù¥ÎÇò Í≤ÄÏÉâÏóêÏÑú ÏÉÅÌíàÏùÑ Îã¥ÏïÑÎ≥¥ÏÑ∏Ïöî!</p></div>';
    document.getElementById('cart-bottom-bar').style.display='none';
  }else{
    cart.forEach(function(item,i){
      html+='<div class="cart-item" id="cart-item-'+i+'">';
      html+='<div class="cart-check'+(item.checked?' checked':'')+'" onclick="toggleCartCheck('+i+')">'+(item.checked?'‚úì':'')+'</div>';
      html+='<div style="width:44px;height:44px;border-radius:10px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">'+item.emoji+'</div>';
      html+='<div class="cart-item-info"><div class="cart-item-name">'+item.name+'</div>';
      html+='<div class="cart-item-price">'+item.price.toLocaleString()+'Ïõê</div></div>';
      html+='<button class="cart-item-del" onclick="removeCartItem('+i+')">‚úï</button>';
      html+='</div>';
    });
    document.getElementById('cart-bottom-bar').style.display='block';
    updateCartGoBtn();
  }
  document.getElementById('cart-body').innerHTML=html;
  document.getElementById('cart-overlay').classList.add('show');
  history.pushState({overlay:true},'','');
}

function closeCart(){document.getElementById('cart-overlay').classList.remove('show')}

function toggleCartCheck(i){
  var cart=getCart();
  if(cart[i])cart[i].checked=!cart[i].checked;
  setCart(cart);
  openCart();
}

function removeCartItem(i){
  var cart=getCart();
  cart.splice(i,1);
  setCart(cart);
  openCart();
}

function updateCartGoBtn(){
  var cart=getCart();
  var checked=cart.filter(function(c){return c.checked});
  var btn=document.getElementById('cart-go-btn');
  if(btn){
    btn.disabled=checked.length===0;
    btn.textContent=checked.length>0?'ÏÑ†ÌÉùÌïú '+checked.length+'Í∞ú ÏÉÅÌíà Ïø†Ìå°ÏóêÏÑú Î≥¥Í∏∞':'ÏÉÅÌíàÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî';
  }
}

function cartGoToCoupang(){
  var cart=getCart();
  var checked=cart.filter(function(c){return c.checked});
  if(checked.length===0)return;
  // Open first checked item, remove from cart
  var item=checked[0];
  var deeplink='https://link.coupang.com/re/AFFTDP?lptag=AF'+item.id+'&subid=pricepick_'+Date.now();
  window.open(deeplink,'_blank');
  // Mark as sent, uncheck
  item.checked=false;
  // Remove from cart
  var newCart=cart.filter(function(c){return c.id!==item.id});
  setCart(newCart);
  if(checked.length>1){
    showModal('üõí','Îã§Ïùå ÏÉÅÌíà',checked[1].name+'<br>Í≥ÑÏÜç ÏßÑÌñâÌïòÏãúÎ†§Î©¥ Ïû•Î∞îÍµ¨ÎãàÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
  }else{
    showModal('‚úÖ','Ïø†Ìå°ÏúºÎ°ú Ïù¥Îèô!','ÏÉÅÌíà ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌñàÏñ¥Ïöî.<br>Íµ¨Îß§ ÌõÑ Î¶¨ÏõåÎìúÎ•º Î∞õÏúºÏÑ∏Ïöî!');
  }
  openCart();
}

// ===== SETTINGS =====
function openSettings(){
  renderSettings();
  document.getElementById('settings-overlay').classList.add('show');
  history.pushState({overlay:true},'','');
}

function closeSettings(){document.getElementById('settings-overlay').classList.remove('show')}

function renderSettings(){
  var s=getSettings();
  document.getElementById('set-noti-price').className='toggle'+(s.noti_price!==false?' on':'');
  document.getElementById('set-noti-restock').className='toggle'+(s.noti_restock?' on':'');
  document.getElementById('set-noti-event').className='toggle'+(s.noti_event!==false?' on':'');
  document.getElementById('set-dark-mode').className='toggle'+(s.dark_mode?' on':'');
  document.getElementById('set-price-unit').className='toggle'+(s.price_unit?' on':'');
}

function toggleSetting(key){
  var s=getSettings();
  s[key]=!s[key];
  setSettings(s);
  renderSettings();
}

function clearCache(){
  if(confirm('Ï∫êÏãúÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')){
    if('caches' in window)caches.keys().then(function(k){k.forEach(function(n){caches.delete(n)})});
    showModal('üóëÔ∏è','Ï∫êÏãú ÏÇ≠Ï†ú ÏôÑÎ£å','Ïï± Ï∫êÏãúÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
  }
}

function exportData(){
  var data={user:getUser(),tracks:getTracks(),tickets:getTickets(),purchases:getPurchases(),settings:getSettings()};
  var blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  var a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='pricepick_backup_'+new Date().toISOString().slice(0,10)+'.json';
  a.click();
}

// ===== REWARD EXCHANGE =====
function getTicketsByTier(){
  var tickets=getTickets();
  var counts={bronze:0,silver:0,gold:0};
  tickets.history.forEach(function(t){
    if(t.status==='available'&&t.tier)counts[t.tier]=(counts[t.tier]||0)+1;
  });
  return counts;
}

function exchangeReward(tier){
  var needed={bronze:8,silver:4,gold:1};
  var counts=getTicketsByTier();
  if((counts[tier]||0)<needed[tier]){
    return showModal('üòÖ','Ìã∞ÏºìÏù¥ Î∂ÄÏ°±Ìï¥Ïöî',tier.toUpperCase()+' Ìã∞Ïºì '+needed[tier]+'Ïû•Ïù¥ ÌïÑÏöîÌï¥Ïöî.<br>ÌòÑÏû¨ '+tier.toUpperCase()+' Ìã∞Ïºì: '+(counts[tier]||0)+'Ïû•<br><br>ÏÉÅÌíàÏùÑ Íµ¨Îß§ÌïòÎ©¥ Ìã∞ÏºìÏùÑ Î∞õÏùÑ Ïàò ÏûàÏñ¥Ïöî!');
  }
  // Use tickets
  var tickets=getTickets();
  var used=0;
  for(var i=0;i<tickets.history.length&&used<needed[tier];i++){
    if(tickets.history[i].status==='available'&&tickets.history[i].tier===tier){
      tickets.history[i].status='exchanged';
      tickets.available=Math.max(0,tickets.available-1);
      used++;
    }
  }
  setTickets(tickets);
  var exchanges=S('exchanges')||[];
  exchanges.push({tier:tier,reward:'ÏïÑÏù¥Ïä§ ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏',date:new Date().toISOString().slice(0,10)});
  S('exchanges',exchanges);
  showModal('‚òï','ÍµêÌôò ÏôÑÎ£å!','<b>ÏïÑÏù¥Ïä§ ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏</b> Í∏∞ÌîÑÌã∞ÏΩòÏù¥<br>Î∞úÍ∏âÎêòÏóàÏäµÎãàÎã§!<br><br><span style="font-size:12px;color:var(--text-sub)">'+tier.toUpperCase()+' Ìã∞Ïºì '+needed[tier]+'Ïû• ÏÇ¨Ïö©</span>');
  renderBenefit();
}

function updateExchangeButtons(){
  var counts=getTicketsByTier();
  var needed={bronze:8,silver:4,gold:1};
  ['bronze','silver','gold'].forEach(function(tier){
    var btn=document.getElementById('ex-'+tier+'-btn');
    if(btn){
      var has=counts[tier]||0;
      btn.disabled=has<needed[tier];
      btn.textContent=has>=needed[tier]?'ÍµêÌôò':'('+has+'/'+needed[tier]+')';
    }
  });
}

// ===== UPDATE DETAIL BOTTOM - add cart button =====
openDetail=function(id,fromWish){
  currentDetailId=id;
  addRecentView(id);
  var p=PRODUCTS.find(function(x){return x.id===id});
  if(!p)return;
  var tracks=getTracks();
  var tracked=tracks.find(function(t){return t.productId===id});
  var history=tracked?tracked.history:genHistory(p);
  var prices=history.map(function(h){return h.price});
  var maxP=Math.max.apply(null,prices),minP=Math.min.apply(null,prices),avgP=Math.round(prices.reduce(function(a,b){return a+b},0)/prices.length);
  var avgDiff=p.currentPrice-avgP;

  var html='';
  if(p.ai){
    html+='<div style="margin:12px 16px;background:linear-gradient(135deg,#EFF6FF,#E0E7FF);border-radius:14px;padding:14px 16px;box-shadow:0 1px 4px rgba(0,0,0,.04)">';
    html+='<div style="font-size:12px;font-weight:700;color:var(--primary);margin-bottom:4px">üí¨ ÏµúÍ∑º Íµ¨Îß§ Ïù¥Ïú†</div>';
    html+='<div style="font-size:13px;line-height:1.5;color:var(--text)">'+p.ai+'</div></div>';
  }
  html+='<div class="graph-card"><div class="graph-title">PricePick Í∞ÄÍ≤© Í∑∏ÎûòÌîÑ <span style="font-size:12px;color:var(--text-sub)">‚ìò</span></div>';
  html+='<canvas id="detail-chart" height="180"></canvas>';
  html+='<div class="price-stats">';
  html+='<div class="price-stat"><span class="label"><span class="dot" style="background:var(--red)"></span> Ïó≠ÎåÄÏµúÍ≥†Í∞Ä</span><span class="value" style="color:var(--red)">'+maxP.toLocaleString()+'Ïõê</span></div>';
  html+='<div class="price-stat"><span class="label"><span class="dot" style="background:var(--text-sub)"></span> ÌèâÍ∑†Í∞Ä</span><span class="value">'+avgP.toLocaleString()+'Ïõê</span></div>';
  html+='<div class="price-stat"><span class="label"><span class="dot" style="background:var(--green)"></span> Ïó≠ÎåÄÏµúÏ†ÄÍ∞Ä</span><span class="value" style="color:var(--green)">'+minP.toLocaleString()+'Ïõê</span></div>';
  html+='</div></div>';

  // AI Í∞ÄÍ≤© ÏòàÏ∏°
  var pred=getPricePrediction(p);
  html+='<div class="predict-card">';
  html+='<div class="predict-header"><span class="ai-badge">AI ÏòàÏ∏°</span><h4>Í∞ÄÍ≤© Ï†ÑÎßù</h4></div>';
  html+='<div class="predict-main">';
  html+='<div class="predict-circle '+pred.direction+'">'+pred.pct+'%<div class="pct">'+(pred.direction==='down'?'ÌïòÎùΩ':'ÏÉÅÏäπ')+'</div></div>';
  html+='<div class="predict-info"><div class="verdict">'+pred.verdict+'</div>';
  html+='<div class="reason">'+pred.reason+'</div></div></div>';
  html+='<div class="predict-factors">';
  pred.factors.forEach(function(f){
    html+='<div class="predict-factor"><span class="dot" style="background:'+f.color+'"></span>'+f.label+'</div>';
  });
  html+='</div></div>';

  if(!tracked){
    html+='<div style="padding:12px 16px;font-size:13px;color:var(--text-sub);text-align:center;background:var(--card);margin:0 16px 12px;border-radius:12px">ÏïÑÏßÅ Íµ¨Îß§Ìïú Ï†Å ÏóÜÎäî ÏÉÅÌíàÏù¥ÏóêÏöî. ‚ìò</div>';
  }

  html+='<div class="alert-card">';
  html+='<div class="alert-header">Ï∂îÍ∞Ä ÏïåÎ¶º ÏÑ§Ï†ï <span style="font-size:14px;cursor:pointer">‚àß</span></div>';
  if(!tracked){
    html+='<div class="alert-info">‚ìò Í¥ÄÏã¨ÏÉÅÌíàÏúºÎ°ú Ï∂îÍ∞ÄÌï¥Ïïº ÏÑ§Ï†ïÌï† Ïàò ÏûàÏñ¥Ïöî.</div>';
  }
  html+='<div class="alert-row"><div class="left">üìä ÏõêÌïòÎäî Í∞ÄÍ≤© ÏïåÎ¶º</div><div class="right">'+(tracked?'<span>'+tracked.targetPrice.toLocaleString()+'Ïõê</span>':'<span>ÏÑ§Ï†ï ÏïàÎê®</span>')+' ‚Ä∫</div></div>';
  html+='<div class="alert-row"><div class="left">üîî Ïû¨ÏûÖÍ≥† ÏïåÎ¶º</div><div class="right"><div class="toggle" onclick="this.classList.toggle(\'on\')"></div></div></div>';
  html+='</div>';

  html+='<div style="margin:0 16px 12px;background:var(--card);border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.04)">';
  html+='<div style="font-size:14px;font-weight:700;margin-bottom:10px">ÏõêÌïòÎäî Í∞ÄÍ≤© ÏÑ§Ï†ï</div>';
  html+='<div style="margin-bottom:8px"><span class="input-label">Î™©Ìëú Í∞ÄÍ≤© (Ïõê)</span>';
  html+='<input type="number" class="input-field" id="detail-target" value="'+(tracked?tracked.targetPrice:Math.round(p.currentPrice*0.85))+'"></div></div>';

  // ÎπÑÏä∑Ìïú ÏÉÅÌíà Ï∂îÏ≤ú
  var similar=PRODUCTS.filter(function(x){return x.category===p.category&&x.id!==p.id});
  if(similar.length<3)similar=similar.concat(PRODUCTS.filter(function(x){return x.id!==p.id&&x.category!==p.category}).slice(0,3-similar.length));
  if(similar.length>0){
    html+='<div class="similar-section">';
    html+='<div class="similar-header">üëÄ Ïù¥ ÏÉÅÌíàÏùÑ Î≥∏ ÏÇ¨ÎûåÏù¥ Í∞ôÏù¥ Î≥∏ ÏÉÅÌíà</div>';
    html+='<div class="similar-scroll">';
    similar.slice(0,5).forEach(function(s){
      var sSig=getTimingSignal(s);
      html+='<div class="similar-card" onclick="openDetail('+s.id+')">';
      html+='<div class="emoji">'+s.emoji+'</div>';
      html+='<div class="name">'+s.name+'</div>';
      html+='<div class="discount">'+s.discount+'%</div>';
      html+='<div class="price">'+s.currentPrice.toLocaleString()+'Ïõê</div>';
      html+='<div class="timing"><span class="timing-badge '+sSig.signal+'" style="font-size:9px;padding:2px 6px">'+sSig.label+'</span></div>';
      html+='</div>';
    });
    html+='</div></div>';
  }

  html+='<div class="deeplink-info">Ïø†Ìå° ÌååÌä∏ÎÑàÏä§ Îî•ÎßÅÌÅ¨ (ÏòàÏãú)<code>https://link.coupang.com/re/AFFTDP?lptag=AF'+p.id+'&amp;subid=pricepick_'+Date.now()+'</code></div>';

  document.getElementById('detail-scroll').innerHTML=html;

  var bottomHtml='<button class="add-btn" onclick="addToCart('+p.id+')">üõí Îã¥Í∏∞</button>';
  bottomHtml+='<button class="add-btn" onclick="addToWishFromDetail('+p.id+')">+ Í¥ÄÏã¨</button>';
  bottomHtml+='<button class="buy-btn" onclick="simulatePurchase('+p.id+')">Íµ¨Îß§ÌïòÎü¨ Í∞ÄÍ∏∞</button>';
  document.getElementById('detail-bottom').innerHTML=bottomHtml;

  document.getElementById('detail-overlay').classList.add('show');
  history.pushState({overlay:true},'','');

  setTimeout(function(){
    if(chartInstance)chartInstance.destroy();
    var ctx=document.getElementById('detail-chart');
    if(!ctx)return;
    chartInstance=new Chart(ctx.getContext('2d'),{
      type:'line',
      data:{
        labels:history.map(function(h){return h.date}),
        datasets:[
          {label:'Í∞ÄÍ≤©',data:prices,borderColor:'#346aff',backgroundColor:'rgba(52,106,255,.08)',fill:true,tension:.3,pointRadius:0,borderWidth:2},
          {label:'Ïó≠ÎåÄÏµúÏ†ÄÍ∞Ä',data:prices.map(function(){return minP}),borderColor:'#10B981',borderDash:[4,4],pointRadius:0,fill:false,borderWidth:1},
        ]
      },
      options:{
        responsive:true,
        plugins:{legend:{display:false},tooltip:{callbacks:{label:function(c){return c.parsed.y.toLocaleString()+'Ïõê'}}}},
        scales:{x:{ticks:{font:{size:10},maxTicksLimit:6}},y:{ticks:{font:{size:10},callback:function(v){return(v/10000).toFixed(0)+'Îßå'}}}}
      }
    });
  },100);
};

// ===== UPDATE BENEFIT RENDER =====
var _origRenderBenefit=renderBenefit;
renderBenefit=function(){
  _origRenderBenefit();
  updateExchangeButtons();
};

// ===== UPDATE BACK BUTTON FOR NEW OVERLAYS =====
window.addEventListener('popstate',function(){
  if(document.getElementById('modal').classList.contains('show')){closeModal();return}
  if(document.getElementById('add-modal').classList.contains('show')){closeAddModal();return}
  if(document.getElementById('cart-overlay').classList.contains('show')){closeCart();return}
  if(document.getElementById('settings-overlay').classList.contains('show')){closeSettings();return}
  if(document.getElementById('sub-overlay').classList.contains('show')){closeSub();return}
  if(document.getElementById('detail-overlay').classList.contains('show')){closeDetail();return}
});

// ===== iOS STANDALONE SAFE-AREA FIX =====
// iOS standaloneÏóêÏÑú Î∑∞Ìè¨Ìä∏Í∞Ä Ïù¥ÎØ∏ safe areaÎ•º Ï†úÏô∏ÌïòÎØÄÎ°ú
// CSS safe-area paddingÏù¥ Ïù¥Ï§ë Ï†ÅÏö©ÎêòÎäî Î¨∏Ï†ú Ìï¥Í≤∞
(function(){
  var isStandalone=window.navigator.standalone||window.matchMedia('(display-mode:standalone)').matches;
  if(isStandalone&&window.innerHeight<screen.height-20){
    document.documentElement.style.setProperty('--safe-bottom','0px');
  }
})();

// ===== WOW MEMBERSHIP =====
function toggleWow(){
  var s=getSettings();
  if(s.wow){
    if(confirm('ÏôÄÏö∞ Î©§Î≤ÑÏã≠ Ïó∞ÎèôÏùÑ Ìï¥Ï†úÌï†ÍπåÏöî?')){s.wow=false;setSettings(s);renderMypage()}
    return;
  }
  s.wow=true;setSettings(s);
  showModal('üöÄ','ÏôÄÏö∞ Î©§Î≤ÑÏã≠ Ïó∞Îèô!','Ïø†Ìå° ÏôÄÏö∞ Î©§Î≤ÑÏã≠Ïù¥ Ïó∞ÎèôÎêòÏóàÏäµÎãàÎã§.<br>Î°úÏºìÎ∞∞ÏÜ° Î¨¥Î£åÎ∞∞ÏÜ° ÌòúÌÉùÏùÑ ÎàÑÎ¶¨ÏÑ∏Ïöî!');
  renderMypage();
}

// ===== PWA SERVICE WORKER =====
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/sw.js').catch(function(){});
}

// ===== START =====
initApp();
updateCartBadge();
</script>
</div><!-- /app-shell -->
</body>
</html>
